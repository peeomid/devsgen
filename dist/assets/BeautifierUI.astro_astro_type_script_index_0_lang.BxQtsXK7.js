class f{worker=null;pending=new Map;currentId=null;boundOnMessage=null;ensureWorker(){if(this.worker)return this.worker;if(typeof window>"u")throw new Error("BeautifyWorkerService: Worker can only be initialized in the browser");return this.worker=new Worker(new URL("/assets/beautifyWorker-X4bhPE_K.js",import.meta.url),{type:"module"}),this.boundOnMessage=this.onMessage.bind(this),this.worker.addEventListener("message",this.boundOnMessage),this.worker}prewarm(){try{"requestIdleCallback"in window?window.requestIdleCallback(()=>this.ensureWorker()):setTimeout(()=>this.ensureWorker(),0)}catch{}}format(e,t,n){const s=this.ensureWorker();this.currentId&&this.cancel(this.currentId);const o=this.nextId();this.currentId=o;const c={id:o,text:e,options:t};return new Promise((u,d)=>{this.pending.set(o,{resolve:u,reject:d,onProgress:n});try{s.postMessage(c)}catch(h){this.pending.delete(o),this.currentId=null,d(h)}})}cancel(e){if(!this.worker)return;try{this.worker.postMessage({type:"cancel",id:e})}catch{}const t=this.pending.get(e);t&&(t.reject(new Error("Cancelled")),this.pending.delete(e)),this.currentId===e&&(this.currentId=null)}cancelCurrent(){this.currentId&&this.cancel(this.currentId)}dispose(){this.worker&&(this.boundOnMessage&&this.worker.removeEventListener("message",this.boundOnMessage),this.worker.terminate(),this.worker=null);for(const[e,t]of this.pending.entries())t.reject(new Error("Disposed")),this.pending.delete(e);this.currentId=null}onMessage(e){const t=e.data;if(!t||typeof t.id!="string")return;const n=t.id,s=this.pending.get(n);if(s){if(t.type==="progress"){const o=t;s.onProgress?.({processed:o.processed,total:o.total});return}if(t.type==="result"){const o=t;this.pending.delete(n),this.currentId===n&&(this.currentId=null),s.resolve(o.result);return}if(t.type==="error"){const o=t;this.pending.delete(n),this.currentId===n&&(this.currentId=null),s.reject(new Error(o.error));return}}}nextId(){return"bwr_"+Math.random().toString(36).slice(2)+Date.now().toString(36)}}const a=new f;function m(r){const e=r.trim();if(!e)return"unknown";try{return JSON.parse(e),"json"}catch{}return/\b(select|with)\b[\s\S]*\bfrom\b/i.test(e)||/\b(insert\s+into|update\s+\w+\s+set|delete\s+from|create\s+table|alter\s+table|drop\s+table)\b/i.test(e)?"sql":/^\s*[\w-]+\s*:\s*\{[^};]+\}\s*$/m.test(e)?"yaml":/{[^}]*;[^}]*}/m.test(e)?"css":/^\s*<\?xml\b/.test(e)||/<\w+[^>]*\/>/.test(e)?"xml":/<!DOCTYPE\s+html/i.test(e)||/<\s*(html|body|div|span|ul|li|p|head|meta|link|script)\b/i.test(e)?"html":!/[{}<>]/.test(e)&&/\n/.test(e)&&/^(\s*[-\w]+\s*:\s*.+)$/m.test(e)?"yaml":/\barray\s*\(/i.test(e)||/=>/.test(e)||/\[\s*[^\]]*=>/m.test(e)?/=>\s*(string|int|float|array|object)\s*\(/i.test(e)||/\[\s*"?.+?"?\]\s*=>/m.test(e)?"phpVarDump":"phpArray":/(^|[\s\[{(])'(?:[^'\\]|\\.)*'/.test(e)||/\b(True|False|None)\b/.test(e)||/\((?:[^()]*,)[^()]*\)/.test(e)?"pythonRepr":/\/\/|#/.test(e)||/,\s*[\]}]/.test(e)||/(^|[^\\])'(?:[^'\\]|\\.)*'/.test(e)?"jsonish":"unknown"}function w(r){switch(r){case"css":return"structure";case"sql":return"structure";case"html":case"xml":case"yaml":return"structure";case"json":case"jsonish":return"jsonish";case"phpArray":case"phpVarDump":return"phpish";case"pythonRepr":return"structure";case"unknown":default:return"structure"}}function i(r){const e=document.getElementById(r);if(!e)throw new Error(`#${r} not found`);return e}function y(r){const e=i("indent"),t=i("useTabs"),n=m(r),s=w(n),o=Math.max(0,parseInt(e.value||"2",10)),c=!!t.checked;return{options:{mode:s,indent:o,useTabs:c,newlineAfterComma:!0,keepComments:!0,conservative:!1},detected:n}}function p(r,e){const t=i("progressFill"),n=i("progressLabel"),s=e>0?Math.floor(r/e*100):0;t.style.width=`${s}%`,n.textContent=`${s}%`}function g(r){const e=i("output"),t=i("copyBtn");e.textContent=r.output,r.output.trim()?t.style.display="flex":t.style.display="none",p(0,1)}function b(r){const e=i("detectedBadge");e.textContent=r}async function k(){const r=i("input").value,{options:e,detected:t}=y(r);b(t);try{const n=await a.format(r,e,({processed:s,total:o})=>{p(s,o)});g(n)}catch(n){const s=i("output");s.textContent=n instanceof Error?`Error: ${n.message}`:String(n)}}async function v(r){if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(r);else{const e=document.createElement("textarea");e.value=r,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}}async function C(){const r=i("output"),e=i("copyBtn"),t=r.textContent||"";if(t.trim())try{await v(t);const n=e.innerHTML;e.innerHTML=`
      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
      </svg>
      Copied!
    `,e.classList.add("bg-green-100","text-green-700"),e.classList.remove("bg-slate-100","text-slate-700"),setTimeout(()=>{e.innerHTML=n,e.classList.remove("bg-green-100","text-green-700"),e.classList.add("bg-slate-100","text-slate-700")},1500)}catch(n){console.error("Copy failed:",n)}}function l(){a.prewarm(),i("formatBtn").addEventListener("click",n=>{n.preventDefault(),k()}),i("copyBtn").addEventListener("click",n=>{n.preventDefault(),C()});const t=i("input");t.addEventListener("focus",()=>{t.select()})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",l):l();window.addEventListener("beforeunload",()=>a.dispose());
