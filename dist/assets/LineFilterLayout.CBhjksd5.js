import{j as a}from"./jsx-runtime.9DypCmAh.js";import{c as Vs,g as $s,r as F,R as ns}from"./index.eCxJ45ll.js";import{u as se}from"./index.et05KHOM.js";import{a as De,m as os}from"./index.Bda8kKQR.js";const zs=5,Cr=6,Er=10;let Us=(w,l,f,d)=>(w.events=w.events||{},w.events[f+Er]||(w.events[f+Er]=d(j=>{w.events[f].reduceRight((S,E)=>(E(S),S),{shared:{},...j})})),w.events[f]=w.events[f]||[],w.events[f].push(l),()=>{let j=w.events[f],S=j.indexOf(l);j.splice(S,1),j.length||(delete w.events[f],w.events[f+Er](),delete w.events[f+Er])}),Hs=1e3,Ws=(w,l)=>Us(w,d=>{let j=l(d);j&&w.events[Cr].push(j)},zs,d=>{let j=w.listen;w.listen=(...E)=>(!w.lc&&!w.active&&(w.active=!0,d()),j(...E));let S=w.off;return w.events[Cr]=[],w.off=()=>{S(),setTimeout(()=>{if(w.active&&!w.lc){w.active=!1;for(let E of w.events[Cr])E();w.events[Cr]=[]}},Hs)},()=>{w.listen=j,w.off=S}}),Ys=(w,l,f)=>{Array.isArray(w)||(w=[w]);let d,j=0,S=()=>{let B=w.map(q=>q.get());if(d===void 0||B.some((q,W)=>q!==d[W])){let q=++j;d=B;let W=l(...B);W&&W.then&&W.t?W.then(Z=>{q===j&&E.set(Z)}):E.set(W)}},E=De(void 0,Math.max(...w.map(B=>B.l))+1),R=S;return Ws(E,()=>{let B=w.map(q=>q.listen(R,-1/E.l));return S(),()=>{for(let q of B)q()}}),E},Qt=(w,l)=>Ys(w,l);var Sr={exports:{}},Xs=Sr.exports,ss;function Gs(){return ss||(ss=1,function(w,l){(function(f,d){w.exports=d()})(Xs,function(){var f=function(e,t){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=n[s])})(e,t)},d=function(){return(d=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};function j(e,t,r){for(var n,s=0,i=t.length;s<i;s++)!n&&s in t||((n=n||Array.prototype.slice.call(t,0,s))[s]=t[s]);return e.concat(n||Array.prototype.slice.call(t))}var S=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Vs,E=Object.keys,R=Array.isArray;function B(e,t){return typeof t!="object"||E(t).forEach(function(r){e[r]=t[r]}),e}typeof Promise>"u"||S.Promise||(S.Promise=Promise);var q=Object.getPrototypeOf,W={}.hasOwnProperty;function Z(e,t){return W.call(e,t)}function X(e,t){typeof t=="function"&&(t=t(q(e))),(typeof Reflect>"u"?E:Reflect.ownKeys)(t).forEach(function(r){Q(e,r,t[r])})}var K=Object.defineProperty;function Q(e,t,r,n){K(e,t,B(r&&Z(r,"get")&&typeof r.get=="function"?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},n))}function ie(e){return{from:function(t){return e.prototype=Object.create(t.prototype),Q(e.prototype,"constructor",e),{extend:X.bind(null,e.prototype)}}}}var he=Object.getOwnPropertyDescriptor,ae=[].slice;function de(e,t,r){return ae.call(e,t,r)}function ye(e,t){return t(e)}function xe(e){if(!e)throw new Error("Assertion Failed")}function pe(e){S.setImmediate?setImmediate(e):setTimeout(e,0)}function oe(e,t){if(typeof t=="string"&&Z(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var r=[],n=0,s=t.length;n<s;++n){var i=oe(e,t[n]);r.push(i)}return r}var o=t.indexOf(".");if(o!==-1){var c=e[t.substr(0,o)];return c==null?void 0:oe(c,t.substr(o+1))}}function U(e,t,r){if(e&&t!==void 0&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){xe(typeof r!="string"&&"length"in r);for(var n=0,s=t.length;n<s;++n)U(e,t[n],r[n])}else{var i,o,c=t.indexOf(".");c!==-1?(i=t.substr(0,c),(o=t.substr(c+1))===""?r===void 0?R(e)&&!isNaN(parseInt(i))?e.splice(i,1):delete e[i]:e[i]=r:U(c=!(c=e[i])||!Z(e,i)?e[i]={}:c,o,r)):r===void 0?R(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=r}}function te(e){var t,r={};for(t in e)Z(e,t)&&(r[t]=e[t]);return r}var ge=[].concat;function ke(e){return ge.apply([],e)}var pt="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ke([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return S[e]}),Pe=new Set(pt.map(function(e){return S[e]})),ce=null;function z(e){return ce=new WeakMap,e=function t(r){if(!r||typeof r!="object")return r;var n=ce.get(r);if(n)return n;if(R(r)){n=[],ce.set(r,n);for(var s=0,i=r.length;s<i;++s)n.push(t(r[s]))}else if(Pe.has(r.constructor))n=r;else{var o,c=q(r);for(o in n=c===Object.prototype?{}:Object.create(c),ce.set(r,n),r)Z(r,o)&&(n[o]=t(r[o]))}return n}(e),ce=null,e}var T={}.toString;function V(e){return T.call(e).slice(8,-1)}var G=typeof Symbol<"u"?Symbol.iterator:"@@iterator",we=typeof G=="symbol"?function(e){var t;return e!=null&&(t=e[G])&&t.apply(e)}:function(){return null};function Ke(e,t){return t=e.indexOf(t),0<=t&&e.splice(t,1),0<=t}var st={};function Ze(e){var t,r,n,s;if(arguments.length===1){if(R(e))return e.slice();if(this===st&&typeof e=="string")return[e];if(s=we(e)){for(r=[];!(n=s.next()).done;)r.push(n.value);return r}if(e==null)return[e];if(typeof(t=e.length)!="number")return[e];for(r=new Array(t);t--;)r[t]=e[t];return r}for(t=arguments.length,r=new Array(t);t--;)r[t]=arguments[t];return r}var Pr=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Rt=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],ze=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Rt),us={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Nt(e,t){this.name=e,this.message=t}function kn(e,t){return e+". Errors: "+Object.keys(t).map(function(r){return t[r].toString()}).filter(function(r,n,s){return s.indexOf(r)===n}).join(`
`)}function Zt(e,t,r,n){this.failures=t,this.failedKeys=n,this.successCount=r,this.message=kn(e,t)}function Ct(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(r){return t[r]}),this.failuresByPos=t,this.message=kn(e,this.failures)}ie(Nt).from(Error).extend({toString:function(){return this.name+": "+this.message}}),ie(Zt).from(Nt),ie(Ct).from(Nt);var Or=ze.reduce(function(e,t){return e[t]=t+"Error",e},{}),ds=Nt,Y=ze.reduce(function(e,t){var r=t+"Error";function n(s,i){this.name=r,s?typeof s=="string"?(this.message="".concat(s).concat(i?`
 `+i:""),this.inner=i||null):typeof s=="object"&&(this.message="".concat(s.name," ").concat(s.message),this.inner=s):(this.message=us[t]||r,this.inner=null)}return ie(n).from(ds),e[t]=n,e},{});Y.Syntax=SyntaxError,Y.Type=TypeError,Y.Range=RangeError;var jn=Rt.reduce(function(e,t){return e[t+"Error"]=Y[t],e},{}),Jt=ze.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=Y[t]),e},{});function fe(){}function Kt(e){return e}function fs(e,t){return e==null||e===Kt?t:function(r){return t(e(r))}}function ht(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function hs(e,t){return e===fe?t:function(){var r=e.apply(this,arguments);r!==void 0&&(arguments[0]=r);var n=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var i=t.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?ht(n,this.onsuccess):n),s&&(this.onerror=this.onerror?ht(s,this.onerror):s),i!==void 0?i:r}}function ps(e,t){return e===fe?t:function(){e.apply(this,arguments);var r=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?ht(r,this.onsuccess):r),n&&(this.onerror=this.onerror?ht(n,this.onerror):n)}}function ms(e,t){return e===fe?t:function(r){var n=e.apply(this,arguments);B(r,n);var s=this.onsuccess,i=this.onerror;return this.onsuccess=null,this.onerror=null,r=t.apply(this,arguments),s&&(this.onsuccess=this.onsuccess?ht(s,this.onsuccess):s),i&&(this.onerror=this.onerror?ht(i,this.onerror):i),n===void 0?r===void 0?void 0:r:B(n,r)}}function ys(e,t){return e===fe?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function Ar(e,t){return e===fe?t:function(){var r=e.apply(this,arguments);if(r&&typeof r.then=="function"){for(var n=this,s=arguments.length,i=new Array(s);s--;)i[s]=arguments[s];return r.then(function(){return t.apply(n,i)})}return t.apply(this,arguments)}}Jt.ModifyError=Zt,Jt.DexieError=Nt,Jt.BulkError=Ct;var Ye=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function _n(e){Ye=e}var Mt={},Nn=100,pt=typeof Promise>"u"?[]:function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,q(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,q(t),e]}(),Rt=pt[0],ze=pt[1],pt=pt[2],ze=ze&&ze.then,mt=Rt&&Rt.constructor,Lr=!!pt,Bt=function(e,t){qt.push([e,t]),er&&(queueMicrotask(vs),er=!1)},Tr=!0,er=!0,yt=[],tr=[],Ir=Kt,it={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:fe,pgp:!1,env:{},finalize:fe},H=it,qt=[],gt=0,rr=[];function M(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=H;if(typeof e!="function"){if(e!==Mt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Mr(this,this._value))}this._state=null,this._value=null,++t.ref,function r(n,s){try{s(function(i){if(n._state===null){if(i===n)throw new TypeError("A promise cannot be resolved with itself.");var o=n._lib&&Et();i&&typeof i.then=="function"?r(n,function(c,h){i instanceof M?i._then(c,h):i.then(c,h)}):(n._state=!0,n._value=i,En(n)),o&&St()}},Mr.bind(null,n))}catch(i){Mr(n,i)}}(this,e)}var Kr={get:function(){var e=H,t=ar;function r(n,s){var i=this,o=!e.global&&(e!==H||t!==ar),c=o&&!ot(),h=new M(function(m,v){Rr(i,new Cn(Fn(n,e,o,c),Fn(s,e,o,c),m,v,e))});return this._consoleTask&&(h._consoleTask=this._consoleTask),h}return r.prototype=Mt,r},set:function(e){Q(this,"then",e&&e.prototype===Mt?Kr:{get:function(){return e},set:Kr.set})}};function Cn(e,t,r,n,s){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=r,this.reject=n,this.psd=s}function Mr(e,t){var r,n;tr.push(t),e._state===null&&(r=e._lib&&Et(),t=Ir(t),e._state=!1,e._value=t,n=e,yt.some(function(s){return s._value===n._value})||yt.push(n),En(e),r&&St())}function En(e){var t=e._listeners;e._listeners=[];for(var r=0,n=t.length;r<n;++r)Rr(e,t[r]);var s=e._PSD;--s.ref||s.finalize(),gt===0&&(++gt,Bt(function(){--gt==0&&Br()},[]))}function Rr(e,t){if(e._state!==null){var r=e._state?t.onFulfilled:t.onRejected;if(r===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++gt,Bt(gs,[r,e,t])}else e._listeners.push(t)}function gs(e,t,r){try{var n,s=t._value;!t._state&&tr.length&&(tr=[]),n=Ye&&t._consoleTask?t._consoleTask.run(function(){return e(s)}):e(s),t._state||tr.indexOf(s)!==-1||function(i){for(var o=yt.length;o;)if(yt[--o]._value===i._value)return yt.splice(o,1)}(t),r.resolve(n)}catch(i){r.reject(i)}finally{--gt==0&&Br(),--r.psd.ref||r.psd.finalize()}}function vs(){vt(it,function(){Et()&&St()})}function Et(){var e=Tr;return er=Tr=!1,e}function St(){var e,t,r;do for(;0<qt.length;)for(e=qt,qt=[],r=e.length,t=0;t<r;++t){var n=e[t];n[0].apply(null,n[1])}while(0<qt.length);er=Tr=!0}function Br(){var e=yt;yt=[],e.forEach(function(n){n._PSD.onunhandled.call(null,n._value,n)});for(var t=rr.slice(0),r=t.length;r;)t[--r]()}function nr(e){return new M(Mt,!1,e)}function ve(e,t){var r=H;return function(){var n=Et(),s=H;try{return lt(r,!0),e.apply(this,arguments)}catch(i){t&&t(i)}finally{lt(s,!1),n&&St()}}}X(M.prototype,{then:Kr,_then:function(e,t){Rr(this,new Cn(null,null,e,t,H))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=e,r=arguments[1];return typeof t=="function"?this.then(null,function(n){return(n instanceof t?r:nr)(n)}):this.then(null,function(n){return(n&&n.name===t?r:nr)(n)})},finally:function(e){return this.then(function(t){return M.resolve(e()).then(function(){return t})},function(t){return M.resolve(e()).then(function(){return nr(t)})})},timeout:function(e,t){var r=this;return e<1/0?new M(function(n,s){var i=setTimeout(function(){return s(new Y.Timeout(t))},e);r.then(n,s).finally(clearTimeout.bind(null,i))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&Q(M.prototype,Symbol.toStringTag,"Dexie.Promise"),it.env=Sn(),X(M,{all:function(){var e=Ze.apply(null,arguments).map(or);return new M(function(t,r){e.length===0&&t([]);var n=e.length;e.forEach(function(s,i){return M.resolve(s).then(function(o){e[i]=o,--n||t(e)},r)})})},resolve:function(e){return e instanceof M?e:e&&typeof e.then=="function"?new M(function(t,r){e.then(t,r)}):new M(Mt,!0,e)},reject:nr,race:function(){var e=Ze.apply(null,arguments).map(or);return new M(function(t,r){e.map(function(n){return M.resolve(n).then(t,r)})})},PSD:{get:function(){return H},set:function(e){return H=e}},totalEchoes:{get:function(){return ar}},newPSD:at,usePSD:vt,scheduler:{get:function(){return Bt},set:function(e){Bt=e}},rejectionMapper:{get:function(){return Ir},set:function(e){Ir=e}},follow:function(e,t){return new M(function(r,n){return at(function(s,i){var o=H;o.unhandleds=[],o.onunhandled=i,o.finalize=ht(function(){var c,h=this;c=function(){h.unhandleds.length===0?s():i(h.unhandleds[0])},rr.push(function m(){c(),rr.splice(rr.indexOf(m),1)}),++gt,Bt(function(){--gt==0&&Br()},[])},o.finalize),e()},t,r,n)})}}),mt&&(mt.allSettled&&Q(M,"allSettled",function(){var e=Ze.apply(null,arguments).map(or);return new M(function(t){e.length===0&&t([]);var r=e.length,n=new Array(r);e.forEach(function(s,i){return M.resolve(s).then(function(o){return n[i]={status:"fulfilled",value:o}},function(o){return n[i]={status:"rejected",reason:o}}).then(function(){return--r||t(n)})})})}),mt.any&&typeof AggregateError<"u"&&Q(M,"any",function(){var e=Ze.apply(null,arguments).map(or);return new M(function(t,r){e.length===0&&r(new AggregateError([]));var n=e.length,s=new Array(n);e.forEach(function(i,o){return M.resolve(i).then(function(c){return t(c)},function(c){s[o]=c,--n||r(new AggregateError(s))})})})}),mt.withResolvers&&(M.withResolvers=mt.withResolvers));var Se={awaits:0,echoes:0,id:0},bs=0,sr=[],ir=0,ar=0,xs=0;function at(e,t,r,n){var s=H,i=Object.create(s);return i.parent=s,i.ref=0,i.global=!1,i.id=++xs,it.env,i.env=Lr?{Promise:M,PromiseProp:{value:M,configurable:!0,writable:!0},all:M.all,race:M.race,allSettled:M.allSettled,any:M.any,resolve:M.resolve,reject:M.reject}:{},t&&B(i,t),++s.ref,i.finalize=function(){--this.parent.ref||this.parent.finalize()},n=vt(i,e,r,n),i.ref===0&&i.finalize(),n}function Ft(){return Se.id||(Se.id=++bs),++Se.awaits,Se.echoes+=Nn,Se.id}function ot(){return!!Se.awaits&&(--Se.awaits==0&&(Se.id=0),Se.echoes=Se.awaits*Nn,!0)}function or(e){return Se.echoes&&e&&e.constructor===mt?(Ft(),e.then(function(t){return ot(),t},function(t){return ot(),_e(t)})):e}function ws(){var e=sr[sr.length-1];sr.pop(),lt(e,!1)}function lt(e,t){var r,n=H;(t?!Se.echoes||ir++&&e===H:!ir||--ir&&e===H)||queueMicrotask(t?function(s){++ar,Se.echoes&&--Se.echoes!=0||(Se.echoes=Se.awaits=Se.id=0),sr.push(H),lt(s,!0)}.bind(null,e):ws),e!==H&&(H=e,n===it&&(it.env=Sn()),Lr&&(r=it.env.Promise,t=e.env,(n.global||e.global)&&(Object.defineProperty(S,"Promise",t.PromiseProp),r.all=t.all,r.race=t.race,r.resolve=t.resolve,r.reject=t.reject,t.allSettled&&(r.allSettled=t.allSettled),t.any&&(r.any=t.any))))}function Sn(){var e=S.Promise;return Lr?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(S,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function vt(e,t,r,n,s){var i=H;try{return lt(e,!0),t(r,n,s)}finally{lt(i,!1)}}function Fn(e,t,r,n){return typeof e!="function"?e:function(){var s=H;r&&Ft(),lt(t,!0);try{return e.apply(this,arguments)}finally{lt(s,!1),n&&queueMicrotask(ot)}}}function qr(e){Promise===mt&&Se.echoes===0?ir===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(""+ze).indexOf("[native code]")===-1&&(Ft=ot=fe);var _e=M.reject,bt="ï¿¿",Je="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Dn="String expected.",Dt=[],lr="__dbnames",Vr="readonly",$r="readwrite";function xt(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var Pn={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function cr(e){return typeof e!="string"||/\./.test(e)?function(t){return t}:function(t){return t[e]===void 0&&e in t&&delete(t=z(t))[e],t}}function On(){throw Y.Type()}function le(e,t){try{var r=An(e),n=An(t);if(r!==n)return r==="Array"?1:n==="Array"?-1:r==="binary"?1:n==="binary"?-1:r==="string"?1:n==="string"?-1:r==="Date"?1:n!=="Date"?NaN:-1;switch(r){case"number":case"Date":case"string":return t<e?1:e<t?-1:0;case"binary":return function(s,i){for(var o=s.length,c=i.length,h=o<c?o:c,m=0;m<h;++m)if(s[m]!==i[m])return s[m]<i[m]?-1:1;return o===c?0:o<c?-1:1}(Ln(e),Ln(t));case"Array":return function(s,i){for(var o=s.length,c=i.length,h=o<c?o:c,m=0;m<h;++m){var v=le(s[m],i[m]);if(v!==0)return v}return o===c?0:o<c?-1:1}(e,t)}}catch{}return NaN}function An(e){var t=typeof e;return t!="object"?t:ArrayBuffer.isView(e)?"binary":(e=V(e),e==="ArrayBuffer"?"binary":e)}function Ln(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var Tn=(me.prototype._trans=function(e,t,r){var n=this._tx||H.trans,s=this.name,i=Ye&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(e==="readonly"?"read":"write"," ").concat(this.name));function o(m,v,u){if(!u.schema[s])throw new Y.NotFound("Table "+s+" not part of transaction");return t(u.idbtrans,u)}var c=Et();try{var h=n&&n.db._novip===this.db._novip?n===H.trans?n._promise(e,o,r):at(function(){return n._promise(e,o,r)},{trans:n,transless:H.transless||H}):function m(v,u,x,p){if(v.idbdb&&(v._state.openComplete||H.letThrough||v._vip)){var g=v._createTransaction(u,x,v._dbSchema);try{g.create(),v._state.PR1398_maxLoop=3}catch(b){return b.name===Or.InvalidState&&v.isOpen()&&0<--v._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),v.close({disableAutoOpen:!1}),v.open().then(function(){return m(v,u,x,p)})):_e(b)}return g._promise(u,function(b,y){return at(function(){return H.trans=g,p(b,y,g)})}).then(function(b){if(u==="readwrite")try{g.idbtrans.commit()}catch{}return u==="readonly"?b:g._completion.then(function(){return b})})}if(v._state.openComplete)return _e(new Y.DatabaseClosed(v._state.dbOpenError));if(!v._state.isBeingOpened){if(!v._state.autoOpen)return _e(new Y.DatabaseClosed);v.open().catch(fe)}return v._state.dbReadyPromise.then(function(){return m(v,u,x,p)})}(this.db,e,[this.name],o);return i&&(h._consoleTask=i,h=h.catch(function(m){return console.trace(m),_e(m)})),h}finally{c&&St()}},me.prototype.get=function(e,t){var r=this;return e&&e.constructor===Object?this.where(e).first(t):e==null?_e(new Y.Type("Invalid argument to Table.get()")):this._trans("readonly",function(n){return r.core.get({trans:n,key:e}).then(function(s){return r.hook.reading.fire(s)})}).then(t)},me.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(R(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=E(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(c){if(c.compound&&t.every(function(m){return 0<=c.keyPath.indexOf(m)})){for(var h=0;h<t.length;++h)if(t.indexOf(c.keyPath[h])===-1)return!1;return!0}return!1}).sort(function(c,h){return c.keyPath.length-h.keyPath.length})[0];if(r&&this.db._maxKey!==bt){var i=r.keyPath.slice(0,t.length);return this.where(i).equals(i.map(function(h){return e[h]}))}!r&&Ye&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var n=this.schema.idxByName;function s(c,h){return le(c,h)===0}var o=t.reduce(function(u,h){var m=u[0],v=u[1],u=n[h],x=e[h];return[m||u,m||!u?xt(v,u&&u.multi?function(p){return p=oe(p,h),R(p)&&p.some(function(g){return s(x,g)})}:function(p){return s(x,oe(p,h))}):v]},[null,null]),i=o[0],o=o[1];return i?this.where(i.name).equals(e[i.keyPath]).filter(o):r?this.filter(o):this.where(t).equals("")},me.prototype.filter=function(e){return this.toCollection().and(e)},me.prototype.count=function(e){return this.toCollection().count(e)},me.prototype.offset=function(e){return this.toCollection().offset(e)},me.prototype.limit=function(e){return this.toCollection().limit(e)},me.prototype.each=function(e){return this.toCollection().each(e)},me.prototype.toArray=function(e){return this.toCollection().toArray(e)},me.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},me.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,R(e)?"[".concat(e.join("+"),"]"):e))},me.prototype.reverse=function(){return this.toCollection().reverse()},me.prototype.mapToClass=function(e){var t,r=this.db,n=this.name;function s(){return t!==null&&t.apply(this,arguments)||this}(this.schema.mappedClass=e).prototype instanceof On&&(function(h,m){if(typeof m!="function"&&m!==null)throw new TypeError("Class extends value "+String(m)+" is not a constructor or null");function v(){this.constructor=h}f(h,m),h.prototype=m===null?Object.create(m):(v.prototype=m.prototype,new v)}(s,t=e),Object.defineProperty(s.prototype,"db",{get:function(){return r},enumerable:!1,configurable:!0}),s.prototype.table=function(){return n},e=s);for(var i=new Set,o=e.prototype;o;o=q(o))Object.getOwnPropertyNames(o).forEach(function(h){return i.add(h)});function c(h){if(!h)return h;var m,v=Object.create(e.prototype);for(m in h)if(!i.has(m))try{v[m]=h[m]}catch{}return v}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=c,this.hook("reading",c),e},me.prototype.defineClass=function(){return this.mapToClass(function(e){B(this,e)})},me.prototype.add=function(e,t){var r=this,n=this.schema.primKey,s=n.auto,i=n.keyPath,o=e;return i&&s&&(o=cr(i)(e)),this._trans("readwrite",function(c){return r.core.mutate({trans:c,type:"add",keys:t!=null?[t]:null,values:[o]})}).then(function(c){return c.numFailures?M.reject(c.failures[0]):c.lastResult}).then(function(c){if(i)try{U(e,i,c)}catch{}return c})},me.prototype.update=function(e,t){return typeof e!="object"||R(e)?this.where(":id").equals(e).modify(t):(e=oe(e,this.schema.primKey.keyPath),e===void 0?_e(new Y.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(t))},me.prototype.put=function(e,t){var r=this,n=this.schema.primKey,s=n.auto,i=n.keyPath,o=e;return i&&s&&(o=cr(i)(e)),this._trans("readwrite",function(c){return r.core.mutate({trans:c,type:"put",values:[o],keys:t!=null?[t]:null})}).then(function(c){return c.numFailures?M.reject(c.failures[0]):c.lastResult}).then(function(c){if(i)try{U(e,i,c)}catch{}return c})},me.prototype.delete=function(e){var t=this;return this._trans("readwrite",function(r){return t.core.mutate({trans:r,type:"delete",keys:[e]})}).then(function(r){return r.numFailures?M.reject(r.failures[0]):void 0})},me.prototype.clear=function(){var e=this;return this._trans("readwrite",function(t){return e.core.mutate({trans:t,type:"deleteRange",range:Pn})}).then(function(t){return t.numFailures?M.reject(t.failures[0]):void 0})},me.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",function(r){return t.core.getMany({keys:e,trans:r}).then(function(n){return n.map(function(s){return t.hook.reading.fire(s)})})})},me.prototype.bulkAdd=function(e,t,r){var n=this,s=Array.isArray(t)?t:void 0,i=(r=r||(s?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",function(o){var m=n.schema.primKey,c=m.auto,m=m.keyPath;if(m&&s)throw new Y.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new Y.InvalidArgument("Arguments objects and keys must have the same length");var h=e.length,m=m&&c?e.map(cr(m)):e;return n.core.mutate({trans:o,type:"add",keys:s,values:m,wantResults:i}).then(function(g){var u=g.numFailures,x=g.results,p=g.lastResult,g=g.failures;if(u===0)return i?x:p;throw new Ct("".concat(n.name,".bulkAdd(): ").concat(u," of ").concat(h," operations failed"),g)})})},me.prototype.bulkPut=function(e,t,r){var n=this,s=Array.isArray(t)?t:void 0,i=(r=r||(s?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",function(o){var m=n.schema.primKey,c=m.auto,m=m.keyPath;if(m&&s)throw new Y.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new Y.InvalidArgument("Arguments objects and keys must have the same length");var h=e.length,m=m&&c?e.map(cr(m)):e;return n.core.mutate({trans:o,type:"put",keys:s,values:m,wantResults:i}).then(function(g){var u=g.numFailures,x=g.results,p=g.lastResult,g=g.failures;if(u===0)return i?x:p;throw new Ct("".concat(n.name,".bulkPut(): ").concat(u," of ").concat(h," operations failed"),g)})})},me.prototype.bulkUpdate=function(e){var t=this,r=this.core,n=e.map(function(o){return o.key}),s=e.map(function(o){return o.changes}),i=[];return this._trans("readwrite",function(o){return r.getMany({trans:o,keys:n,cache:"clone"}).then(function(c){var h=[],m=[];e.forEach(function(u,x){var p=u.key,g=u.changes,b=c[x];if(b){for(var y=0,k=Object.keys(g);y<k.length;y++){var _=k[y],N=g[_];if(_===t.schema.primKey.keyPath){if(le(N,p)!==0)throw new Y.Constraint("Cannot update primary key in bulkUpdate()")}else U(b,_,N)}i.push(x),h.push(p),m.push(b)}});var v=h.length;return r.mutate({trans:o,type:"put",keys:h,values:m,updates:{keys:n,changeSpecs:s}}).then(function(u){var x=u.numFailures,p=u.failures;if(x===0)return v;for(var g=0,b=Object.keys(p);g<b.length;g++){var y,k=b[g],_=i[Number(k)];_!=null&&(y=p[k],delete p[k],p[_]=y)}throw new Ct("".concat(t.name,".bulkUpdate(): ").concat(x," of ").concat(v," operations failed"),p)})})})},me.prototype.bulkDelete=function(e){var t=this,r=e.length;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"delete",keys:e})}).then(function(o){var s=o.numFailures,i=o.lastResult,o=o.failures;if(s===0)return i;throw new Ct("".concat(t.name,".bulkDelete(): ").concat(s," of ").concat(r," operations failed"),o)})},me);function me(){}function Vt(e){function t(o,c){if(c){for(var h=arguments.length,m=new Array(h-1);--h;)m[h-1]=arguments[h];return r[o].subscribe.apply(null,m),e}if(typeof o=="string")return r[o]}var r={};t.addEventType=i;for(var n=1,s=arguments.length;n<s;++n)i(arguments[n]);return t;function i(o,c,h){if(typeof o!="object"){var m;c=c||ys;var v={subscribers:[],fire:h=h||fe,subscribe:function(u){v.subscribers.indexOf(u)===-1&&(v.subscribers.push(u),v.fire=c(v.fire,u))},unsubscribe:function(u){v.subscribers=v.subscribers.filter(function(x){return x!==u}),v.fire=v.subscribers.reduce(c,h)}};return r[o]=t[o]=v}E(m=o).forEach(function(u){var x=m[u];if(R(x))i(u,m[u][0],m[u][1]);else{if(x!=="asap")throw new Y.InvalidArgument("Invalid event config");var p=i(u,Kt,function(){for(var g=arguments.length,b=new Array(g);g--;)b[g]=arguments[g];p.subscribers.forEach(function(y){pe(function(){y.apply(null,b)})})})}})}}function $t(e,t){return ie(t).from({prototype:e}),t}function Pt(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function zr(e,t){e.filter=xt(e.filter,t)}function Ur(e,t,r){var n=e.replayFilter;e.replayFilter=n?function(){return xt(n(),t())}:t,e.justLimit=r&&!n}function ur(e,t){if(e.isPrimKey)return t.primaryKey;var r=t.getIndexByKeyPath(e.index);if(!r)throw new Y.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return r}function In(e,t,r){var n=ur(e,t.schema);return t.openCursor({trans:r,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:n,range:e.range}})}function dr(e,t,r,n){var s=e.replayFilter?xt(e.filter,e.replayFilter()):e.filter;if(e.or){var i={},o=function(c,h,m){var v,u;s&&!s(h,m,function(x){return h.stop(x)},function(x){return h.fail(x)})||((u=""+(v=h.primaryKey))=="[object ArrayBuffer]"&&(u=""+new Uint8Array(v)),Z(i,u)||(i[u]=!0,t(c,h,m)))};return Promise.all([e.or._iterate(o,r),Kn(In(e,n,r),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}return Kn(In(e,n,r),xt(e.algorithm,s),t,!e.keysOnly&&e.valueMapper)}function Kn(e,t,r,n){var s=ve(n?function(i,o,c){return r(n(i),o,c)}:r);return e.then(function(i){if(i)return i.start(function(){var o=function(){return i.continue()};t&&!t(i,function(c){return o=c},function(c){i.stop(c),o=fe},function(c){i.fail(c),o=fe})||s(i.value,i,function(c){return o=c}),o()})})}var zt=(Mn.prototype.execute=function(e){var t=this["@@propmod"];if(t.add!==void 0){var r=t.add;if(R(r))return j(j([],R(e)?e:[],!0),r).sort();if(typeof r=="number")return(Number(e)||0)+r;if(typeof r=="bigint")try{return BigInt(e)+r}catch{return BigInt(0)+r}throw new TypeError("Invalid term ".concat(r))}if(t.remove!==void 0){var n=t.remove;if(R(n))return R(e)?e.filter(function(s){return!n.includes(s)}).sort():[];if(typeof n=="number")return Number(e)-n;if(typeof n=="bigint")try{return BigInt(e)-n}catch{return BigInt(0)-n}throw new TypeError("Invalid subtrahend ".concat(n))}return r=(r=t.replacePrefix)===null||r===void 0?void 0:r[0],r&&typeof e=="string"&&e.startsWith(r)?t.replacePrefix[1]+e.substring(r.length):e},Mn);function Mn(e){this["@@propmod"]=e}var ks=(ue.prototype._read=function(e,t){var r=this._ctx;return r.error?r.table._trans(null,_e.bind(null,r.error)):r.table._trans("readonly",e).then(t)},ue.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,_e.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},ue.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=xt(t.algorithm,e)},ue.prototype._iterate=function(e,t){return dr(this._ctx,e,t,this._ctx.table.core)},ue.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&B(r,e),t._ctx=r,t},ue.prototype.raw=function(){return this._ctx.valueMapper=null,this},ue.prototype.each=function(e){var t=this._ctx;return this._read(function(r){return dr(t,e,r,t.table.core)})},ue.prototype.count=function(e){var t=this;return this._read(function(r){var n=t._ctx,s=n.table.core;if(Pt(n,!0))return s.count({trans:r,query:{index:ur(n,s.schema),range:n.range}}).then(function(o){return Math.min(o,n.limit)});var i=0;return dr(n,function(){return++i,!1},r,s).then(function(){return i})}).then(e)},ue.prototype.sortBy=function(e,t){var r=e.split(".").reverse(),n=r[0],s=r.length-1;function i(h,m){return m?i(h[r[m]],m-1):h[n]}var o=this._ctx.dir==="next"?1:-1;function c(h,m){return le(i(h,s),i(m,s))*o}return this.toArray(function(h){return h.sort(c)}).then(t)},ue.prototype.toArray=function(e){var t=this;return this._read(function(r){var n=t._ctx;if(n.dir==="next"&&Pt(n,!0)&&0<n.limit){var s=n.valueMapper,i=ur(n,n.table.core.schema);return n.table.core.query({trans:r,limit:n.limit,values:!0,query:{index:i,range:n.range}}).then(function(c){return c=c.result,s?c.map(s):c})}var o=[];return dr(n,function(c){return o.push(c)},r,n.table.core).then(function(){return o})},e)},ue.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,Pt(t)?Ur(t,function(){var r=e;return function(n,s){return r===0||(r===1?--r:s(function(){n.advance(r),r=0}),!1)}}):Ur(t,function(){var r=e;return function(){return--r<0}})),this},ue.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Ur(this._ctx,function(){var t=e;return function(r,n,s){return--t<=0&&n(s),0<=t}},!0),this},ue.prototype.until=function(e,t){return zr(this._ctx,function(r,n,s){return!e(r.value)||(n(s),t)}),this},ue.prototype.first=function(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)},ue.prototype.last=function(e){return this.reverse().first(e)},ue.prototype.filter=function(e){var t;return zr(this._ctx,function(r){return e(r.value)}),(t=this._ctx).isMatch=xt(t.isMatch,e),this},ue.prototype.and=function(e){return this.filter(e)},ue.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},ue.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},ue.prototype.desc=function(){return this.reverse()},ue.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,n){e(n.key,n)})},ue.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},ue.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,n){e(n.primaryKey,n)})},ue.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var r=[];return this.each(function(n,s){r.push(s.key)}).then(function(){return r}).then(e)},ue.prototype.primaryKeys=function(e){var t=this._ctx;if(t.dir==="next"&&Pt(t,!0)&&0<t.limit)return this._read(function(n){var s=ur(t,t.table.core.schema);return t.table.core.query({trans:n,values:!1,limit:t.limit,query:{index:s,range:t.range}})}).then(function(n){return n.result}).then(e);t.keysOnly=!t.isMatch;var r=[];return this.each(function(n,s){r.push(s.primaryKey)}).then(function(){return r}).then(e)},ue.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},ue.prototype.firstKey=function(e){return this.limit(1).keys(function(t){return t[0]}).then(e)},ue.prototype.lastKey=function(e){return this.reverse().firstKey(e)},ue.prototype.distinct=function(){var e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];if(!e||!e.multi)return this;var t={};return zr(this._ctx,function(s){var n=s.primaryKey.toString(),s=Z(t,n);return t[n]=!0,!s}),this},ue.prototype.modify=function(e){var t=this,r=this._ctx;return this._write(function(n){var s,i,o;o=typeof e=="function"?e:(s=E(e),i=s.length,function(y){for(var k=!1,_=0;_<i;++_){var N=s[_],C=e[N],D=oe(y,N);C instanceof zt?(U(y,N,C.execute(D)),k=!0):D!==C&&(U(y,N,C),k=!0)}return k});var c=r.table.core,u=c.schema.primaryKey,h=u.outbound,m=u.extractKey,v=200,u=t.db._options.modifyChunkSize;u&&(v=typeof u=="object"?u[c.name]||u["*"]||200:u);function x(y,N){var _=N.failures,N=N.numFailures;g+=y-N;for(var C=0,D=E(_);C<D.length;C++){var L=D[C];p.push(_[L])}}var p=[],g=0,b=[];return t.clone().primaryKeys().then(function(y){function k(N){var C=Math.min(v,y.length-N);return c.getMany({trans:n,keys:y.slice(N,N+C),cache:"immutable"}).then(function(D){for(var L=[],P=[],O=h?[]:null,I=[],A=0;A<C;++A){var $=D[A],ee={value:z($),primKey:y[N+A]};o.call(ee,ee.value,ee)!==!1&&(ee.value==null?I.push(y[N+A]):h||le(m($),m(ee.value))===0?(P.push(ee.value),h&&O.push(y[N+A])):(I.push(y[N+A]),L.push(ee.value)))}return Promise.resolve(0<L.length&&c.mutate({trans:n,type:"add",values:L}).then(function(re){for(var ne in re.failures)I.splice(parseInt(ne),1);x(L.length,re)})).then(function(){return(0<P.length||_&&typeof e=="object")&&c.mutate({trans:n,type:"put",keys:O,values:P,criteria:_,changeSpec:typeof e!="function"&&e,isAdditionalChunk:0<N}).then(function(re){return x(P.length,re)})}).then(function(){return(0<I.length||_&&e===Hr)&&c.mutate({trans:n,type:"delete",keys:I,criteria:_,isAdditionalChunk:0<N}).then(function(re){return x(I.length,re)})}).then(function(){return y.length>N+C&&k(N+v)})})}var _=Pt(r)&&r.limit===1/0&&(typeof e!="function"||e===Hr)&&{index:r.index,range:r.range};return k(0).then(function(){if(0<p.length)throw new Zt("Error modifying one or more objects",p,g,b);return y.length})})})},ue.prototype.delete=function(){var e=this._ctx,t=e.range;return Pt(e)&&(e.isPrimKey||t.type===3)?this._write(function(r){var n=e.table.core.schema.primaryKey,s=t;return e.table.core.count({trans:r,query:{index:n,range:s}}).then(function(i){return e.table.core.mutate({trans:r,type:"deleteRange",range:s}).then(function(o){var c=o.failures;if(o.lastResult,o.results,o=o.numFailures,o)throw new Zt("Could not delete some values",Object.keys(c).map(function(h){return c[h]}),i-o);return i-o})})}):this.modify(Hr)},ue);function ue(){}var Hr=function(e,t){return t.value=null};function js(e,t){return e<t?-1:e===t?0:1}function _s(e,t){return t<e?-1:e===t?0:1}function qe(e,t,r){return e=e instanceof Bn?new e.Collection(e):e,e._ctx.error=new(r||TypeError)(t),e}function Ot(e){return new e.Collection(e,function(){return Rn("")}).limit(0)}function fr(e,t,r,n){var s,i,o,c,h,m,v,u=r.length;if(!r.every(function(g){return typeof g=="string"}))return qe(e,Dn);function x(g){s=g==="next"?function(y){return y.toUpperCase()}:function(y){return y.toLowerCase()},i=g==="next"?function(y){return y.toLowerCase()}:function(y){return y.toUpperCase()},o=g==="next"?js:_s;var b=r.map(function(y){return{lower:i(y),upper:s(y)}}).sort(function(y,k){return o(y.lower,k.lower)});c=b.map(function(y){return y.upper}),h=b.map(function(y){return y.lower}),v=(m=g)==="next"?"":n}x("next"),e=new e.Collection(e,function(){return ct(c[0],h[u-1]+n)}),e._ondirectionchange=function(g){x(g)};var p=0;return e._addAlgorithm(function(g,b,y){var k=g.key;if(typeof k!="string")return!1;var _=i(k);if(t(_,h,p))return!0;for(var N=null,C=p;C<u;++C){var D=function(L,P,O,I,A,$){for(var ee=Math.min(L.length,I.length),re=-1,ne=0;ne<ee;++ne){var Ve=P[ne];if(Ve!==I[ne])return A(L[ne],O[ne])<0?L.substr(0,ne)+O[ne]+O.substr(ne+1):A(L[ne],I[ne])<0?L.substr(0,ne)+I[ne]+O.substr(ne+1):0<=re?L.substr(0,re)+P[re]+O.substr(re+1):null;A(L[ne],Ve)<0&&(re=ne)}return ee<I.length&&$==="next"?L+O.substr(L.length):ee<L.length&&$==="prev"?L.substr(0,O.length):re<0?null:L.substr(0,re)+I[re]+O.substr(re+1)}(k,_,c[C],h[C],o,m);D===null&&N===null?p=C+1:(N===null||0<o(N,D))&&(N=D)}return b(N!==null?function(){g.continue(N+v)}:y),!1}),e}function ct(e,t,r,n){return{type:2,lower:e,upper:t,lowerOpen:r,upperOpen:n}}function Rn(e){return{type:1,lower:e,upper:e}}var Bn=(Object.defineProperty(Fe.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Fe.prototype.between=function(e,t,r,n){r=r!==!1,n=n===!0;try{return 0<this._cmp(e,t)||this._cmp(e,t)===0&&(r||n)&&(!r||!n)?Ot(this):new this.Collection(this,function(){return ct(e,t,!r,!n)})}catch{return qe(this,Je)}},Fe.prototype.equals=function(e){return e==null?qe(this,Je):new this.Collection(this,function(){return Rn(e)})},Fe.prototype.above=function(e){return e==null?qe(this,Je):new this.Collection(this,function(){return ct(e,void 0,!0)})},Fe.prototype.aboveOrEqual=function(e){return e==null?qe(this,Je):new this.Collection(this,function(){return ct(e,void 0,!1)})},Fe.prototype.below=function(e){return e==null?qe(this,Je):new this.Collection(this,function(){return ct(void 0,e,!1,!0)})},Fe.prototype.belowOrEqual=function(e){return e==null?qe(this,Je):new this.Collection(this,function(){return ct(void 0,e)})},Fe.prototype.startsWith=function(e){return typeof e!="string"?qe(this,Dn):this.between(e,e+bt,!0,!0)},Fe.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):fr(this,function(t,r){return t.indexOf(r[0])===0},[e],bt)},Fe.prototype.equalsIgnoreCase=function(e){return fr(this,function(t,r){return t===r[0]},[e],"")},Fe.prototype.anyOfIgnoreCase=function(){var e=Ze.apply(st,arguments);return e.length===0?Ot(this):fr(this,function(t,r){return r.indexOf(t)!==-1},e,"")},Fe.prototype.startsWithAnyOfIgnoreCase=function(){var e=Ze.apply(st,arguments);return e.length===0?Ot(this):fr(this,function(t,r){return r.some(function(n){return t.indexOf(n)===0})},e,bt)},Fe.prototype.anyOf=function(){var e=this,t=Ze.apply(st,arguments),r=this._cmp;try{t.sort(r)}catch{return qe(this,Je)}if(t.length===0)return Ot(this);var n=new this.Collection(this,function(){return ct(t[0],t[t.length-1])});n._ondirectionchange=function(i){r=i==="next"?e._ascending:e._descending,t.sort(r)};var s=0;return n._addAlgorithm(function(i,o,c){for(var h=i.key;0<r(h,t[s]);)if(++s===t.length)return o(c),!1;return r(h,t[s])===0||(o(function(){i.continue(t[s])}),!1)}),n},Fe.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Fe.prototype.noneOf=function(){var e=Ze.apply(st,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return qe(this,Je)}var t=e.reduce(function(r,n){return r?r.concat([[r[r.length-1][1],n]]):[[-1/0,n]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},Fe.prototype.inAnyRange=function(k,t){var r=this,n=this._cmp,s=this._ascending,i=this._descending,o=this._min,c=this._max;if(k.length===0)return Ot(this);if(!k.every(function(_){return _[0]!==void 0&&_[1]!==void 0&&s(_[0],_[1])<=0}))return qe(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Y.InvalidArgument);var h=!t||t.includeLowers!==!1,m=t&&t.includeUppers===!0,v,u=s;function x(_,N){return u(_[0],N[0])}try{(v=k.reduce(function(_,N){for(var C=0,D=_.length;C<D;++C){var L=_[C];if(n(N[0],L[1])<0&&0<n(N[1],L[0])){L[0]=o(L[0],N[0]),L[1]=c(L[1],N[1]);break}}return C===D&&_.push(N),_},[])).sort(x)}catch{return qe(this,Je)}var p=0,g=m?function(_){return 0<s(_,v[p][1])}:function(_){return 0<=s(_,v[p][1])},b=h?function(_){return 0<i(_,v[p][0])}:function(_){return 0<=i(_,v[p][0])},y=g,k=new this.Collection(this,function(){return ct(v[0][0],v[v.length-1][1],!h,!m)});return k._ondirectionchange=function(_){u=_==="next"?(y=g,s):(y=b,i),v.sort(x)},k._addAlgorithm(function(_,N,C){for(var D,L=_.key;y(L);)if(++p===v.length)return N(C),!1;return!g(D=L)&&!b(D)||(r._cmp(L,v[p][1])===0||r._cmp(L,v[p][0])===0||N(function(){u===s?_.continue(v[p][0]):_.continue(v[p][1])}),!1)}),k},Fe.prototype.startsWithAnyOf=function(){var e=Ze.apply(st,arguments);return e.every(function(t){return typeof t=="string"})?e.length===0?Ot(this):this.inAnyRange(e.map(function(t){return[t,t+bt]})):qe(this,"startsWithAnyOf() only works with strings")},Fe);function Fe(){}function Xe(e){return ve(function(t){return Ut(t),e(t.target.error),!1})}function Ut(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var Ht="storagemutated",Wr="x-storagemutated-1",ut=Vt(null,Ht),Ns=(Ge.prototype._lock=function(){return xe(!H.global),++this._reculock,this._reculock!==1||H.global||(H.lockOwnerFor=this),this},Ge.prototype._unlock=function(){if(xe(!H.global),--this._reculock==0)for(H.global||(H.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{vt(e[1],e[0])}catch{}}return this},Ge.prototype._locked=function(){return this._reculock&&H.lockOwnerFor!==this},Ge.prototype.create=function(e){var t=this;if(!this.mode)return this;var r=this.db.idbdb,n=this.db._state.dbOpenError;if(xe(!this.idbtrans),!e&&!r)switch(n&&n.name){case"DatabaseClosedError":throw new Y.DatabaseClosed(n);case"MissingAPIError":throw new Y.MissingAPI(n.message,n);default:throw new Y.OpenFailed(n)}if(!this.active)throw new Y.TransactionInactive;return xe(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||r).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=ve(function(s){Ut(s),t._reject(e.error)}),e.onabort=ve(function(s){Ut(s),t.active&&t._reject(new Y.Abort(e.error)),t.active=!1,t.on("abort").fire(s)}),e.oncomplete=ve(function(){t.active=!1,t._resolve(),"mutatedParts"in e&&ut.storagemutated.fire(e.mutatedParts)}),this},Ge.prototype._promise=function(e,t,r){var n=this;if(e==="readwrite"&&this.mode!=="readwrite")return _e(new Y.ReadOnly("Transaction is readonly"));if(!this.active)return _e(new Y.TransactionInactive);if(this._locked())return new M(function(i,o){n._blockedFuncs.push([function(){n._promise(e,t,r).then(i,o)},H])});if(r)return at(function(){var i=new M(function(o,c){n._lock();var h=t(o,c,n);h&&h.then&&h.then(o,c)});return i.finally(function(){return n._unlock()}),i._lib=!0,i});var s=new M(function(i,o){var c=t(i,o,n);c&&c.then&&c.then(i,o)});return s._lib=!0,s},Ge.prototype._root=function(){return this.parent?this.parent._root():this},Ge.prototype.waitFor=function(e){var t,r=this._root(),n=M.resolve(e);r._waitingFor?r._waitingFor=r._waitingFor.then(function(){return n}):(r._waitingFor=n,r._waitingQueue=[],t=r.idbtrans.objectStore(r.storeNames[0]),function i(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(t.get(-1/0).onsuccess=i)}());var s=r._waitingFor;return new M(function(i,o){n.then(function(c){return r._waitingQueue.push(ve(i.bind(null,c)))},function(c){return r._waitingQueue.push(ve(o.bind(null,c)))}).finally(function(){r._waitingFor===s&&(r._waitingFor=null)})})},Ge.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Y.Abort))},Ge.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(Z(t,e))return t[e];var r=this.schema[e];if(!r)throw new Y.NotFound("Table "+e+" not part of transaction");return r=new this.db.Table(e,r,this),r.core=this.db.core.table(e),t[e]=r},Ge);function Ge(){}function Yr(e,t,r,n,s,i,o){return{name:e,keyPath:t,unique:r,multi:n,auto:s,compound:i,src:(r&&!o?"&":"")+(n?"*":"")+(s?"++":"")+qn(t)}}function qn(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function Xr(e,t,r){return{name:e,primKey:t,indexes:r,mappedClass:null,idxByName:(n=function(s){return[s.name,s]},r.reduce(function(s,i,o){return o=n(i,o),o&&(s[o[0]]=o[1]),s},{}))};var n}var Wt=function(e){try{return e.only([[]]),Wt=function(){return[[]]},[[]]}catch{return Wt=function(){return bt},bt}};function Gr(e){return e==null?function(){}:typeof e=="string"?(t=e).split(".").length===1?function(r){return r[t]}:function(r){return oe(r,t)}:function(r){return oe(r,e)};var t}function Vn(e){return[].slice.call(e)}var Cs=0;function Yt(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function Es(e,t,h){function n(y){if(y.type===3)return null;if(y.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var p=y.lower,g=y.upper,b=y.lowerOpen,y=y.upperOpen;return p===void 0?g===void 0?null:t.upperBound(g,!!y):g===void 0?t.lowerBound(p,!!b):t.bound(p,g,!!b,!!y)}function s(x){var p,g=x.name;return{name:g,schema:x,mutate:function(b){var y=b.trans,k=b.type,_=b.keys,N=b.values,C=b.range;return new Promise(function(D,L){D=ve(D);var P=y.objectStore(g),O=P.keyPath==null,I=k==="put"||k==="add";if(!I&&k!=="delete"&&k!=="deleteRange")throw new Error("Invalid operation type: "+k);var A,$=(_||N||{length:1}).length;if(_&&N&&_.length!==N.length)throw new Error("Given keys array must have same length as given values array.");if($===0)return D({numFailures:0,failures:{},results:[],lastResult:void 0});function ee(Ie){++Ve,Ut(Ie)}var re=[],ne=[],Ve=0;if(k==="deleteRange"){if(C.type===4)return D({numFailures:Ve,failures:ne,results:[],lastResult:void 0});C.type===3?re.push(A=P.clear()):re.push(A=P.delete(n(C)))}else{var O=I?O?[N,_]:[N,null]:[_,null],J=O[0],Ae=O[1];if(I)for(var Le=0;Le<$;++Le)re.push(A=Ae&&Ae[Le]!==void 0?P[k](J[Le],Ae[Le]):P[k](J[Le])),A.onerror=ee;else for(Le=0;Le<$;++Le)re.push(A=P[k](J[Le])),A.onerror=ee}function Nr(Ie){Ie=Ie.target.result,re.forEach(function(jt,mn){return jt.error!=null&&(ne[mn]=jt.error)}),D({numFailures:Ve,failures:ne,results:k==="delete"?_:re.map(function(jt){return jt.result}),lastResult:Ie})}A.onerror=function(Ie){ee(Ie),Nr(Ie)},A.onsuccess=Nr})},getMany:function(b){var y=b.trans,k=b.keys;return new Promise(function(_,N){_=ve(_);for(var C,D=y.objectStore(g),L=k.length,P=new Array(L),O=0,I=0,A=function(re){re=re.target,P[re._pos]=re.result,++I===O&&_(P)},$=Xe(N),ee=0;ee<L;++ee)k[ee]!=null&&((C=D.get(k[ee]))._pos=ee,C.onsuccess=A,C.onerror=$,++O);O===0&&_(P)})},get:function(b){var y=b.trans,k=b.key;return new Promise(function(_,N){_=ve(_);var C=y.objectStore(g).get(k);C.onsuccess=function(D){return _(D.target.result)},C.onerror=Xe(N)})},query:(p=m,function(b){return new Promise(function(y,k){y=ve(y);var _,N,C,O=b.trans,D=b.values,L=b.limit,A=b.query,P=L===1/0?void 0:L,I=A.index,A=A.range,O=O.objectStore(g),I=I.isPrimaryKey?O:O.index(I.name),A=n(A);if(L===0)return y({result:[]});p?((P=D?I.getAll(A,P):I.getAllKeys(A,P)).onsuccess=function($){return y({result:$.target.result})},P.onerror=Xe(k)):(_=0,N=!D&&"openKeyCursor"in I?I.openKeyCursor(A):I.openCursor(A),C=[],N.onsuccess=function($){var ee=N.result;return ee?(C.push(D?ee.value:ee.primaryKey),++_===L?y({result:C}):void ee.continue()):y({result:C})},N.onerror=Xe(k))})}),openCursor:function(b){var y=b.trans,k=b.values,_=b.query,N=b.reverse,C=b.unique;return new Promise(function(D,L){D=ve(D);var I=_.index,P=_.range,O=y.objectStore(g),O=I.isPrimaryKey?O:O.index(I.name),I=N?C?"prevunique":"prev":C?"nextunique":"next",A=!k&&"openKeyCursor"in O?O.openKeyCursor(n(P),I):O.openCursor(n(P),I);A.onerror=Xe(L),A.onsuccess=ve(function($){var ee,re,ne,Ve,J=A.result;J?(J.___id=++Cs,J.done=!1,ee=J.continue.bind(J),re=(re=J.continuePrimaryKey)&&re.bind(J),ne=J.advance.bind(J),Ve=function(){throw new Error("Cursor not stopped")},J.trans=y,J.stop=J.continue=J.continuePrimaryKey=J.advance=function(){throw new Error("Cursor not started")},J.fail=ve(L),J.next=function(){var Ae=this,Le=1;return this.start(function(){return Le--?Ae.continue():Ae.stop()}).then(function(){return Ae})},J.start=function(Ae){function Le(){if(A.result)try{Ae()}catch(Ie){J.fail(Ie)}else J.done=!0,J.start=function(){throw new Error("Cursor behind last entry")},J.stop()}var Nr=new Promise(function(Ie,jt){Ie=ve(Ie),A.onerror=Xe(jt),J.fail=jt,J.stop=function(mn){J.stop=J.continue=J.continuePrimaryKey=J.advance=Ve,Ie(mn)}});return A.onsuccess=ve(function(Ie){A.onsuccess=Le,Le()}),J.continue=ee,J.continuePrimaryKey=re,J.advance=ne,Le(),Nr},D(J)):D(null)},L)})},count:function(b){var y=b.query,k=b.trans,_=y.index,N=y.range;return new Promise(function(C,D){var L=k.objectStore(g),P=_.isPrimaryKey?L:L.index(_.name),L=n(N),P=L?P.count(L):P.count();P.onsuccess=ve(function(O){return C(O.target.result)}),P.onerror=Xe(D)})}}}var i,o,c,v=(o=h,c=Vn((i=e).objectStoreNames),{schema:{name:i.name,tables:c.map(function(x){return o.objectStore(x)}).map(function(x){var p=x.keyPath,y=x.autoIncrement,g=R(p),b={},y={name:x.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:p==null,compound:g,keyPath:p,autoIncrement:y,unique:!0,extractKey:Gr(p)},indexes:Vn(x.indexNames).map(function(k){return x.index(k)}).map(function(C){var _=C.name,N=C.unique,D=C.multiEntry,C=C.keyPath,D={name:_,compound:R(C),keyPath:C,unique:N,multiEntry:D,extractKey:Gr(C)};return b[Yt(C)]=D}),getIndexByKeyPath:function(k){return b[Yt(k)]}};return b[":id"]=y.primaryKey,p!=null&&(b[Yt(p)]=y.primaryKey),y})},hasGetAll:0<c.length&&"getAll"in o.objectStore(c[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),h=v.schema,m=v.hasGetAll,v=h.tables.map(s),u={};return v.forEach(function(x){return u[x.name]=x}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(x){if(!u[x])throw new Error("Table '".concat(x,"' not found"));return u[x]},MIN_KEY:-1/0,MAX_KEY:Wt(t),schema:h}}function Ss(e,t,r,n){var s=r.IDBKeyRange;return r.indexedDB,{dbcore:(n=Es(t,s,n),e.dbcore.reduce(function(i,o){return o=o.create,d(d({},i),o(i))},n))}}function hr(e,n){var r=n.db,n=Ss(e._middlewares,r,e._deps,n);e.core=n.dbcore,e.tables.forEach(function(s){var i=s.name;e.core.schema.tables.some(function(o){return o.name===i})&&(s.core=e.core.table(i),e[i]instanceof e.Table&&(e[i].core=s.core))})}function pr(e,t,r,n){r.forEach(function(s){var i=n[s];t.forEach(function(o){var c=function h(m,v){return he(m,v)||(m=q(m))&&h(m,v)}(o,s);(!c||"value"in c&&c.value===void 0)&&(o===e.Transaction.prototype||o instanceof e.Transaction?Q(o,s,{get:function(){return this.table(s)},set:function(h){K(this,s,{value:h,writable:!0,configurable:!0,enumerable:!0})}}):o[s]=new e.Table(s,i))})})}function Qr(e,t){t.forEach(function(r){for(var n in r)r[n]instanceof e.Table&&delete r[n]})}function Fs(e,t){return e._cfg.version-t._cfg.version}function Ds(e,t,r,n){var s=e._dbSchema;r.objectStoreNames.contains("$meta")&&!s.$meta&&(s.$meta=Xr("$meta",zn("")[0],[]),e._storeNames.push("$meta"));var i=e._createTransaction("readwrite",e._storeNames,s);i.create(r),i._completion.catch(n);var o=i._reject.bind(i),c=H.transless||H;at(function(){return H.trans=i,H.transless=c,t!==0?(hr(e,r),m=t,((h=i).storeNames.includes("$meta")?h.table("$meta").get("version").then(function(v){return v??m}):M.resolve(m)).then(function(v){return x=v,p=i,g=r,b=[],v=(u=e)._versions,y=u._dbSchema=yr(0,u.idbdb,g),(v=v.filter(function(k){return k._cfg.version>=x})).length!==0?(v.forEach(function(k){b.push(function(){var _=y,N=k._cfg.dbschema;gr(u,_,g),gr(u,N,g),y=u._dbSchema=N;var C=Zr(_,N);C.add.forEach(function(I){Jr(g,I[0],I[1].primKey,I[1].indexes)}),C.change.forEach(function(I){if(I.recreate)throw new Y.Upgrade("Not yet support for changing primary key");var A=g.objectStore(I.name);I.add.forEach(function($){return mr(A,$)}),I.change.forEach(function($){A.deleteIndex($.name),mr(A,$)}),I.del.forEach(function($){return A.deleteIndex($)})});var D=k._cfg.contentUpgrade;if(D&&k._cfg.version>x){hr(u,g),p._memoizedTables={};var L=te(N);C.del.forEach(function(I){L[I]=_[I]}),Qr(u,[u.Transaction.prototype]),pr(u,[u.Transaction.prototype],E(L),L),p.schema=L;var P,O=Pr(D);return O&&Ft(),C=M.follow(function(){var I;(P=D(p))&&O&&(I=ot.bind(null,null),P.then(I,I))}),P&&typeof P.then=="function"?M.resolve(P):C.then(function(){return P})}}),b.push(function(_){var N,C,D=k._cfg.dbschema;N=D,C=_,[].slice.call(C.db.objectStoreNames).forEach(function(L){return N[L]==null&&C.db.deleteObjectStore(L)}),Qr(u,[u.Transaction.prototype]),pr(u,[u.Transaction.prototype],u._storeNames,u._dbSchema),p.schema=u._dbSchema}),b.push(function(_){u.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(u.idbdb.version/10)===k._cfg.version?(u.idbdb.deleteObjectStore("$meta"),delete u._dbSchema.$meta,u._storeNames=u._storeNames.filter(function(N){return N!=="$meta"})):_.objectStore("$meta").put(k._cfg.version,"version"))})}),function k(){return b.length?M.resolve(b.shift()(p.idbtrans)).then(k):M.resolve()}().then(function(){$n(y,g)})):M.resolve();var u,x,p,g,b,y}).catch(o)):(E(s).forEach(function(v){Jr(r,v,s[v].primKey,s[v].indexes)}),hr(e,r),void M.follow(function(){return e.on.populate.fire(i)}).catch(o));var h,m})}function Ps(e,t){$n(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var r=yr(0,e.idbdb,t);gr(e,e._dbSchema,t);for(var n=0,s=Zr(r,e._dbSchema).change;n<s.length;n++){var i=function(o){if(o.change.length||o.recreate)return console.warn("Unable to patch indexes of table ".concat(o.name," because it has changes on the type of index or primary key.")),{value:void 0};var c=t.objectStore(o.name);o.add.forEach(function(h){Ye&&console.debug("Dexie upgrade patch: Creating missing index ".concat(o.name,".").concat(h.src)),mr(c,h)})}(s[n]);if(typeof i=="object")return i.value}}function Zr(e,t){var r,n={del:[],add:[],change:[]};for(r in e)t[r]||n.del.push(r);for(r in t){var s=e[r],i=t[r];if(s){var o={name:r,def:i,recreate:!1,del:[],add:[],change:[]};if(""+(s.primKey.keyPath||"")!=""+(i.primKey.keyPath||"")||s.primKey.auto!==i.primKey.auto)o.recreate=!0,n.change.push(o);else{var c=s.idxByName,h=i.idxByName,m=void 0;for(m in c)h[m]||o.del.push(m);for(m in h){var v=c[m],u=h[m];v?v.src!==u.src&&o.change.push(u):o.add.push(u)}(0<o.del.length||0<o.add.length||0<o.change.length)&&n.change.push(o)}}else n.add.push([r,i])}return n}function Jr(e,t,r,n){var s=e.db.createObjectStore(t,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return n.forEach(function(i){return mr(s,i)}),s}function $n(e,t){E(e).forEach(function(r){t.db.objectStoreNames.contains(r)||(Ye&&console.debug("Dexie: Creating missing table",r),Jr(t,r,e[r].primKey,e[r].indexes))})}function mr(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function yr(e,t,r){var n={};return de(t.objectStoreNames,0).forEach(function(s){for(var i=r.objectStore(s),o=Yr(qn(m=i.keyPath),m||"",!0,!1,!!i.autoIncrement,m&&typeof m!="string",!0),c=[],h=0;h<i.indexNames.length;++h){var v=i.index(i.indexNames[h]),m=v.keyPath,v=Yr(v.name,m,!!v.unique,!!v.multiEntry,!1,m&&typeof m!="string",!1);c.push(v)}n[s]=Xr(s,o,c)}),n}function gr(e,t,r){for(var n=r.db.objectStoreNames,s=0;s<n.length;++s){var i=n[s],o=r.objectStore(i);e._hasGetAll="getAll"in o;for(var c=0;c<o.indexNames.length;++c){var h=o.indexNames[c],m=o.index(h).keyPath,v=typeof m=="string"?m:"["+de(m).join("+")+"]";!t[i]||(m=t[i].idxByName[v])&&(m.name=h,delete t[i].idxByName[v],t[i].idxByName[h]=m)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&S.WorkerGlobalScope&&S instanceof S.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function zn(e){return e.split(",").map(function(t,r){var n=(t=t.trim()).replace(/([&*]|\+\+)/g,""),s=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return Yr(n,s||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),R(s),r===0)})}var Os=(vr.prototype._parseStoresSpec=function(e,t){E(e).forEach(function(r){if(e[r]!==null){var n=zn(e[r]),s=n.shift();if(s.unique=!0,s.multi)throw new Y.Schema("Primary key cannot be multi-valued");n.forEach(function(i){if(i.auto)throw new Y.Schema("Only primary key can be marked as autoIncrement (++)");if(!i.keyPath)throw new Y.Schema("Index must have a name and cannot be an empty string")}),t[r]=Xr(r,s,n)}})},vr.prototype.stores=function(r){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?B(this._cfg.storesSource,r):r;var r=t._versions,n={},s={};return r.forEach(function(i){B(n,i._cfg.storesSource),s=i._cfg.dbschema={},i._parseStoresSpec(n,s)}),t._dbSchema=s,Qr(t,[t._allTables,t,t.Transaction.prototype]),pr(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],E(s),s),t._storeNames=E(s),this},vr.prototype.upgrade=function(e){return this._cfg.contentUpgrade=Ar(this._cfg.contentUpgrade||fe,e),this},vr);function vr(){}function en(e,t){var r=e._dbNamesDB;return r||(r=e._dbNamesDB=new et(lr,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),r.table("dbnames")}function tn(e){return e&&typeof e.databases=="function"}function rn(e){return at(function(){return H.letThrough=!0,e()})}function nn(e){return!("from"in e)}var Oe=function(e,t){if(!this){var r=new Oe;return e&&"d"in e&&B(r,e),r}B(this,arguments.length?{d:1,from:e,to:1<arguments.length?t:e}:{d:0})};function Xt(e,t,r){var n=le(t,r);if(!isNaN(n)){if(0<n)throw RangeError();if(nn(e))return B(e,{from:t,to:r,d:1});var s=e.l,n=e.r;if(le(r,e.from)<0)return s?Xt(s,t,r):e.l={from:t,to:r,d:1,l:null,r:null},Hn(e);if(0<le(t,e.to))return n?Xt(n,t,r):e.r={from:t,to:r,d:1,l:null,r:null},Hn(e);le(t,e.from)<0&&(e.from=t,e.l=null,e.d=n?n.d+1:1),0<le(r,e.to)&&(e.to=r,e.r=null,e.d=e.l?e.l.d+1:1),r=!e.r,s&&!e.l&&Gt(e,s),n&&r&&Gt(e,n)}}function Gt(e,t){nn(t)||function r(n,h){var i=h.from,o=h.to,c=h.l,h=h.r;Xt(n,i,o),c&&r(n,c),h&&r(n,h)}(e,t)}function Un(e,t){var r=br(t),n=r.next();if(n.done)return!1;for(var s=n.value,i=br(e),o=i.next(s.from),c=o.value;!n.done&&!o.done;){if(le(c.from,s.to)<=0&&0<=le(c.to,s.from))return!0;le(s.from,c.from)<0?s=(n=r.next(c.from)).value:c=(o=i.next(s.from)).value}return!1}function br(e){var t=nn(e)?null:{s:0,n:e};return{next:function(r){for(var n=0<arguments.length;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&le(r,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||le(r,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function Hn(e){var t,r,n=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((r=e.l)===null||r===void 0?void 0:r.d)||0),s=1<n?"r":n<-1?"l":"";s&&(t=s=="r"?"l":"r",r=d({},e),n=e[s],e.from=n.from,e.to=n.to,e[s]=n[s],r[s]=n[t],(e[t]=r).d=Wn(r)),e.d=Wn(e)}function Wn(r){var t=r.r,r=r.l;return(t?r?Math.max(t.d,r.d):t.d:r?r.d:0)+1}function xr(e,t){return E(t).forEach(function(r){e[r]?Gt(e[r],t[r]):e[r]=function n(s){var i,o,c={};for(i in s)Z(s,i)&&(o=s[i],c[i]=!o||typeof o!="object"||Pe.has(o.constructor)?o:n(o));return c}(t[r])}),e}function sn(e,t){return e.all||t.all||Object.keys(e).some(function(r){return t[r]&&Un(t[r],e[r])})}X(Oe.prototype,((ze={add:function(e){return Gt(this,e),this},addKey:function(e){return Xt(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(r){return Xt(t,r,r)}),this},hasKey:function(e){var t=br(this).next(e).value;return t&&le(t.from,e)<=0&&0<=le(t.to,e)}})[G]=function(){return br(this)},ze));var wt={},an={},on=!1;function wr(e){xr(an,e),on||(on=!0,setTimeout(function(){on=!1,ln(an,!(an={}))},0))}function ln(e,t){t===void 0&&(t=!1);var r=new Set;if(e.all)for(var n=0,s=Object.values(wt);n<s.length;n++)Yn(o=s[n],e,r,t);else for(var i in e){var o,c=/^idb\:\/\/(.*)\/(.*)\//.exec(i);c&&(i=c[1],c=c[2],(o=wt["idb://".concat(i,"/").concat(c)])&&Yn(o,e,r,t))}r.forEach(function(h){return h()})}function Yn(e,t,r,n){for(var s=[],i=0,o=Object.entries(e.queries.query);i<o.length;i++){for(var c=o[i],h=c[0],m=[],v=0,u=c[1];v<u.length;v++){var x=u[v];sn(t,x.obsSet)?x.subscribers.forEach(function(y){return r.add(y)}):n&&m.push(x)}n&&s.push([h,m])}if(n)for(var p=0,g=s;p<g.length;p++){var b=g[p],h=b[0],m=b[1];e.queries.query[h]=m}}function As(e){var t=e._state,r=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?_e(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var n=t.openCanceller,s=Math.round(10*e.verno),i=!1;function o(){if(t.openCanceller!==n)throw new Y.DatabaseClosed("db.open() was cancelled")}function c(){return new M(function(x,p){if(o(),!r)throw new Y.MissingAPI;var g=e.name,b=t.autoSchema||!s?r.open(g):r.open(g,s);if(!b)throw new Y.MissingAPI;b.onerror=Xe(p),b.onblocked=ve(e._fireOnBlocked),b.onupgradeneeded=ve(function(y){var k;v=b.transaction,t.autoSchema&&!e._options.allowEmptyDB?(b.onerror=Ut,v.abort(),b.result.close(),(k=r.deleteDatabase(g)).onsuccess=k.onerror=ve(function(){p(new Y.NoSuchDatabase("Database ".concat(g," doesnt exist")))})):(v.onerror=Xe(p),y=y.oldVersion>Math.pow(2,62)?0:y.oldVersion,u=y<1,e.idbdb=b.result,i&&Ps(e,v),Ds(e,y/10,v,p))},p),b.onsuccess=ve(function(){v=null;var y,k,_,N,C,D=e.idbdb=b.result,L=de(D.objectStoreNames);if(0<L.length)try{var P=D.transaction((N=L).length===1?N[0]:N,"readonly");if(t.autoSchema)k=D,_=P,(y=e).verno=k.version/10,_=y._dbSchema=yr(0,k,_),y._storeNames=de(k.objectStoreNames,0),pr(y,[y._allTables],E(_),_);else if(gr(e,e._dbSchema,P),((C=Zr(yr(0,(C=e).idbdb,P),C._dbSchema)).add.length||C.change.some(function(O){return O.add.length||O.change.length}))&&!i)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),D.close(),s=D.version+1,i=!0,x(c());hr(e,P)}catch{}Dt.push(e),D.onversionchange=ve(function(O){t.vcFired=!0,e.on("versionchange").fire(O)}),D.onclose=ve(function(O){e.on("close").fire(O)}),u&&(C=e._deps,P=g,D=C.indexedDB,C=C.IDBKeyRange,tn(D)||P===lr||en(D,C).put({name:P}).catch(fe)),x()},p)}).catch(function(x){switch(x?.name){case"UnknownError":if(0<t.PR1398_maxLoop)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),c();break;case"VersionError":if(0<s)return s=0,c()}return M.reject(x)})}var h,m=t.dbReadyResolve,v=null,u=!1;return M.race([n,(typeof navigator>"u"?M.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(x){function p(){return indexedDB.databases().finally(x)}h=setInterval(p,100),p()}).finally(function(){return clearInterval(h)}):Promise.resolve()).then(c)]).then(function(){return o(),t.onReadyBeingFired=[],M.resolve(rn(function(){return e.on.ready.fire(e.vip)})).then(function x(){if(0<t.onReadyBeingFired.length){var p=t.onReadyBeingFired.reduce(Ar,fe);return t.onReadyBeingFired=[],M.resolve(rn(function(){return p(e.vip)})).then(x)}})}).finally(function(){t.openCanceller===n&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(x){t.dbOpenError=x;try{v&&v.abort()}catch{}return n===t.openCanceller&&e._close(),_e(x)}).finally(function(){t.openComplete=!0,m()}).then(function(){var x;return u&&(x={},e.tables.forEach(function(p){p.schema.indexes.forEach(function(g){g.name&&(x["idb://".concat(e.name,"/").concat(p.name,"/").concat(g.name)]=new Oe(-1/0,[[[]]]))}),x["idb://".concat(e.name,"/").concat(p.name,"/")]=x["idb://".concat(e.name,"/").concat(p.name,"/:dels")]=new Oe(-1/0,[[[]]])}),ut(Ht).fire(x),ln(x,!0)),e})}function cn(e){function t(i){return e.next(i)}var r=s(t),n=s(function(i){return e.throw(i)});function s(i){return function(h){var c=i(h),h=c.value;return c.done?h:h&&typeof h.then=="function"?h.then(r,n):R(h)?Promise.all(h).then(r,n):r(h)}}return s(t)()}function kr(e,t,r){for(var n=R(e)?e.slice():[e],s=0;s<r;++s)n.push(t);return n}var Ls={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return d(d({},e),{table:function(t){var r=e.table(t),n=r.schema,s={},i=[];function o(u,x,p){var g=Yt(u),b=s[g]=s[g]||[],y=u==null?0:typeof u=="string"?1:u.length,k=0<x,k=d(d({},p),{name:k?"".concat(g,"(virtual-from:").concat(p.name,")"):p.name,lowLevelIndex:p,isVirtual:k,keyTail:x,keyLength:y,extractKey:Gr(u),unique:!k&&p.unique});return b.push(k),k.isPrimaryKey||i.push(k),1<y&&o(y===2?u[0]:u.slice(0,y-1),x+1,p),b.sort(function(_,N){return _.keyTail-N.keyTail}),k}t=o(n.primaryKey.keyPath,0,n.primaryKey),s[":id"]=[t];for(var c=0,h=n.indexes;c<h.length;c++){var m=h[c];o(m.keyPath,0,m)}function v(u){var x,p=u.query.index;return p.isVirtual?d(d({},u),{query:{index:p.lowLevelIndex,range:(x=u.query.range,p=p.keyTail,{type:x.type===1?2:x.type,lower:kr(x.lower,x.lowerOpen?e.MAX_KEY:e.MIN_KEY,p),lowerOpen:!0,upper:kr(x.upper,x.upperOpen?e.MIN_KEY:e.MAX_KEY,p),upperOpen:!0})}}):u}return d(d({},r),{schema:d(d({},n),{primaryKey:t,indexes:i,getIndexByKeyPath:function(u){return(u=s[Yt(u)])&&u[0]}}),count:function(u){return r.count(v(u))},query:function(u){return r.query(v(u))},openCursor:function(u){var x=u.query.index,p=x.keyTail,g=x.isVirtual,b=x.keyLength;return g?r.openCursor(v(u)).then(function(k){return k&&y(k)}):r.openCursor(u);function y(k){return Object.create(k,{continue:{value:function(_){_!=null?k.continue(kr(_,u.reverse?e.MAX_KEY:e.MIN_KEY,p)):u.unique?k.continue(k.key.slice(0,b).concat(u.reverse?e.MIN_KEY:e.MAX_KEY,p)):k.continue()}},continuePrimaryKey:{value:function(_,N){k.continuePrimaryKey(kr(_,e.MAX_KEY,p),N)}},primaryKey:{get:function(){return k.primaryKey}},key:{get:function(){var _=k.key;return b===1?_[0]:_.slice(0,b)}},value:{get:function(){return k.value}}})}}})}})}};function un(e,t,r,n){return r=r||{},n=n||"",E(e).forEach(function(s){var i,o,c;Z(t,s)?(i=e[s],o=t[s],typeof i=="object"&&typeof o=="object"&&i&&o?(c=V(i))!==V(o)?r[n+s]=t[s]:c==="Object"?un(i,o,r,n+s+"."):i!==o&&(r[n+s]=t[s]):i!==o&&(r[n+s]=t[s])):r[n+s]=void 0}),E(t).forEach(function(s){Z(e,s)||(r[n+s]=t[s])}),r}function dn(e,t){return t.type==="delete"?t.keys:t.keys||t.values.map(e.extractKey)}var Ts={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return d(d({},e),{table:function(t){var r=e.table(t),n=r.schema.primaryKey;return d(d({},r),{mutate:function(s){var i=H.trans,o=i.table(t).hook,c=o.deleting,h=o.creating,m=o.updating;switch(s.type){case"add":if(h.fire===fe)break;return i._promise("readwrite",function(){return v(s)},!0);case"put":if(h.fire===fe&&m.fire===fe)break;return i._promise("readwrite",function(){return v(s)},!0);case"delete":if(c.fire===fe)break;return i._promise("readwrite",function(){return v(s)},!0);case"deleteRange":if(c.fire===fe)break;return i._promise("readwrite",function(){return function u(x,p,g){return r.query({trans:x,values:!1,query:{index:n,range:p},limit:g}).then(function(b){var y=b.result;return v({type:"delete",keys:y,trans:x}).then(function(k){return 0<k.numFailures?Promise.reject(k.failures[0]):y.length<g?{failures:[],numFailures:0,lastResult:void 0}:u(x,d(d({},p),{lower:y[y.length-1],lowerOpen:!0}),g)})})}(s.trans,s.range,1e4)},!0)}return r.mutate(s);function v(u){var x,p,g,b=H.trans,y=u.keys||dn(n,u);if(!y)throw new Error("Keys missing");return(u=u.type==="add"||u.type==="put"?d(d({},u),{keys:y}):d({},u)).type!=="delete"&&(u.values=j([],u.values)),u.keys&&(u.keys=j([],u.keys)),x=r,g=y,((p=u).type==="add"?Promise.resolve([]):x.getMany({trans:p.trans,keys:g,cache:"immutable"})).then(function(k){var _=y.map(function(N,C){var D,L,P,O=k[C],I={onerror:null,onsuccess:null};return u.type==="delete"?c.fire.call(I,N,O,b):u.type==="add"||O===void 0?(D=h.fire.call(I,N,u.values[C],b),N==null&&D!=null&&(u.keys[C]=N=D,n.outbound||U(u.values[C],n.keyPath,N))):(D=un(O,u.values[C]),(L=m.fire.call(I,D,N,O,b))&&(P=u.values[C],Object.keys(L).forEach(function(A){Z(P,A)?P[A]=L[A]:U(P,A,L[A])}))),I});return r.mutate(u).then(function(N){for(var C=N.failures,D=N.results,L=N.numFailures,N=N.lastResult,P=0;P<y.length;++P){var O=(D||y)[P],I=_[P];O==null?I.onerror&&I.onerror(C[P]):I.onsuccess&&I.onsuccess(u.type==="put"&&k[P]?u.values[P]:O)}return{failures:C,results:D,numFailures:L,lastResult:N}}).catch(function(N){return _.forEach(function(C){return C.onerror&&C.onerror(N)}),Promise.reject(N)})})}}})}})}};function Xn(e,t,r){try{if(!t||t.keys.length<e.length)return null;for(var n=[],s=0,i=0;s<t.keys.length&&i<e.length;++s)le(t.keys[s],e[i])===0&&(n.push(r?z(t.values[s]):t.values[s]),++i);return n.length===e.length?n:null}catch{return null}}var Is={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var r=e.table(t);return d(d({},r),{getMany:function(n){if(!n.cache)return r.getMany(n);var s=Xn(n.keys,n.trans._cache,n.cache==="clone");return s?M.resolve(s):r.getMany(n).then(function(i){return n.trans._cache={keys:n.keys,values:n.cache==="clone"?z(i):i},i})},mutate:function(n){return n.type!=="add"&&(n.trans._cache=null),r.mutate(n)}})}}}};function Gn(e,t){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!t.schema.primaryKey.outbound}function Qn(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Ks={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,r=new Oe(e.MIN_KEY,e.MAX_KEY);return d(d({},e),{transaction:function(n,s,i){if(H.subscr&&s!=="readonly")throw new Y.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(H.querier));return e.transaction(n,s,i)},table:function(n){var s=e.table(n),i=s.schema,o=i.primaryKey,u=i.indexes,c=o.extractKey,h=o.outbound,m=o.autoIncrement&&u.filter(function(p){return p.compound&&p.keyPath.includes(o.keyPath)}),v=d(d({},s),{mutate:function(p){function g(A){return A="idb://".concat(t,"/").concat(n,"/").concat(A),N[A]||(N[A]=new Oe)}var b,y,k,_=p.trans,N=p.mutatedParts||(p.mutatedParts={}),C=g(""),D=g(":dels"),L=p.type,I=p.type==="deleteRange"?[p.range]:p.type==="delete"?[p.keys]:p.values.length<50?[dn(o,p).filter(function(A){return A}),p.values]:[],P=I[0],O=I[1],I=p.trans._cache;return R(P)?(C.addKeys(P),(I=L==="delete"||P.length===O.length?Xn(P,I):null)||D.addKeys(P),(I||O)&&(b=g,y=I,k=O,i.indexes.forEach(function(A){var $=b(A.name||"");function ee(ne){return ne!=null?A.extractKey(ne):null}function re(ne){return A.multiEntry&&R(ne)?ne.forEach(function(Ve){return $.addKey(Ve)}):$.addKey(ne)}(y||k).forEach(function(ne,Ae){var J=y&&ee(y[Ae]),Ae=k&&ee(k[Ae]);le(J,Ae)!==0&&(J!=null&&re(J),Ae!=null&&re(Ae))})}))):P?(O={from:(O=P.lower)!==null&&O!==void 0?O:e.MIN_KEY,to:(O=P.upper)!==null&&O!==void 0?O:e.MAX_KEY},D.add(O),C.add(O)):(C.add(r),D.add(r),i.indexes.forEach(function(A){return g(A.name).add(r)})),s.mutate(p).then(function(A){return!P||p.type!=="add"&&p.type!=="put"||(C.addKeys(A.results),m&&m.forEach(function($){for(var ee=p.values.map(function(J){return $.extractKey(J)}),re=$.keyPath.findIndex(function(J){return J===o.keyPath}),ne=0,Ve=A.results.length;ne<Ve;++ne)ee[ne][re]=A.results[ne];g($.name).addKeys(ee)})),_.mutatedParts=xr(_.mutatedParts||{},N),A})}}),u=function(g){var b=g.query,g=b.index,b=b.range;return[g,new Oe((g=b.lower)!==null&&g!==void 0?g:e.MIN_KEY,(b=b.upper)!==null&&b!==void 0?b:e.MAX_KEY)]},x={get:function(p){return[o,new Oe(p.key)]},getMany:function(p){return[o,new Oe().addKeys(p.keys)]},count:u,query:u,openCursor:u};return E(x).forEach(function(p){v[p]=function(g){var b=H.subscr,y=!!b,k=Gn(H,s)&&Qn(p,g)?g.obsSet={}:b;if(y){var _=function(O){return O="idb://".concat(t,"/").concat(n,"/").concat(O),k[O]||(k[O]=new Oe)},N=_(""),C=_(":dels"),b=x[p](g),y=b[0],b=b[1];if((p==="query"&&y.isPrimaryKey&&!g.values?C:_(y.name||"")).add(b),!y.isPrimaryKey){if(p!=="count"){var D=p==="query"&&h&&g.values&&s.query(d(d({},g),{values:!1}));return s[p].apply(this,arguments).then(function(O){if(p==="query"){if(h&&g.values)return D.then(function(ee){return ee=ee.result,N.addKeys(ee),O});var I=g.values?O.result.map(c):O.result;(g.values?N:C).addKeys(I)}else if(p==="openCursor"){var A=O,$=g.values;return A&&Object.create(A,{key:{get:function(){return C.addKey(A.primaryKey),A.key}},primaryKey:{get:function(){var ee=A.primaryKey;return C.addKey(ee),ee}},value:{get:function(){return $&&N.addKey(A.primaryKey),A.value}}})}return O})}C.add(r)}}return s[p].apply(this,arguments)}}),v}})}};function Zn(e,t,r){if(r.numFailures===0)return t;if(t.type==="deleteRange")return null;var n=t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1;return r.numFailures===n?null:(t=d({},t),R(t.keys)&&(t.keys=t.keys.filter(function(s,i){return!(i in r.failures)})),"values"in t&&R(t.values)&&(t.values=t.values.filter(function(s,i){return!(i in r.failures)})),t)}function fn(e,t){return r=e,((n=t).lower===void 0||(n.lowerOpen?0<le(r,n.lower):0<=le(r,n.lower)))&&(e=e,(t=t).upper===void 0||(t.upperOpen?le(e,t.upper)<0:le(e,t.upper)<=0));var r,n}function Jn(e,t,x,n,s,i){if(!x||x.length===0)return e;var o=t.query.index,c=o.multiEntry,h=t.query.range,m=n.schema.primaryKey.extractKey,v=o.extractKey,u=(o.lowLevelIndex||o).extractKey,x=x.reduce(function(p,g){var b=p,y=[];if(g.type==="add"||g.type==="put")for(var k=new Oe,_=g.values.length-1;0<=_;--_){var N,C=g.values[_],D=m(C);k.hasKey(D)||(N=v(C),(c&&R(N)?N.some(function(A){return fn(A,h)}):fn(N,h))&&(k.addKey(D),y.push(C)))}switch(g.type){case"add":var L=new Oe().addKeys(t.values?p.map(function($){return m($)}):p),b=p.concat(t.values?y.filter(function($){return $=m($),!L.hasKey($)&&(L.addKey($),!0)}):y.map(function($){return m($)}).filter(function($){return!L.hasKey($)&&(L.addKey($),!0)}));break;case"put":var P=new Oe().addKeys(g.values.map(function($){return m($)}));b=p.filter(function($){return!P.hasKey(t.values?m($):$)}).concat(t.values?y:y.map(function($){return m($)}));break;case"delete":var O=new Oe().addKeys(g.keys);b=p.filter(function($){return!O.hasKey(t.values?m($):$)});break;case"deleteRange":var I=g.range;b=p.filter(function($){return!fn(m($),I)})}return b},e);return x===e?e:(x.sort(function(p,g){return le(u(p),u(g))||le(m(p),m(g))}),t.limit&&t.limit<1/0&&(x.length>t.limit?x.length=t.limit:e.length===t.limit&&x.length<t.limit&&(s.dirty=!0)),i?Object.freeze(x):x)}function es(e,t){return le(e.lower,t.lower)===0&&le(e.upper,t.upper)===0&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function Ms(e,t){return function(r,n,s,i){if(r===void 0)return n!==void 0?-1:0;if(n===void 0)return 1;if((n=le(r,n))===0){if(s&&i)return 0;if(s)return 1;if(i)return-1}return n}(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&0<=function(r,n,s,i){if(r===void 0)return n!==void 0?1:0;if(n===void 0)return-1;if((n=le(r,n))===0){if(s&&i)return 0;if(s)return-1;if(i)return 1}return n}(e.upper,t.upper,e.upperOpen,t.upperOpen)}function Rs(e,t,r,n){e.subscribers.add(r),n.addEventListener("abort",function(){var s,i;e.subscribers.delete(r),e.subscribers.size===0&&(s=e,i=t,setTimeout(function(){s.subscribers.size===0&&Ke(i,s)},3e3))})}var Bs={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name;return d(d({},e),{transaction:function(r,n,s){var i,o,c=e.transaction(r,n,s);return n==="readwrite"&&(o=(i=new AbortController).signal,s=function(h){return function(){if(i.abort(),n==="readwrite"){for(var m=new Set,v=0,u=r;v<u.length;v++){var x=u[v],p=wt["idb://".concat(t,"/").concat(x)];if(p){var g=e.table(x),b=p.optimisticOps.filter(function($){return $.trans===c});if(c._explicit&&h&&c.mutatedParts)for(var y=0,k=Object.values(p.queries.query);y<k.length;y++)for(var _=0,N=(L=k[y]).slice();_<N.length;_++)sn((P=N[_]).obsSet,c.mutatedParts)&&(Ke(L,P),P.subscribers.forEach(function($){return m.add($)}));else if(0<b.length){p.optimisticOps=p.optimisticOps.filter(function($){return $.trans!==c});for(var C=0,D=Object.values(p.queries.query);C<D.length;C++)for(var L,P,O,I=0,A=(L=D[C]).slice();I<A.length;I++)(P=A[I]).res!=null&&c.mutatedParts&&(h&&!P.dirty?(O=Object.isFrozen(P.res),O=Jn(P.res,P.req,b,g,P,O),P.dirty?(Ke(L,P),P.subscribers.forEach(function($){return m.add($)})):O!==P.res&&(P.res=O,P.promise=M.resolve({result:O}))):(P.dirty&&Ke(L,P),P.subscribers.forEach(function($){return m.add($)})))}}}m.forEach(function($){return $()})}}},c.addEventListener("abort",s(!1),{signal:o}),c.addEventListener("error",s(!1),{signal:o}),c.addEventListener("complete",s(!0),{signal:o})),c},table:function(r){var n=e.table(r),s=n.schema.primaryKey;return d(d({},n),{mutate:function(i){var o=H.trans;if(s.outbound||o.db._options.cache==="disabled"||o.explicit||o.idbtrans.mode!=="readwrite")return n.mutate(i);var c=wt["idb://".concat(t,"/").concat(r)];return c?(o=n.mutate(i),i.type!=="add"&&i.type!=="put"||!(50<=i.values.length||dn(s,i).some(function(h){return h==null}))?(c.optimisticOps.push(i),i.mutatedParts&&wr(i.mutatedParts),o.then(function(h){0<h.numFailures&&(Ke(c.optimisticOps,i),(h=Zn(0,i,h))&&c.optimisticOps.push(h),i.mutatedParts&&wr(i.mutatedParts))}),o.catch(function(){Ke(c.optimisticOps,i),i.mutatedParts&&wr(i.mutatedParts)})):o.then(function(h){var m=Zn(0,d(d({},i),{values:i.values.map(function(v,u){var x;return h.failures[u]?v:(v=(x=s.keyPath)!==null&&x!==void 0&&x.includes(".")?z(v):d({},v),U(v,s.keyPath,h.results[u]),v)})}),h);c.optimisticOps.push(m),queueMicrotask(function(){return i.mutatedParts&&wr(i.mutatedParts)})}),o):n.mutate(i)},query:function(i){if(!Gn(H,n)||!Qn("query",i))return n.query(i);var o=((m=H.trans)===null||m===void 0?void 0:m.db._options.cache)==="immutable",u=H,c=u.requery,h=u.signal,m=function(g,b,y,k){var _=wt["idb://".concat(g,"/").concat(b)];if(!_)return[];if(!(b=_.queries[y]))return[null,!1,_,null];var N=b[(k.query?k.query.index.name:null)||""];if(!N)return[null,!1,_,null];switch(y){case"query":var C=N.find(function(D){return D.req.limit===k.limit&&D.req.values===k.values&&es(D.req.query.range,k.query.range)});return C?[C,!0,_,N]:[N.find(function(D){return("limit"in D.req?D.req.limit:1/0)>=k.limit&&(!k.values||D.req.values)&&Ms(D.req.query.range,k.query.range)}),!1,_,N];case"count":return C=N.find(function(D){return es(D.req.query.range,k.query.range)}),[C,!!C,_,N]}}(t,r,"query",i),v=m[0],u=m[1],x=m[2],p=m[3];return v&&u?v.obsSet=i.obsSet:(u=n.query(i).then(function(g){var b=g.result;if(v&&(v.res=b),o){for(var y=0,k=b.length;y<k;++y)Object.freeze(b[y]);Object.freeze(b)}else g.result=z(b);return g}).catch(function(g){return p&&v&&Ke(p,v),Promise.reject(g)}),v={obsSet:i.obsSet,promise:u,subscribers:new Set,type:"query",req:i,dirty:!1},p?p.push(v):(p=[v],(x=x||(wt["idb://".concat(t,"/").concat(r)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[i.query.index.name||""]=p)),Rs(v,p,c,h),v.promise.then(function(g){return{result:Jn(g.result,i,x?.optimisticOps,n,v,o)}})}})}})}};function jr(e,t){return new Proxy(e,{get:function(r,n,s){return n==="db"?t:Reflect.get(r,n,s)}})}var et=(Ne.prototype.version=function(e){if(isNaN(e)||e<.1)throw new Y.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new Y.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,r=t.filter(function(n){return n._cfg.version===e})[0];return r||(r=new this.Version(e),t.push(r),t.sort(Fs),r.stores({}),this._state.autoSchema=!1,r)},Ne.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||H.letThrough||this._vip)?e():new M(function(r,n){if(t._state.openComplete)return n(new Y.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void n(new Y.DatabaseClosed);t.open().catch(fe)}t._state.dbReadyPromise.then(r,n)}).then(e)},Ne.prototype.use=function(e){var t=e.stack,r=e.create,n=e.level,s=e.name;return s&&this.unuse({stack:t,name:s}),e=this._middlewares[t]||(this._middlewares[t]=[]),e.push({stack:t,create:r,level:n??10,name:s}),e.sort(function(i,o){return i.level-o.level}),this},Ne.prototype.unuse=function(e){var t=e.stack,r=e.name,n=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(s){return n?s.create!==n:!!r&&s.name!==r})),this},Ne.prototype.open=function(){var e=this;return vt(it,function(){return As(e)})},Ne.prototype._close=function(){var e=this._state,t=Dt.indexOf(this);if(0<=t&&Dt.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new M(function(r){e.dbReadyResolve=r}),e.openCanceller=new M(function(r,n){e.cancelOpen=n}))},Ne.prototype.close=function(r){var t=(r===void 0?{disableAutoOpen:!0}:r).disableAutoOpen,r=this._state;t?(r.isBeingOpened&&r.cancelOpen(new Y.DatabaseClosed),this._close(),r.autoOpen=!1,r.dbOpenError=new Y.DatabaseClosed):(this._close(),r.autoOpen=this._options.autoOpen||r.isBeingOpened,r.openComplete=!1,r.dbOpenError=null)},Ne.prototype.delete=function(e){var t=this;e===void 0&&(e={disableAutoOpen:!0});var r=0<arguments.length&&typeof arguments[0]!="object",n=this._state;return new M(function(s,i){function o(){t.close(e);var c=t._deps.indexedDB.deleteDatabase(t.name);c.onsuccess=ve(function(){var h,m,v;h=t._deps,m=t.name,v=h.indexedDB,h=h.IDBKeyRange,tn(v)||m===lr||en(v,h).delete(m).catch(fe),s()}),c.onerror=Xe(i),c.onblocked=t._fireOnBlocked}if(r)throw new Y.InvalidArgument("Invalid closeOptions argument to db.delete()");n.isBeingOpened?n.dbReadyPromise.then(o):o()})},Ne.prototype.backendDB=function(){return this.idbdb},Ne.prototype.isOpen=function(){return this.idbdb!==null},Ne.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},Ne.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Ne.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Ne.prototype,"tables",{get:function(){var e=this;return E(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),Ne.prototype.transaction=function(){var e=function(t,r,n){var s=arguments.length;if(s<2)throw new Y.InvalidArgument("Too few arguments");for(var i=new Array(s-1);--s;)i[s-1]=arguments[s];return n=i.pop(),[t,ke(i),n]}.apply(this,arguments);return this._transaction.apply(this,e)},Ne.prototype._transaction=function(e,t,r){var n=this,s=H.trans;s&&s.db===this&&e.indexOf("!")===-1||(s=null);var i,o,c=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");try{if(o=t.map(function(m){if(m=m instanceof n.Table?m.name:m,typeof m!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return m}),e=="r"||e===Vr)i=Vr;else{if(e!="rw"&&e!=$r)throw new Y.InvalidArgument("Invalid transaction mode: "+e);i=$r}if(s){if(s.mode===Vr&&i===$r){if(!c)throw new Y.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");s=null}s&&o.forEach(function(m){if(s&&s.storeNames.indexOf(m)===-1){if(!c)throw new Y.SubTransaction("Table "+m+" not included in parent transaction.");s=null}}),c&&s&&!s.active&&(s=null)}}catch(m){return s?s._promise(null,function(v,u){u(m)}):_e(m)}var h=function m(v,u,x,p,g){return M.resolve().then(function(){var b=H.transless||H,y=v._createTransaction(u,x,v._dbSchema,p);if(y.explicit=!0,b={trans:y,transless:b},p)y.idbtrans=p.idbtrans;else try{y.create(),y.idbtrans._explicit=!0,v._state.PR1398_maxLoop=3}catch(N){return N.name===Or.InvalidState&&v.isOpen()&&0<--v._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),v.close({disableAutoOpen:!1}),v.open().then(function(){return m(v,u,x,null,g)})):_e(N)}var k,_=Pr(g);return _&&Ft(),b=M.follow(function(){var N;(k=g.call(y,y))&&(_?(N=ot.bind(null,null),k.then(N,N)):typeof k.next=="function"&&typeof k.throw=="function"&&(k=cn(k)))},b),(k&&typeof k.then=="function"?M.resolve(k).then(function(N){return y.active?N:_e(new Y.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):b.then(function(){return k})).then(function(N){return p&&y._resolve(),y._completion.then(function(){return N})}).catch(function(N){return y._reject(N),_e(N)})})}.bind(null,this,i,o,s,r);return s?s._promise(i,h,"lock"):H.trans?vt(H.transless,function(){return n._whenReady(h)}):this._whenReady(h)},Ne.prototype.table=function(e){if(!Z(this._allTables,e))throw new Y.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},Ne);function Ne(e,t){var r=this;this._middlewares={},this.verno=0;var n=Ne.dependencies;this._options=t=d({addons:Ne.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,cache:"cloned"},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange},n=t.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var s,i,o,c,h,m={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:fe,dbReadyPromise:null,cancelOpen:fe,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:t.autoOpen};m.dbReadyPromise=new M(function(u){m.dbReadyResolve=u}),m.openCanceller=new M(function(u,x){m.cancelOpen=x}),this._state=m,this.name=e,this.on=Vt(this,"populate","blocked","versionchange","close",{ready:[Ar,fe]}),this.on.ready.subscribe=ye(this.on.ready.subscribe,function(u){return function(x,p){Ne.vip(function(){var g,b=r._state;b.openComplete?(b.dbOpenError||M.resolve().then(x),p&&u(x)):b.onReadyBeingFired?(b.onReadyBeingFired.push(x),p&&u(x)):(u(x),g=r,p||u(function y(){g.on.ready.unsubscribe(x),g.on.ready.unsubscribe(y)}))})}}),this.Collection=(s=this,$t(ks.prototype,function(k,y){this.db=s;var p=Pn,g=null;if(y)try{p=y()}catch(_){g=_}var b=k._ctx,y=b.table,k=y.hook.reading.fire;this._ctx={table:y,index:b.index,isPrimKey:!b.index||y.schema.primKey.keyPath&&b.index===y.schema.primKey.name,range:p,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:g,or:b.or,valueMapper:k!==Kt?k:null}})),this.Table=(i=this,$t(Tn.prototype,function(u,x,p){this.db=i,this._tx=p,this.name=u,this.schema=x,this.hook=i._allTables[u]?i._allTables[u].hook:Vt(null,{creating:[hs,fe],reading:[fs,Kt],updating:[ms,fe],deleting:[ps,fe]})})),this.Transaction=(o=this,$t(Ns.prototype,function(u,x,p,g,b){var y=this;this.db=o,this.mode=u,this.storeNames=x,this.schema=p,this.chromeTransactionDurability=g,this.idbtrans=null,this.on=Vt(this,"complete","error","abort"),this.parent=b||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new M(function(k,_){y._resolve=k,y._reject=_}),this._completion.then(function(){y.active=!1,y.on.complete.fire()},function(k){var _=y.active;return y.active=!1,y.on.error.fire(k),y.parent?y.parent._reject(k):_&&y.idbtrans&&y.idbtrans.abort(),_e(k)})})),this.Version=(c=this,$t(Os.prototype,function(u){this.db=c,this._cfg={version:u,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(h=this,$t(Bn.prototype,function(u,x,p){if(this.db=h,this._ctx={table:u,index:x===":id"?null:x,or:p},this._cmp=this._ascending=le,this._descending=function(g,b){return le(b,g)},this._max=function(g,b){return 0<le(g,b)?g:b},this._min=function(g,b){return le(g,b)<0?g:b},this._IDBKeyRange=h._deps.IDBKeyRange,!this._IDBKeyRange)throw new Y.MissingAPI})),this.on("versionchange",function(u){0<u.newVersion?console.warn("Another connection wants to upgrade database '".concat(r.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(r.name,"'. Closing db now to resume the delete request.")),r.close({disableAutoOpen:!1})}),this.on("blocked",function(u){!u.newVersion||u.newVersion<u.oldVersion?console.warn("Dexie.delete('".concat(r.name,"') was blocked")):console.warn("Upgrade '".concat(r.name,"' blocked by other connection holding version ").concat(u.oldVersion/10))}),this._maxKey=Wt(t.IDBKeyRange),this._createTransaction=function(u,x,p,g){return new r.Transaction(u,x,p,r._options.chromeTransactionDurability,g)},this._fireOnBlocked=function(u){r.on("blocked").fire(u),Dt.filter(function(x){return x.name===r.name&&x!==r&&!x._state.vcFired}).map(function(x){return x.on("versionchange").fire(u)})},this.use(Is),this.use(Bs),this.use(Ks),this.use(Ls),this.use(Ts);var v=new Proxy(this,{get:function(u,x,p){if(x==="_vip")return!0;if(x==="table")return function(b){return jr(r.table(b),v)};var g=Reflect.get(u,x,p);return g instanceof Tn?jr(g,v):x==="tables"?g.map(function(b){return jr(b,v)}):x==="_createTransaction"?function(){return jr(g.apply(this,arguments),v)}:g}});this.vip=v,n.forEach(function(u){return u(r)})}var _r,ze=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",qs=(hn.prototype.subscribe=function(e,t,r){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:t,complete:r})},hn.prototype[ze]=function(){return this},hn);function hn(e){this._subscribe=e}try{_r={indexedDB:S.indexedDB||S.mozIndexedDB||S.webkitIndexedDB||S.msIndexedDB,IDBKeyRange:S.IDBKeyRange||S.webkitIDBKeyRange}}catch{_r={indexedDB:null,IDBKeyRange:null}}function ts(e){var t,r=!1,n=new qs(function(s){var i=Pr(e),o,c=!1,h={},m={},v={get closed(){return c},unsubscribe:function(){c||(c=!0,o&&o.abort(),u&&ut.storagemutated.unsubscribe(p))}};s.start&&s.start(v);var u=!1,x=function(){return qr(g)},p=function(b){xr(h,b),sn(m,h)&&x()},g=function(){var b,y,k;!c&&_r.indexedDB&&(h={},b={},o&&o.abort(),o=new AbortController,k=function(_){var N=Et();try{i&&Ft();var C=at(e,_);return C=i?C.finally(ot):C}finally{N&&St()}}(y={subscr:b,signal:o.signal,requery:x,querier:e,trans:null}),Promise.resolve(k).then(function(_){r=!0,t=_,c||y.signal.aborted||(h={},function(N){for(var C in N)if(Z(N,C))return;return 1}(m=b)||u||(ut(Ht,p),u=!0),qr(function(){return!c&&s.next&&s.next(_)}))},function(_){r=!1,["DatabaseClosedError","AbortError"].includes(_?.name)||c||qr(function(){c||s.error&&s.error(_)})}))};return setTimeout(x,0),v});return n.hasValue=function(){return r},n.getValue=function(){return t},n}var kt=et;function pn(e){var t=dt;try{dt=!0,ut.storagemutated.fire(e),ln(e,!0)}finally{dt=t}}X(kt,d(d({},Jt),{delete:function(e){return new kt(e,{addons:[]}).delete()},exists:function(e){return new kt(e,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return t=kt.dependencies,r=t.indexedDB,t=t.IDBKeyRange,(tn(r)?Promise.resolve(r.databases()).then(function(n){return n.map(function(s){return s.name}).filter(function(s){return s!==lr})}):en(r,t).toCollection().primaryKeys()).then(e)}catch{return _e(new Y.MissingAPI)}var t,r},defineClass:function(){return function(e){B(this,e)}},ignoreTransaction:function(e){return H.trans?vt(H.transless,e):e()},vip:rn,async:function(e){return function(){try{var t=cn(e.apply(this,arguments));return t&&typeof t.then=="function"?t:M.resolve(t)}catch(r){return _e(r)}}},spawn:function(e,t,r){try{var n=cn(e.apply(r,t||[]));return n&&typeof n.then=="function"?n:M.resolve(n)}catch(s){return _e(s)}},currentTransaction:{get:function(){return H.trans||null}},waitFor:function(e,t){return t=M.resolve(typeof e=="function"?kt.ignoreTransaction(e):e).timeout(t||6e4),H.trans?H.trans.waitFor(t):t},Promise:M,debug:{get:function(){return Ye},set:function(e){_n(e)}},derive:ie,extend:B,props:X,override:ye,Events:Vt,on:ut,liveQuery:ts,extendObservabilitySet:xr,getByKeyPath:oe,setByKeyPath:U,delByKeyPath:function(e,t){typeof t=="string"?U(e,t,void 0):"length"in t&&[].map.call(t,function(r){U(e,r,void 0)})},shallowClone:te,deepClone:z,getObjectDiff:un,cmp:le,asap:pe,minKey:-1/0,addons:[],connections:Dt,errnames:Or,dependencies:_r,cache:wt,semVer:"4.0.11",version:"4.0.11".split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,r){return e+t/Math.pow(10,2*r)})})),kt.maxKey=Wt(kt.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(ut(Ht,function(e){dt||(e=new CustomEvent(Wr,{detail:e}),dt=!0,dispatchEvent(e),dt=!1)}),addEventListener(Wr,function(e){e=e.detail,dt||pn(e)}));var At,dt=!1,rs=function(){};return typeof BroadcastChannel<"u"&&((rs=function(){(At=new BroadcastChannel(Wr)).onmessage=function(e){return e.data&&pn(e.data)}})(),typeof At.unref=="function"&&At.unref(),ut(Ht,function(e){dt||At.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!et.disableBfCache&&e.persisted){Ye&&console.debug("Dexie: handling persisted pagehide"),At?.close();for(var t=0,r=Dt;t<r.length;t++)r[t].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!et.disableBfCache&&e.persisted&&(Ye&&console.debug("Dexie: handling persisted pageshow"),rs(),pn({all:new Oe(-1/0,[[]])}))})),M.rejectionMapper=function(e,t){return!e||e instanceof Nt||e instanceof TypeError||e instanceof SyntaxError||!e.name||!jn[e.name]?e:(t=new jn[e.name](t||e.message,e),"stack"in e&&Q(t,"stack",{get:function(){return this.inner.stack}}),t)},_n(Ye),d(et,Object.freeze({__proto__:null,Dexie:et,liveQuery:ts,Entity:On,cmp:le,PropModification:zt,replacePrefix:function(e,t){return new zt({replacePrefix:[e,t]})},add:function(e){return new zt({add:e})},remove:function(e){return new zt({remove:e})},default:et,RangeSet:Oe,mergeRanges:Gt,rangesOverlap:Un}),{default:et}),et})}(Sr)),Sr.exports}var Qs=Gs();const xn=$s(Qs),is=Symbol.for("Dexie"),Dr=globalThis[is]||(globalThis[is]=xn);if(xn.semVer!==Dr.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${xn.semVer} and ${Dr.semVer}`);const{liveQuery:bi,mergeRanges:xi,rangesOverlap:wi,RangeSet:ki,cmp:ji,Entity:_i,PropModification:Ni,replacePrefix:Ci,add:Ei,remove:Si}=Dr;class Zs extends Dr{files;lines;csvLines;originalLines;constructor(){super("LineFilterDB"),this.version(1).stores({files:"id, name, type, uploadedAt",lines:"++id, lineNumber",csvLines:"++id, lineNumber"}),this.version(2).stores({files:"id, name, type, uploadedAt",lines:"++id, lineNumber",csvLines:"++id, lineNumber",originalLines:"++id, fileId"})}}class Js{db;constructor(){this.db=new Zs}async storeTextLines(l,f){try{const d=f.map((j,S)=>({content:j,lineNumber:S+1}));await this.db.transaction("rw",this.db.lines,async()=>{await this.db.lines.clear(),await this.db.lines.bulkAdd(d)})}catch(d){throw new Error(`Failed to store text lines: ${d instanceof Error?d.message:"Unknown error"}`)}}async storeCSVLines(l,f,d){try{const j=f.map((S,E)=>({lineNumber:E+1,data:S,originalContent:S.join(",")}));await this.db.transaction("rw",this.db.csvLines,async()=>{await this.db.csvLines.clear(),await this.db.csvLines.bulkAdd(j)})}catch(j){throw new Error(`Failed to store CSV lines: ${j instanceof Error?j.message:"Unknown error"}`)}}async storeFileData(l){try{await this.db.files.put(l)}catch(f){throw new Error(`Failed to store file data: ${f instanceof Error?f.message:"Unknown error"}`)}}async getFileData(l){try{return await this.db.files.get(l)}catch(f){throw new Error(`Failed to get file data: ${f instanceof Error?f.message:"Unknown error"}`)}}async getTextLines(l,f){try{let d=this.db.lines.orderBy("lineNumber");return f&&(d=d.offset(f)),l&&(d=d.limit(l)),await d.toArray()}catch(d){throw new Error(`Failed to get text lines: ${d instanceof Error?d.message:"Unknown error"}`)}}async getCSVLines(l,f){try{let d=this.db.csvLines.orderBy("lineNumber");return f&&(d=d.offset(f)),l&&(d=d.limit(l)),await d.toArray()}catch(d){throw new Error(`Failed to get CSV lines: ${d instanceof Error?d.message:"Unknown error"}`)}}async getLinesByNumbers(l,f){try{return f==="text"?await this.db.lines.where("lineNumber").anyOf(l).toArray():await this.db.csvLines.where("lineNumber").anyOf(l).toArray()}catch(d){throw new Error(`Failed to get lines by numbers: ${d instanceof Error?d.message:"Unknown error"}`)}}async getLineCount(){try{const[l,f]=await Promise.all([this.db.lines.count(),this.db.csvLines.count()]);return{text:l,csv:f}}catch(l){throw new Error(`Failed to get line count: ${l instanceof Error?l.message:"Unknown error"}`)}}async clearData(){try{await this.db.transaction("rw",[this.db.files,this.db.lines,this.db.csvLines,this.db.originalLines],async()=>{await Promise.all([this.db.files.clear(),this.db.lines.clear(),this.db.csvLines.clear(),this.db.originalLines.clear()])})}catch(l){throw new Error(`Failed to clear data: ${l instanceof Error?l.message:"Unknown error"}`)}}async getAllTextLinesForFiltering(){try{return await this.db.lines.orderBy("lineNumber").toArray()}catch(l){throw new Error(`Failed to get all text lines: ${l instanceof Error?l.message:"Unknown error"}`)}}async getAllCSVLinesForFiltering(){try{return await this.db.csvLines.orderBy("lineNumber").toArray()}catch(l){throw new Error(`Failed to get all CSV lines: ${l instanceof Error?l.message:"Unknown error"}`)}}async hasData(l){try{if(!await this.db.files.get(l))return!1;const d=await this.getLineCount();return d.text>0||d.csv>0}catch(f){return console.warn("Failed to check if data exists:",f),!1}}async storeOriginalLines(l,f){try{await this.db.originalLines.clear(),await this.db.originalLines.add({fileId:l,lines:f})}catch(d){throw new Error(`Failed to store original lines: ${d instanceof Error?d.message:"Unknown error"}`)}}async getOriginalLines(l){try{return(await this.db.originalLines.where("fileId").equals(l).first())?.lines||[]}catch(f){return console.warn("Failed to get original lines:",f),[]}}async clearCSVData(){try{await this.db.csvLines.clear()}catch(l){throw new Error(`Failed to clear CSV data: ${l instanceof Error?l.message:"Unknown error"}`)}}async deleteDatabase(){try{await this.db.delete()}catch(l){throw new Error(`Failed to delete database: ${l instanceof Error?l.message:"Unknown error"}`)}}}const be=new Js;class $e{static MAX_FILE_SIZE=5*1024*1024;static MAX_LINES=1e4;static CSV_DELIMITERS=[",",";","	","|"];async parseFile(l,f=!0){this.validateFile(l);const d=await this.readFileContent(l),j=this.splitIntoLines(d);this.validateLineCount(j);const S=this.detectFileType(l,j),E=this.generateFileId(l);if(S==="csv"){const{csvData:R,headers:B,delimiter:q}=this.parseCSV(j,f);return{data:{csvData:R,headers:B},fileInfo:{id:E,name:l.name,type:"csv",size:l.size,lineCount:R.length,headers:B},delimiter:q}}else return{data:{lines:j},fileInfo:{id:E,name:l.name,type:"text",size:l.size,lineCount:j.length}}}parseText(l,f=!0){const d=this.splitIntoLines(l);this.validateLineCount(d);const j=this.detectTextType(d),S=this.generateTextId();if(j==="csv"){const{csvData:E,headers:R,delimiter:B}=this.parseCSV(d,f);return{data:{csvData:E,headers:R},fileInfo:{id:S,name:"Pasted Text",type:"csv",size:l.length,lineCount:E.length,headers:R},delimiter:B}}else return{data:{lines:d},fileInfo:{id:S,name:"Pasted Text",type:"text",size:l.length,lineCount:d.length}}}detectFileType(l,f){const d=l.name.toLowerCase().split(".").pop();return d==="csv"||d==="tsv"?"csv":this.detectTextType(f)}detectTextType(l){if(l.length===0)return"text";const f=Math.min(5,l.length),d=l.slice(0,f);for(const j of $e.CSV_DELIMITERS)if(this.looksLikeCSV(d,j))return"csv";return"text"}looksLikeCSV(l,f){if(l.length<2)return!1;const d=l.map(E=>E.split(f).length),j=d[0];return j<2?!1:d.every(E=>E===j)}extractCSVHeaders(l,f=",",d=!0){if(l.length===0)return[];if(d)return l[0].split(f).map(j=>j.trim().replace(/^["']|["']$/g,""));{const j=l[0].split(f).length;return Array.from({length:j},(S,E)=>`Column ${E+1}`)}}parseCSV(l,f=!0){let d=",",j=0;for(const B of $e.CSV_DELIMITERS)if(l.length>0){const q=l[0].split(B).length;q>j&&this.looksLikeCSV(l.slice(0,Math.min(3,l.length)),B)&&(j=q,d=B)}const S=this.extractCSVHeaders(l,d,f);return{csvData:(f?l.slice(1):l).map(B=>B.split(d).map(q=>q.trim().replace(/^["']|["']$/g,""))),headers:S,delimiter:d}}validateFile(l){if(l.size>$e.MAX_FILE_SIZE)throw new Error(`File size exceeds maximum limit of ${$e.MAX_FILE_SIZE/1024/1024}MB`)}validateLineCount(l){if(l.length>$e.MAX_LINES)throw new Error(`File contains ${l.length} lines, which exceeds the maximum limit of ${$e.MAX_LINES} lines`)}async readFileContent(l){return new Promise((f,d)=>{const j=new FileReader;j.onload=S=>{S.target?.result?f(S.target.result):d(new Error("Failed to read file content"))},j.onerror=()=>{d(new Error("File reading failed"))},j.readAsText(l)})}splitIntoLines(l){return l.split(/\r?\n/).filter(f=>f.trim().length>0)}generateFileId(l){return`file_${Date.now()}_${Math.random().toString(36).substr(2,9)}_${l.name.replace(/[^a-zA-Z0-9]/g,"")}`}generateTextId(){return`text_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static getMaxFileSize(){return $e.MAX_FILE_SIZE}static getMaxLines(){return $e.MAX_LINES}static getSupportedDelimiters(){return[...$e.CSV_DELIMITERS]}reParseCSV(l,f){return this.parseCSV(l,f)}}const yn=new $e;class ei{worker=null;isInitialized=!1;callbacks={};currentData=null;currentDataType=null;async initialize(){if(!this.isInitialized)try{this.worker=new Worker("/filter.worker.js"),this.setupWorkerListeners(),await new Promise((l,f)=>{const d=setTimeout(()=>{f(new Error("Worker initialization timeout"))},5e3),j=S=>{S.data.type==="ready"&&(clearTimeout(d),this.worker?.removeEventListener("message",j),l())};this.worker?.addEventListener("message",j)}),this.isInitialized=!0}catch(l){throw new Error(`Failed to initialize worker: ${l instanceof Error?l.message:"Unknown error"}`)}}async setData(l,f){if(!this.worker||!this.isInitialized)throw new Error("Worker not initialized");return this.currentData=l,this.currentDataType=f,new Promise((d,j)=>{const S=setTimeout(()=>{j(new Error("Set data timeout"))},1e4),E=R=>{R.data.type==="dataSet"?(clearTimeout(S),this.worker?.removeEventListener("message",E),R.data.payload.success?d():j(new Error("Failed to set data in worker"))):R.data.type==="error"&&(clearTimeout(S),this.worker?.removeEventListener("message",E),j(new Error(R.data.payload.error)))};this.worker?.addEventListener("message",E),this.worker?.postMessage({type:"setData",payload:{data:l,dataType:f}})})}async filter(l,f={}){if(!this.worker||!this.isInitialized)throw new Error("Worker not initialized");if(!this.currentData)throw new Error("No data loaded in worker");return this.callbacks=f,new Promise((d,j)=>{const S=setTimeout(()=>{j(new Error("Filter operation timeout"))},3e4),E=R=>{const{type:B,payload:q}=R.data;switch(B){case"progress":q.filterId===l.filterId&&f.onProgress&&f.onProgress(q.filterId,q.progress,q.processedLines,q.totalLines);break;case"complete":if(q.filterId===l.filterId){clearTimeout(S),this.worker?.removeEventListener("message",E);const Z={filterId:q.filterId,matchedLines:q.matchedLines,totalMatches:q.totalMatches,processingTime:q.processingTime};f.onComplete&&f.onComplete(Z),d(Z)}break;case"error":clearTimeout(S),this.worker?.removeEventListener("message",E);const W=q.error||"Unknown worker error";f.onError&&f.onError(l.filterId,W),j(new Error(W));break}};this.worker?.addEventListener("message",E),this.worker?.postMessage({type:"filter",payload:l})})}clearData(){this.worker&&this.isInitialized&&(this.worker.postMessage({type:"clear"}),this.currentData=null,this.currentDataType=null)}terminate(){this.worker&&(this.worker.terminate(),this.worker=null,this.isInitialized=!1,this.currentData=null,this.currentDataType=null,this.callbacks={})}setupWorkerListeners(){this.worker&&(this.worker.addEventListener("error",l=>{console.error("Worker error:",l),this.callbacks.onError&&this.callbacks.onError("unknown",`Worker error: ${l.message}`)}),this.worker.addEventListener("messageerror",l=>{console.error("Worker message error:",l),this.callbacks.onError&&this.callbacks.onError("unknown","Worker message error")}))}isReady(){return this.isInitialized&&this.worker!==null}hasData(){return this.currentData!==null}getDataInfo(){return{lineCount:this.currentData?this.currentData.length:0,dataType:this.currentDataType}}}const Re=new ei,Be=De("none"),We=De(0),Qe=De([]),He=De(!0),nt=De(","),ft=De(null),Lt=De(null),Te=De("idle"),Ee=De(0),Me=De(null),Ce=os({}),Ue=os({}),_t=De(!1),gn=De(0),vn=De(!1),bn=De(null),rt=De(1),wn=De(100),as=De(null),Fr=Qt([Be,We],(w,l)=>w!=="none"&&l>0),ls=Qt([Fr,_t],(w,l)=>w&&!l);Qt(Ce,w=>Object.keys(w).length);Qt(Ue,w=>Object.values(w).reduce((l,f)=>l+f.totalMatches,0));Qt(Te,w=>w!=="idle"&&w!=="complete"&&w!=="error");const je={async loadFile(w){try{Te.set("uploading"),Ee.set(0),Me.set(null);const l=He.get(),f=await yn.parseFile(w,l);Te.set("parsing"),Ee.set(30);const d={...f.fileInfo,uploadedAt:new Date};if(await be.storeFileData(d),Ee.set(60),f.fileInfo.type==="csv"&&f.data.csvData){const E=(await w.text()).split(/\r?\n/).filter(R=>R.trim().length>0);await be.storeOriginalLines(d.id,E),await be.storeCSVLines(d.id,f.data.csvData,f.data.headers),Qe.set(f.data.headers||[]),nt.set(f.delimiter||",")}else f.data.lines&&await be.storeTextLines(d.id,f.data.lines);Ee.set(80),Re.isReady()||await Re.initialize();let j;f.fileInfo.type==="csv"?j=await be.getAllCSVLinesForFiltering():j=await be.getAllTextLinesForFiltering(),await Re.setData(j,f.fileInfo.type),Be.set(f.fileInfo.type),We.set(f.fileInfo.lineCount),ft.set(d.id),Lt.set(d.name),Ee.set(100),Te.set("complete"),tt()}catch(l){const f=l instanceof Error?l.message:"Failed to load file";throw Me.set(f),Te.set("error"),l}},async loadText(w){try{Te.set("parsing"),Ee.set(0),Me.set(null);const l=He.get(),f=yn.parseText(w,l);Ee.set(30);const d={...f.fileInfo,uploadedAt:new Date};if(await be.storeFileData(d),Ee.set(60),f.fileInfo.type==="csv"&&f.data.csvData){const S=w.split(/\r?\n/).filter(E=>E.trim().length>0);await be.storeOriginalLines(d.id,S),await be.storeCSVLines(d.id,f.data.csvData,f.data.headers),Qe.set(f.data.headers||[]),nt.set(f.delimiter||",")}else f.data.lines&&await be.storeTextLines(d.id,f.data.lines);Ee.set(80),Re.isReady()||await Re.initialize();let j;f.fileInfo.type==="csv"?j=await be.getAllCSVLinesForFiltering():j=await be.getAllTextLinesForFiltering(),await Re.setData(j,f.fileInfo.type),Be.set(f.fileInfo.type),We.set(f.fileInfo.lineCount),ft.set(d.id),Lt.set(d.name),Ee.set(100),Te.set("complete"),tt()}catch(l){const f=l instanceof Error?l.message:"Failed to load text";throw Me.set(f),Te.set("error"),l}},async addFilter(w){const l=Ce.get();Ce.set({...l,[w.id]:w});try{await this.applyFilter(w.id),tt()}catch(f){throw console.error("Failed to auto-apply filter:",f),this.removeFilter(w.id),f}},removeFilter(w){const f={...Ce.get()};delete f[w],Ce.set(f);const j={...Ue.get()};delete j[w],Ue.set(j),rt.set(1),tt()},updateFilter(w,l){const f=Ce.get(),d=f[w];d&&(Ce.set({...f,[w]:{...d,...l}}),tt())},toggleFilter(w){const f=Ce.get()[w];f&&this.updateFilter(w,{isActive:!f.isActive})},async applyFilter(w){const l=Ce.get()[w];if(!l)throw new Error("Filter not found");try{_t.set(!0),Me.set(null);const f={filterId:l.id,pattern:l.pattern,patterns:l.patterns,filterType:l.type,caseSensitive:l.caseSensitive,useRegex:l.useRegex,columnIndex:"columnIndex"in l?l.columnIndex:void 0,scope:"scope"in l?l.scope:"all"},d=await Re.filter(f,{onProgress:(S,E)=>{Ee.set(E)},onError:(S,E)=>{Me.set(E)}}),j=Ue.get();return Ue.set({...j,[w]:d}),rt.set(1),gn.set(Date.now()),d}catch(f){const d=f instanceof Error?f.message:"Filter operation failed";throw Me.set(d),f}finally{_t.set(!1)}},async applyAllActiveFilters(){const w=Ce.get(),l=Object.keys(w).filter(f=>w[f].isActive);for(const f of l)await this.applyFilter(f)},clearFilters(){Ce.set({}),Ue.set({}),rt.set(1),tt()},async clearAllData(){try{await be.clearData(),Re.clearData(),Be.set("none"),We.set(0),Qe.set([]),He.set(!0),nt.set(","),ft.set(null),Lt.set(null),Te.set("idle"),Ee.set(0),Me.set(null),Ce.set({}),Ue.set({}),_t.set(!1),gn.set(0),rt.set(1),ri()}catch(w){const l=w instanceof Error?w.message:"Failed to clear data";throw Me.set(l),w}},openModal(){vn.set(!0)},closeModal(){vn.set(!1),bn.set(null)},selectFilter(w){bn.set(w)},setFocus(w){as.set(w)},setPage(w){rt.set(w)},async setHasHeaders(w){const l=Be.get(),f=ft.get();if(l!=="csv"||!f){He.set(w),tt();return}try{Te.set("parsing"),Ee.set(0);const d=await this.getOriginalCSVLines();if(d.length===0){He.set(w),tt(),Te.set("complete");return}Ee.set(30);const{csvData:j,headers:S,delimiter:E}=yn.reParseCSV(d,w);if(Ee.set(60),await be.clearCSVData(),await be.storeCSVLines(f,j,S),Ee.set(80),He.set(w),Qe.set(S),We.set(j.length),nt.set(E),Ce.set({}),Ue.set({}),rt.set(1),Re.isReady()){const R=await be.getAllCSVLinesForFiltering();await Re.setData(R,"csv")}Ee.set(100),Te.set("complete"),tt()}catch(d){console.error("Failed to update header setting:",d),Me.set("Failed to update header setting"),Te.set("error")}},async getOriginalCSVLines(){const w=ft.get();return w?await be.getOriginalLines(w):[]},setDelimiter(w){nt.set(w)},getState(){return{data:{fileId:ft.get(),fileName:Lt.get(),dataType:Be.get(),lineCount:We.get(),csvHeaders:Qe.get(),hasHeaders:He.get(),delimiter:nt.get()},processing:{status:Te.get(),progress:Ee.get(),error:Me.get()},filters:{active:Object.keys(Ce.get()),results:Object.values(Ue.get()),isFiltering:_t.get(),lastFilterTime:gn.get()},ui:{isModalOpen:vn.get(),selectedFilter:bn.get(),currentPage:rt.get(),pageSize:wn.get(),focusedElement:as.get()}}}},Tt="lineFilterState",tt=()=>{try{const w={fileId:ft.get()||"",fileName:Lt.get()||"",dataType:Be.get(),lineCount:We.get(),csvHeaders:Qe.get(),hasHeaders:He.get(),delimiter:nt.get(),activeFilters:Ce.get(),timestamp:Date.now()};w.dataType!=="none"&&w.fileId&&localStorage.setItem(Tt,JSON.stringify(w))}catch(w){console.warn("Failed to save state to localStorage:",w)}},ti=async()=>{try{const w=localStorage.getItem(Tt);if(!w)return!1;const l=JSON.parse(w),f=1440*60*1e3;if(Date.now()-l.timestamp>f||!await be.hasData(l.fileId))return localStorage.removeItem(Tt),!1;ft.set(l.fileId),Lt.set(l.fileName),Be.set(l.dataType),We.set(l.lineCount),Qe.set(l.csvHeaders),He.set(l.hasHeaders),nt.set(l.delimiter),Ce.set(l.activeFilters),Re.isReady()||await Re.initialize();let j;l.dataType==="csv"?j=await be.getAllCSVLinesForFiltering():j=await be.getAllTextLinesForFiltering(),await Re.setData(j,l.dataType);const S=Object.values(l.activeFilters).filter(E=>E.isActive);for(const E of S)try{await je.applyFilter(E.id)}catch(R){console.warn("Failed to restore filter:",E.id,R)}return!0}catch(w){return console.warn("Failed to restore state from localStorage:",w),localStorage.removeItem(Tt),!1}},ri=()=>{try{localStorage.removeItem(Tt)}catch(w){console.warn("Failed to clear stored state:",w)}},ni=async()=>{try{await Re.initialize(),await ti()&&console.log("Restored previous line filter session")}catch(w){console.error("Failed to initialize line filter store:",w),Me.set("Failed to initialize filtering system")}};class si{shortcuts=new Map;isEnabled=!0;isBrowser;constructor(){this.isBrowser=typeof window<"u",this.isBrowser&&document.addEventListener("keydown",this.handleKeyDown.bind(this))}generateShortcutId(l){const f=[l.ctrlKey?"Ctrl":"",l.metaKey?"Meta":"",l.shiftKey?"Shift":"",l.altKey?"Alt":""].filter(Boolean).join("+");return f?`${f}+${l.key}`:l.key}register(l){const f=this.generateShortcutId(l);return this.shortcuts.set(f,{...l,id:f}),f}unregister(l){return this.shortcuts.delete(l)}enable(){this.isEnabled=!0}disable(){this.isEnabled=!1}handleKeyDown(l){if(!this.isEnabled)return;const f=l.target;if(f.tagName==="INPUT"||f.tagName==="TEXTAREA"||f.isContentEditable){const d=(l.metaKey||l.ctrlKey)&&l.key==="k",j=(l.metaKey||l.ctrlKey)&&l.key==="Enter";if(!d&&!j)return}for(const d of this.shortcuts.values())if(l.key.toLowerCase()===d.key.toLowerCase()&&!!l.ctrlKey==!!d.ctrlKey&&!!l.metaKey==!!d.metaKey&&!!l.shiftKey==!!d.shiftKey&&!!l.altKey==!!d.altKey){d.handler(l);return}}getShortcuts(){return Array.from(this.shortcuts.values())}formatShortcut(l){const f=this.shortcuts.get(l);if(!f)return"";const d=[];f.ctrlKey&&d.push("Ctrl"),f.metaKey&&d.push("â"),f.shiftKey&&d.push("â§"),f.altKey&&d.push("â¥");let j=f.key;return j===" "?j="Space":j==="ArrowUp"?j="â":j==="ArrowDown"?j="â":j==="ArrowLeft"?j="â":j==="ArrowRight"?j="â":j==="Enter"?j="âµ":j==="Escape"?j="Esc":j.length===1&&(j=j.toUpperCase()),d.push(j),d.join("+")}}const ii=()=>new si,It=typeof window<"u"?ii():{register:()=>"",unregister:()=>!1,enable:()=>{},disable:()=>{},getShortcuts:()=>[],formatShortcut:()=>""},ai=({className:w=""})=>{const[l,f]=F.useState(!1),[d,j]=F.useState(""),[S,E]=F.useState("both"),R=F.useRef(null),B=se(Te),q=se(Ee),W=se(Me),Z=se(He),X=B==="uploading"||B==="parsing",K=F.useMemo(()=>{if(!d.trim())return null;const z=d.split(`
`).filter(V=>V.trim().length>0);if(z.length<2)return null;const T=[{char:",",name:"Comma"},{char:";",name:"Semicolon"},{char:"	",name:"Tab"}];for(const V of T){const G=z[0].split(V.char).length;if(G>1&&z.slice(0,Math.min(3,z.length)).every(Ke=>Ke.split(V.char).length===G))return{delimiter:V.name,columns:G,format:`${V.name} CSV (${G} columns)`}}return null},[d]),Q=d.split(`
`).filter(z=>z.trim().length>0).length,ie=d.trim().length>0,he=F.useCallback(async z=>{try{E("file-focused"),j(""),await je.loadFile(z)}catch(T){console.error("File upload failed:",T),E("both")}},[]),ae=F.useCallback(z=>{const T=z.target.files?.[0];T&&he(T)},[he]),de=F.useCallback(z=>{z.preventDefault(),f(!1);const T=z.dataTransfer.files[0];T&&he(T)},[he]),ye=F.useCallback(z=>{z.preventDefault(),f(!0)},[]),xe=F.useCallback(z=>{z.preventDefault(),f(!1)},[]),pe=F.useCallback(()=>{R.current?.click()},[]),oe=F.useCallback(z=>{const T=z.target.value;j(T),T.trim()?E("text-focused"):S==="text-focused"&&E("both")},[S]),U=F.useCallback(z=>{const T=z.clipboardData.getData("text");T&&(j(T),E("text-focused"))},[]),te=F.useCallback(async()=>{if(d.trim())try{await je.loadText(d),j(""),E("both")}catch(z){console.error("Text processing failed:",z)}},[d]),ge=F.useCallback(()=>{j(""),E("both")},[]),ke=$e.getMaxFileSize(),Pe=$e.getMaxLines(),ce=Math.round(ke/1024/1024);return a.jsx("div",{className:`${w}`,children:a.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-xl overflow-hidden shadow-sm hover:shadow-md transition-all duration-200",children:[a.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 px-6 py-4 border-b border-gray-200",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Add Your Data"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Upload a file or paste text directly"})]})]})}),a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsxs("div",{className:`
              relative border-2 border-dashed rounded-lg text-center transition-all duration-200
              ${l?"border-blue-400 bg-blue-50 scale-[1.01]":"border-gray-300 hover:border-blue-300"}
              ${S==="text-focused"?"opacity-60 bg-gray-50":"opacity-100"}
              ${X?"opacity-50 cursor-not-allowed":"cursor-pointer hover:bg-gray-50"}
            `,onDrop:de,onDragOver:ye,onDragLeave:xe,onClick:X?void 0:pe,children:[a.jsx("input",{ref:R,type:"file",accept:".txt,.csv,.tsv,.log",onChange:ae,className:"hidden",disabled:X}),a.jsxs("div",{className:"py-8",children:[a.jsx("div",{className:"flex justify-center mb-4",children:a.jsx("svg",{className:`w-10 h-10 ${l?"text-blue-500":"text-gray-400"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),a.jsx("p",{className:"text-base font-medium text-gray-700 mb-2",children:l?"Drop your file here":"Drop file or click to browse"}),a.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Supports .txt, .csv, .tsv, .log files"}),a.jsxs("div",{className:"inline-flex items-center space-x-3 text-xs text-gray-400 bg-gray-50 px-3 py-2 rounded-full",children:[a.jsxs("span",{children:["Max: ",ce,"MB"]}),a.jsx("span",{children:"â¢"}),a.jsxs("span",{children:[Pe.toLocaleString()," lines"]})]})]})]}),a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-0 flex items-center",children:a.jsx("div",{className:"w-full border-t border-gray-200"})}),a.jsx("div",{className:"relative flex justify-center",children:a.jsx("span",{className:"bg-white px-4 text-sm font-medium text-gray-500",children:"OR"})})]}),a.jsx("div",{className:`transition-all duration-200 ${S==="file-focused"?"opacity-60 bg-gray-50 rounded-lg":"opacity-100"}`,children:a.jsxs("div",{className:"border border-gray-300 rounded-lg overflow-hidden focus-within:border-blue-500 focus-within:ring-1 focus-within:ring-blue-500",children:[a.jsx("textarea",{value:d,onChange:oe,onPaste:U,placeholder:"Paste your text data here, or start typing...",className:"w-full h-32 p-4 text-sm font-mono resize-none border-0 focus:outline-none focus:ring-0 placeholder-gray-400",disabled:X}),ie&&a.jsxs("div",{className:"bg-gray-50 px-4 py-2 border-t border-gray-200 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx("svg",{className:"w-4 h-4 mr-1 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),Q," lines ready"]}),K&&a.jsxs("div",{className:"flex items-center text-sm text-blue-600",children:[a.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),K.format]})]}),a.jsx("button",{type:"button",onClick:ge,className:"text-sm text-gray-500 hover:text-red-600 font-medium",disabled:X,children:"Clear"})]})]})}),K&&a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("svg",{className:"w-5 h-5 text-blue-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("p",{className:"text-sm font-medium text-blue-900 mb-2",children:["CSV Format Detected: ",K.format]}),a.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:Z,onChange:z=>je.setHasHeaders(z.target.checked),className:"rounded border-blue-300 text-blue-600 focus:ring-blue-500 focus:ring-offset-0",disabled:X}),a.jsx("span",{className:"text-sm text-blue-800",children:"First row contains column headers"})]})]})]})}),X&&a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-medium text-blue-900",children:B==="uploading"?"Uploading file...":"Processing data..."}),a.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2 mt-2",children:a.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${q}%`}})}),a.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:[q,"% complete"]})]})]})}),W&&a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("svg",{className:"h-5 w-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),a.jsx("div",{className:"ml-3",children:a.jsx("p",{className:"text-sm text-red-700 font-medium",children:W})})]})}),!X&&a.jsx("div",{className:"text-center",children:a.jsxs("button",{type:"button",onClick:te,disabled:!ie,className:`inline-flex items-center px-8 py-4 text-lg font-semibold rounded-lg focus:outline-none focus:ring-4 transform transition-all duration-200 shadow-lg ${ie?"text-white bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 hover:scale-105 active:scale-95 focus:ring-blue-300 hover:shadow-xl":"text-gray-500 bg-gray-300 cursor-not-allowed focus:ring-gray-300"}`,children:["Process",a.jsx("svg",{className:"w-5 h-5 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7l5 5m0 0l-5 5m5-5H6"})})]})})]})]})})},oi=({className:w=""})=>{const l=se(Be),f=se(We),d=se(Qe),j=se(He);if(se(nt),l==="none")return null;const S=()=>l==="csv"?`${l.toUpperCase()} â¢ ${f.toLocaleString()} lines â¢ ${d.length} columns`:`${l.toUpperCase()} â¢ ${f.toLocaleString()} lines`;return a.jsx("div",{className:`${w}`,children:a.jsxs("div",{className:"inline-flex items-center space-x-2",children:[a.jsxs("div",{className:"flex items-center space-x-2 bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm",children:[a.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),a.jsx("span",{className:"font-medium",children:S()})]}),l==="csv"&&a.jsxs("label",{className:"flex items-center space-x-1 cursor-pointer text-sm text-gray-600 hover:text-gray-800",children:[a.jsx("input",{type:"checkbox",checked:j,onChange:E=>je.setHasHeaders(E.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500 focus:ring-offset-0 w-3 h-3"}),a.jsx("span",{className:"text-xs",children:"Headers"})]})]})})},cs=({patterns:w,onPatternsChange:l,onAddFilter:f,placeholder:d="Enter pattern...",disabled:j=!1,className:S=""})=>{const[E,R]=F.useState(""),[B,q]=F.useState(null),[W,Z]=F.useState(""),X=F.useRef(null),K=F.useCallback(()=>`pattern_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,[]),Q=F.useCallback(U=>U.trim()?{isValid:!0}:{isValid:!1,error:"Pattern cannot be empty"},[]),ie=F.useCallback(()=>{if(!E.trim())return;const U=Q(E),te={id:K(),value:E.trim(),isValid:U.isValid,error:U.error};l([...w,te]),R(""),setTimeout(()=>X.current?.focus(),0)},[E,w,l,K,Q]),he=F.useCallback(U=>{l(w.filter(te=>te.id!==U)),setTimeout(()=>X.current?.focus(),0)},[w,l]),ae=F.useCallback(U=>{q(U.id),Z(U.value)},[]),de=F.useCallback(()=>{if(!B||!W.trim()){q(null);return}const U=Q(W),te=w.map(ge=>ge.id===B?{...ge,value:W.trim(),isValid:U.isValid,error:U.error}:ge);l(te),q(null),Z(""),setTimeout(()=>X.current?.focus(),0)},[B,W,w,l,Q]),ye=F.useCallback(()=>{q(null),Z(""),setTimeout(()=>X.current?.focus(),0)},[]),xe=F.useCallback(U=>{switch(U.key){case"Enter":U.preventDefault(),U.shiftKey?(E.trim()&&ie(),f()):ie();break;case"Backspace":if(!E&&w.length>0){U.preventDefault();const te=w[w.length-1];he(te.id)}break;case"Escape":U.preventDefault(),E&&R("");break}},[E,w,ie,f,he]),pe=F.useCallback(U=>{switch(U.key){case"Enter":U.preventDefault(),de();break;case"Escape":U.preventDefault(),ye();break}},[de,ye]);F.useEffect(()=>{B||X.current?.focus()},[B]);const oe=w.length>0;return oe||E.trim(),a.jsxs("div",{className:`${S}`,children:[oe&&a.jsxs("div",{className:"flex flex-wrap items-center gap-1 mb-2",children:[w.map(U=>a.jsxs("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs border ${U.isValid?"bg-blue-100 border-blue-300 text-blue-800":"bg-red-100 border-red-300 text-red-800"}`,children:[B===U.id?a.jsx("input",{type:"text",value:W,onChange:te=>Z(te.target.value),onKeyDown:pe,onBlur:de,className:"bg-transparent border-none outline-none text-xs w-20 min-w-0",autoFocus:!0}):a.jsx("span",{onClick:()=>ae(U),className:"cursor-pointer truncate max-w-32",title:U.error||U.value,children:U.value}),a.jsx("button",{type:"button",onClick:()=>he(U.id),className:"ml-1 hover:bg-white hover:bg-opacity-50 rounded-full p-0.5",title:"Remove pattern",disabled:j,children:a.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},U.id)),w.length>1&&a.jsx("span",{className:"text-xs text-gray-500 font-medium px-1",children:"OR"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"flex-1",children:a.jsx("input",{ref:X,type:"text",value:E,onChange:U=>R(U.target.value),onKeyDown:xe,placeholder:oe?"Add another pattern...":d,className:"w-full px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500",disabled:j})}),oe&&a.jsx("button",{type:"button",onClick:ie,disabled:!E.trim()||j,className:"px-2 py-1.5 text-xs text-blue-600 border border-blue-300 rounded-md hover:bg-blue-50 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",title:"Add OR pattern (Enter)",children:"+ OR"})]}),!j&&a.jsx("div",{className:"mt-1 text-xs text-gray-500",children:oe?a.jsx("span",{children:"Press Enter to add OR pattern, Shift+Enter to add filter"}):a.jsx("span",{children:"Press Enter for OR patterns, Shift+Enter to add filter"})})]})},li=({className:w="",onFilterAdded:l,editingFilterId:f,onEditComplete:d})=>{const[j,S]=F.useState([]),[E,R]=F.useState("include"),[B,q]=F.useState(!1),[W,Z]=F.useState(!1),[X,K]=F.useState(""),[Q,ie]=F.useState(!1),he=se(Be),ae=se(ls),de=se(Ce);F.useEffect(()=>{if(f){const te=de[f];if(te&&!("scope"in te)){const ge=Array.isArray(te.patterns)?te.patterns.map((ke,Pe)=>({id:`pattern_${Pe}_${Date.now()}`,value:ke,isValid:!0})):[{id:`pattern_0_${Date.now()}`,value:te.pattern,isValid:!0}];S(ge),R(te.type),q(te.caseSensitive),Z(te.useRegex),ie(!0),K("")}}else ie(!1)},[f,de]),F.useCallback(te=>{if(!te.trim())return{isValid:!1,error:"Pattern cannot be empty"};if(W)try{new RegExp(te)}catch(ge){return{isValid:!1,error:`Invalid regex: ${ge instanceof Error?ge.message:"Unknown error"}`}}return{isValid:!0}},[W]);const ye=F.useCallback(te=>{S(te),K("")},[]),xe=F.useCallback(()=>`filter_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,[]),pe=F.useCallback(async()=>{if(j.length===0||!ae)return;if(j.some(ke=>!ke.isValid)){K("Please fix invalid patterns before adding filter");return}const ge=j.map(ke=>ke.value);if(Q&&f){const ke={patterns:ge,pattern:ge[0],type:E,caseSensitive:B,useRegex:W};try{je.updateFilter(f,ke),await je.applyFilter(f),S([]),K(""),ie(!1),d?.()}catch(Pe){console.error("Failed to update filter:",Pe),K("Failed to update filter. Please try again.")}}else{const ke={id:xe(),patterns:ge,pattern:ge[0],type:E,caseSensitive:B,useRegex:W,isActive:!0,created:new Date};try{await je.addFilter(ke),l?.(ke),S([]),K("")}catch(Pe){console.error("Failed to add filter:",Pe),K("Failed to add filter. Please try again.")}}},[j,E,B,W,ae,xe,l,Q,f,d]);if(he==="none")return null;const oe=F.useCallback(()=>{S([]),K(""),ie(!1),d?.()},[d]),U=j.length>0&&j.every(te=>te.isValid)&&ae;return a.jsxs("div",{className:`${w}`,children:[a.jsx("div",{className:"mb-2",children:a.jsx(cs,{patterns:j,onPatternsChange:ye,onAddFilter:pe,placeholder:"Text filter pattern...",disabled:!ae,className:""})}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs("select",{value:E,onChange:te=>R(te.target.value),className:"px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white",disabled:!ae,children:[a.jsx("option",{value:"include",children:"Include"}),a.jsx("option",{value:"exclude",children:"Exclude"})]}),a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx("button",{type:"button",onClick:()=>q(!B),className:`px-1.5 py-1 text-xs rounded ${B?"bg-blue-100 text-blue-800 border border-blue-300":"bg-gray-100 text-gray-600 border border-gray-300"}`,title:"Case sensitive",disabled:!ae,children:"Aa"}),a.jsx("button",{type:"button",onClick:()=>Z(!W),className:`px-1.5 py-1 text-xs rounded ${W?"bg-blue-100 text-blue-800 border border-blue-300":"bg-gray-100 text-gray-600 border border-gray-300"}`,title:"Use regex",disabled:!ae,children:".*"})]}),a.jsx("button",{type:"button",onClick:pe,disabled:!U,className:"px-3 py-1.5 bg-blue-600 text-white text-xs font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:Q?"Update Filter":"Add Filter"}),Q&&a.jsx("button",{type:"button",onClick:oe,className:"px-2 py-1.5 bg-gray-500 text-white text-xs font-medium rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Cancel"})]}),X&&a.jsx("div",{className:"mt-2",children:a.jsx("p",{className:"text-xs text-red-600",children:X})})]})},ci=({className:w="",onFilterAdded:l,editingFilterId:f,onEditComplete:d})=>{const[j,S]=F.useState([]),[E,R]=F.useState("include"),[B,q]=F.useState(!1),[W,Z]=F.useState(!1),[X,K]=F.useState("all"),[Q,ie]=F.useState(-1),[he,ae]=F.useState(""),[de,ye]=F.useState(!1),xe=se(Be),pe=se(ls),oe=se(Qe),U=se(Ce);F.useEffect(()=>{if(f){const T=U[f];if(T&&"scope"in T){const V=Array.isArray(T.patterns)?T.patterns.map((G,we)=>({id:`pattern_${we}_${Date.now()}`,value:G,isValid:!0})):[{id:`pattern_0_${Date.now()}`,value:T.pattern,isValid:!0}];S(V),R(T.type),q(T.caseSensitive),Z(T.useRegex),K(T.scope),ie(T.columnIndex||-1),ye(!0),ae("")}}else ye(!1)},[f,U]);const te=F.useMemo(()=>oe.map((T,V)=>({index:V,name:T||`Column ${V+1}`,displayName:T?`${T} (${V+1})`:`Column ${V+1}`})),[oe]);F.useCallback(T=>{if(!T.trim())return{isValid:!1,error:"Pattern cannot be empty"};if(W)try{new RegExp(T)}catch(V){return{isValid:!1,error:`Invalid regex: ${V instanceof Error?V.message:"Unknown error"}`}}return{isValid:!0}},[W]);const ge=F.useCallback(T=>{S(T),ae("")},[]);F.useCallback(T=>{K(T),T==="all"?ie(-1):te.length>0&&Q===-1&&ie(0)},[te.length,Q]);const ke=F.useCallback(()=>`csvfilter_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,[]),Pe=F.useCallback(async()=>{if(j.length===0||!pe||X==="column"&&(Q===-1||Q>=oe.length))return;if(j.some(G=>!G.isValid)){ae("Please fix invalid patterns before adding filter");return}const V=j.map(G=>G.value);if(de&&f){const G={patterns:V,pattern:V[0],type:E,caseSensitive:B,useRegex:W,scope:X,columnIndex:X==="column"?Q:void 0,columnName:X==="column"?oe[Q]:void 0};try{je.updateFilter(f,G),await je.applyFilter(f),S([]),ae(""),ye(!1),d?.()}catch(we){console.error("Failed to update filter:",we),ae("Failed to update filter. Please try again.")}}else{const G={id:ke(),patterns:V,pattern:V[0],type:E,caseSensitive:B,useRegex:W,scope:X,columnIndex:X==="column"?Q:void 0,columnName:X==="column"?oe[Q]:void 0,isActive:!0,created:new Date};try{await je.addFilter(G),l?.(G),S([]),ae("")}catch(we){console.error("Failed to add filter:",we),ae("Failed to add filter. Please try again.")}}},[j,E,B,W,X,Q,oe,pe,ke,l,de,f,d]);if(xe!=="csv")return null;Object.keys(U).length;const ce=j.length>0&&j.every(T=>T.isValid)&&pe&&(X==="all"||X==="column"&&Q>=0),z=F.useCallback(()=>{S([]),ae(""),K("all"),ie(-1),ye(!1),d?.()},[d]);return a.jsxs("div",{className:`${w}`,children:[a.jsx("div",{className:"mb-2",children:a.jsx(cs,{patterns:j,onPatternsChange:ge,onAddFilter:Pe,placeholder:"CSV filter pattern...",disabled:!pe,className:""})}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs("select",{value:E,onChange:T=>R(T.target.value),className:"px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white",disabled:!pe,children:[a.jsx("option",{value:"include",children:"Include"}),a.jsx("option",{value:"exclude",children:"Exclude"})]}),a.jsxs("select",{value:X==="column"?Q:"all",onChange:T=>{const V=T.target.value;V==="all"?(K("all"),ie(-1)):(K("column"),ie(parseInt(V)))},className:"px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white",disabled:!pe,children:[a.jsx("option",{value:"all",children:"All columns"}),oe.map((T,V)=>a.jsx("option",{value:V,children:T||`Column ${V+1}`},V))]}),a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx("button",{type:"button",onClick:()=>q(!B),className:`px-1.5 py-1 text-xs rounded ${B?"bg-blue-100 text-blue-800 border border-blue-300":"bg-gray-100 text-gray-600 border border-gray-300"}`,title:"Case sensitive",disabled:!pe,children:"Aa"}),a.jsx("button",{type:"button",onClick:()=>Z(!W),className:`px-1.5 py-1 text-xs rounded ${W?"bg-blue-100 text-blue-800 border border-blue-300":"bg-gray-100 text-gray-600 border border-gray-300"}`,title:"Use regex",disabled:!pe,children:".*"})]}),a.jsx("button",{type:"button",onClick:Pe,disabled:!ce,className:"px-3 py-1.5 bg-blue-600 text-white text-xs font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:de?"Update Filter":"Add Filter"}),de&&a.jsx("button",{type:"button",onClick:z,className:"px-2 py-1.5 bg-gray-500 text-white text-xs font-medium rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Cancel"})]}),he&&a.jsx("div",{className:"mt-2",children:a.jsx("p",{className:"text-xs text-red-600",children:he})})]})},ui=({className:w="",onFilterEdit:l})=>{const f=se(Ce),d=se(Ue),j=se(_t),S=Object.values(f),E=F.useCallback(K=>{je.toggleFilter(K)},[]),R=F.useCallback(K=>{je.removeFilter(K)},[]);F.useCallback(async K=>{try{await je.applyFilter(K)}catch(Q){console.error("Failed to apply filter:",Q)}},[]);const B=F.useCallback(async()=>{try{await je.applyAllActiveFilters()}catch(K){console.error("Failed to apply filters:",K)}},[]),q=F.useCallback(()=>{je.clearFilters()},[]),W=K=>{const Q=K.patterns&&K.patterns.length>0?K.patterns:[K.pattern];return Q.length===1?Q[0]:Q.join(" OR ")},Z=K=>{const Q=K.type.charAt(0).toUpperCase()+K.type.slice(1);let ie="All columns";"scope"in K&&K.scope==="column"&&(ie=K.columnName||`Column ${(K.columnIndex||0)+1}`);const he=[];K.caseSensitive&&he.push("Case sensitive"),K.useRegex&&he.push("Regex");let ae=`${Q} in ${ie}`;return he.length>0&&(ae+=` â¢ ${he.join(", ")}`),ae};if(S.length===0)return null;const X=S.filter(K=>K.isActive).length;return a.jsx("div",{className:`${w}`,children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:X>0?`${X} Active`:"No Filters"}),X>0&&a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",onClick:B,disabled:j,className:"px-2 py-1 bg-blue-600 text-white text-xs font-medium rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Apply"}),a.jsx("button",{type:"button",onClick:q,className:"px-2 py-1 bg-gray-500 text-white text-xs font-medium rounded hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Clear"})]})]}),S.length>0&&a.jsx("div",{className:"flex items-center flex-wrap gap-2",children:S.map(K=>(d[K.id],a.jsxs("div",{className:`inline-flex items-center space-x-1 px-2 py-1 rounded-full text-xs border transition-colors ${K.isActive?"bg-blue-100 border-blue-300 text-blue-800":"bg-gray-100 border-gray-300 text-gray-600"}`,children:[a.jsx("input",{type:"checkbox",checked:K.isActive,onChange:()=>E(K.id),className:"w-3 h-3 rounded"}),a.jsx("span",{className:"truncate max-w-32",title:Z(K),children:W(K)}),a.jsxs("div",{className:"flex items-center space-x-0.5",children:[l&&a.jsx("button",{type:"button",onClick:()=>l(K.id),className:"p-0.5 hover:bg-white hover:bg-opacity-50 rounded",title:"Edit filter",children:a.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),a.jsx("button",{type:"button",onClick:()=>R(K.id),className:"p-0.5 hover:bg-red-200 hover:text-red-800 rounded",title:"Remove filter",children:a.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]},K.id)))}),j&&a.jsxs("div",{className:"inline-flex items-center space-x-2 text-sm text-blue-600",children:[a.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-600"}),a.jsx("span",{children:"Applying..."})]})]})})},di=({className:w=""})=>{const[l,f]=F.useState([]),[d,j]=F.useState(!1),[S,E]=F.useState(null),[R,B]=F.useState(!1),[q,W]=F.useState(null),Z=se(Ue),X=se(Be),K=se(rt),Q=se(wn),ie=se(We),he=se(Ce),ae=F.useMemo(()=>{if(!(Object.keys(he).length>0))return Array.from({length:ie},(V,G)=>G+1);const z=Object.values(he).filter(V=>V.isActive).map(V=>Z[V.id]).filter(V=>V!==void 0);if(z.length===0)return[];let T=new Set(z[0].matchedLines);for(let V=1;V<z.length;V++){const G=new Set(z[V].matchedLines);T=new Set([...T].filter(we=>G.has(we)))}return Array.from(T).sort((V,G)=>V-G)},[Z,he,ie]),de=ae.length,ye=Math.ceil(de/Q),xe=(K-1)*Q,pe=xe+Q,oe=F.useMemo(()=>ae.slice(xe,pe),[ae,xe,pe]);F.useEffect(()=>{if(X!=="text"||oe.length===0){f([]);return}(async()=>{j(!0),E(null);try{const T=(await be.getLinesByNumbers(oe,"text")).sort((V,G)=>V.lineNumber-G.lineNumber);f(T)}catch(z){const T=z instanceof Error?z.message:"Failed to load lines";E(T),f([])}finally{j(!1)}})()},[X,oe]);const U=F.useCallback(async()=>{try{const T=(await be.getLinesByNumbers(ae,"text")).sort((V,G)=>V.lineNumber-G.lineNumber).map(V=>V.content).join(`
`);await navigator.clipboard.writeText(T),B(!0),setTimeout(()=>B(!1),2e3)}catch(ce){console.error("Failed to copy results:",ce)}},[ae]),te=F.useCallback(ce=>ce,[]);F.useCallback(ce=>{W(ce)},[]),F.useCallback(()=>{W(null)},[]);const ge=F.useCallback(ce=>{q!==ce&&W(ce)},[q]),ke=F.useCallback(ce=>{ce.stopPropagation()},[]),Pe=F.useCallback(ce=>{q&&W(null)},[q]);return X!=="text"?null:de===0?a.jsx("div",{className:`${w}`,children:a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx("svg",{className:"w-12 h-12 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),a.jsx("p",{children:"No results found"}),a.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Try adjusting your filters"})]})}):a.jsx("div",{className:`${w}`,children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h3",{className:"text-sm font-medium text-gray-900",children:["Results (",de.toLocaleString()," lines)"]}),a.jsx("div",{className:"flex items-center space-x-2",children:a.jsx("button",{type:"button",onClick:U,"data-copy-results":!0,className:`
                px-3 py-1 bg-gray-600 text-white text-xs font-medium rounded
                hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500
              `,children:R?"Copied!":"Copy All"})})]}),d&&a.jsx("div",{className:"text-center py-4",children:a.jsxs("div",{className:"inline-flex items-center space-x-2 text-sm text-gray-600",children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600"}),a.jsx("span",{children:"Loading results..."})]})}),S&&a.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:a.jsx("p",{className:"text-sm text-red-700",children:S})}),!d&&!S&&l.length>0&&a.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[a.jsx("div",{className:"bg-gray-50 px-4 py-2 border-b border-gray-200",children:a.jsxs("p",{className:"text-xs text-gray-600",children:["Showing ",xe+1,"-",Math.min(pe,de)," of ",de.toLocaleString()," results"]})}),a.jsx("div",{className:"max-h-[32rem] overflow-y-auto",onClick:Pe,children:l.map(ce=>a.jsxs("div",{className:`flex border-b border-gray-100 ${q===ce.id?"bg-blue-50":"hover:bg-gray-50"}`,onClick:()=>ge(ce.id),children:[a.jsx("div",{className:"flex-shrink-0 w-16 px-3 py-2 bg-gray-50 border-r border-gray-200 text-xs text-gray-500 text-right font-mono",children:ce.lineNumber}),a.jsx("div",{className:"flex-1 px-3 py-2 text-sm font-mono",children:q===ce.id?a.jsx("textarea",{value:ce.content,readOnly:!0,onClick:ke,className:"w-full h-24 p-2 text-sm font-mono border border-blue-300 rounded resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 bg-blue-50"}):a.jsx("pre",{className:"whitespace-pre-wrap break-words max-h-20 overflow-hidden cursor-pointer hover:bg-gray-50 rounded p-1 -m-1",children:te(ce.content)})})]},ce.id))})]}),ye>1&&a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("p",{className:"text-sm text-gray-700",children:["Page ",K," of ",ye]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx("button",{type:"button",onClick:()=>je.setPage(K-1),disabled:K<=1,className:`
                  px-3 py-1 border border-gray-300 text-sm rounded
                  hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500
                  disabled:opacity-50 disabled:cursor-not-allowed
                `,children:"Previous"}),a.jsx("button",{type:"button",onClick:()=>je.setPage(K+1),disabled:K>=ye,className:`
                  px-3 py-1 border border-gray-300 text-sm rounded
                  hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500
                  disabled:opacity-50 disabled:cursor-not-allowed
                `,children:"Next"})]})]})]})})},fi=({className:w=""})=>{const[l,f]=F.useState([]),[d,j]=F.useState(!1),[S,E]=F.useState(null),[R,B]=F.useState(!1),[q,W]=F.useState(null),Z=se(Ue),X=se(Be),K=se(Qe),Q=se(rt),ie=se(wn),he=se(We),ae=se(Ce),de=F.useMemo(()=>{if(!(Object.keys(ae).length>0))return Array.from({length:he},(G,we)=>we+1);const T=Object.values(ae).filter(G=>G.isActive).map(G=>Z[G.id]).filter(G=>G!==void 0);if(T.length===0)return[];let V=new Set(T[0].matchedLines);for(let G=1;G<T.length;G++){const we=new Set(T[G].matchedLines);V=new Set([...V].filter(Ke=>we.has(Ke)))}return Array.from(V).sort((G,we)=>G-we)},[Z,ae,he]),ye=de.length,xe=Math.ceil(ye/ie),pe=(Q-1)*ie,oe=pe+ie,U=F.useMemo(()=>de.slice(pe,oe),[de,pe,oe]);F.useEffect(()=>{if(X!=="csv"||U.length===0){f([]);return}(async()=>{j(!0),E(null);try{const V=(await be.getLinesByNumbers(U,"csv")).sort((G,we)=>G.lineNumber-we.lineNumber);f(V)}catch(T){const V=T instanceof Error?T.message:"Failed to load lines";E(V),f([])}finally{j(!1)}})()},[X,U]);const te=F.useCallback(async()=>{try{const T=(await be.getLinesByNumbers(de,"csv")).sort((G,we)=>G.lineNumber-we.lineNumber);let V="";K.length>0&&(V+=K.join(",")+`
`),V+=T.map(G=>G.originalContent).join(`
`),await navigator.clipboard.writeText(V),B(!0),setTimeout(()=>B(!1),2e3)}catch(z){console.error("Failed to copy results:",z)}},[de,K]),ge=K;F.useCallback(z=>{W(z)},[]),F.useCallback(()=>{W(null)},[]);const ke=F.useCallback((z,T)=>{T.stopPropagation(),q!==z&&W(z)},[q]),Pe=F.useCallback(z=>{z.stopPropagation()},[]),ce=F.useCallback(()=>{q&&W(null)},[q]);return X!=="csv"?null:ye===0?a.jsx("div",{className:`${w}`,children:a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx("svg",{className:"w-12 h-12 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),a.jsx("p",{children:"No results found"}),a.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Try adjusting your filters"})]})}):a.jsx("div",{className:`${w}`,children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h3",{className:"text-sm font-medium text-gray-900",children:["CSV Results (",ye.toLocaleString()," rows)"]}),a.jsx("div",{className:"flex items-center space-x-2",children:a.jsx("button",{type:"button",onClick:te,"data-copy-results":!0,className:`
                px-3 py-1 bg-gray-600 text-white text-xs font-medium rounded
                hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500
              `,children:R?"Copied!":"Copy CSV"})})]}),d&&a.jsx("div",{className:"text-center py-4",children:a.jsxs("div",{className:"inline-flex items-center space-x-2 text-sm text-gray-600",children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600"}),a.jsx("span",{children:"Loading results..."})]})}),S&&a.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:a.jsx("p",{className:"text-sm text-red-700",children:S})}),!d&&!S&&l.length>0&&a.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[a.jsx("div",{className:"bg-gray-50 px-4 py-2 border-b border-gray-200",children:a.jsxs("p",{className:"text-xs text-gray-600",children:["Showing ",pe+1,"-",Math.min(oe,ye)," of ",ye.toLocaleString()," results",K.length>1&&` (${K.length} columns)`]})}),a.jsx("div",{className:"overflow-x-auto max-h-[32rem] overflow-y-auto",onClick:ce,children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50 sticky top-0",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200",children:"Line"}),ge.map((z,T)=>a.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200 last:border-r-0",children:a.jsx("div",{className:"truncate max-w-32",title:z||`Column ${T+1}`,children:z||`Column ${T+1}`})},T))]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map(z=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-xs text-gray-500 font-mono border-r border-gray-200",children:z.lineNumber}),ge.map((T,V)=>{const G=z.data[V]||"",we=`${z.id}-${V}`,Ke=q===we;return a.jsx("td",{className:`px-3 py-2 text-sm text-gray-900 border-r border-gray-200 last:border-r-0 ${Ke?"bg-blue-50":""}`,onClick:st=>ke(we,st),children:Ke?a.jsx("textarea",{value:G,readOnly:!0,onClick:Pe,className:"w-full h-16 p-2 text-xs font-mono border border-blue-300 rounded resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 bg-blue-50"}):a.jsx("div",{className:"max-w-32 truncate cursor-pointer hover:bg-gray-50 rounded p-1 -m-1",title:G,children:G})},V)})]},z.id))})]})})]}),xe>1&&a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("p",{className:"text-sm text-gray-700",children:["Page ",Q," of ",xe]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx("button",{type:"button",onClick:()=>je.setPage(Q-1),disabled:Q<=1,className:`
                  px-3 py-1 border border-gray-300 text-sm rounded
                  hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500
                  disabled:opacity-50 disabled:cursor-not-allowed
                `,children:"Previous"}),a.jsx("button",{type:"button",onClick:()=>je.setPage(Q+1),disabled:Q>=xe,className:`
                  px-3 py-1 border border-gray-300 text-sm rounded
                  hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500
                  disabled:opacity-50 disabled:cursor-not-allowed
                `,children:"Next"})]})]})]})})},hi=({className:w=""})=>{const l=se(Te),f=se(Ee),d=se(Me),j=se(_t),S=l!=="idle"&&l!=="complete"&&l!=="error",E=S||j;if(!E&&!d)return null;const R=()=>{if(j)return"Filtering data...";switch(l){case"uploading":return"Uploading file...";case"parsing":return"Processing file...";case"complete":return"Complete";case"error":return"Error occurred";default:return"Processing..."}},B=()=>d?"bg-red-500":l==="complete"?"bg-green-500":"bg-blue-500";return a.jsxs("div",{className:`${w}`,children:[E&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:R()}),a.jsxs("span",{className:"text-sm text-gray-500",children:[Math.round(f),"%"]})]}),a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:a.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${B()}`,style:{width:`${f}%`},children:S&&a.jsx("div",{className:"h-full bg-white bg-opacity-30 animate-pulse"})})}),(S||j)&&f===0&&a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:a.jsx("div",{className:"h-2 bg-blue-500 rounded-full animate-pulse"})})]}),d&&a.jsx("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded-md",children:a.jsxs("div",{className:"flex items-start",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("svg",{className:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.96-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),a.jsxs("div",{className:"ml-3",children:[a.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Processing Error"}),a.jsx("p",{className:"mt-1 text-sm text-red-700",children:d})]})]})})]})},pi=({isOpen:w,onClose:l})=>{if(!w)return null;const f=It.getShortcuts().filter(d=>d.description.toLowerCase().includes("filter")||d.description.toLowerCase().includes("copy")||d.description.toLowerCase().includes("clear"));return a.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:a.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[a.jsx("div",{className:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75",onClick:l}),a.jsxs("div",{className:"inline-block w-full max-w-2xl p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-lg",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Line Filter Tool - Help"}),a.jsx("button",{type:"button",onClick:l,className:"text-gray-400 hover:text-gray-600 focus:outline-none",children:a.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Overview"}),a.jsx("p",{className:"text-sm text-gray-600",children:"The Line Filter Tool helps you efficiently filter and search through large text files and CSV data. Upload files or paste text, then use include/exclude filters to find exactly what you need."})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Features"}),a.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[a.jsxs("li",{children:["â¢ ",a.jsx("strong",{children:"File Support:"})," .txt, .csv, .tsv, .log files up to 5MB and 10,000 lines"]}),a.jsxs("li",{children:["â¢ ",a.jsx("strong",{children:"Text Paste:"})," Paste content directly from clipboard"]}),a.jsxs("li",{children:["â¢ ",a.jsx("strong",{children:"Auto-Detection:"})," Automatically detects CSV format and headers"]}),a.jsxs("li",{children:["â¢ ",a.jsx("strong",{children:"Pattern Matching:"})," Include or exclude lines based on patterns"]}),a.jsxs("li",{children:["â¢ ",a.jsx("strong",{children:"Regex Support:"})," Use regular expressions for complex patterns"]}),a.jsxs("li",{children:["â¢ ",a.jsx("strong",{children:"CSV Filtering:"})," Filter by specific columns or search all data"]}),a.jsxs("li",{children:["â¢ ",a.jsx("strong",{children:"Export Results:"})," Copy filtered results to clipboard"]})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Filter Types"}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-gray-900",children:"Include Filters:"}),a.jsx("span",{className:"text-gray-600 ml-1",children:"Show only lines that match the pattern"})]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-gray-900",children:"Exclude Filters:"}),a.jsx("span",{className:"text-gray-600 ml-1",children:"Hide lines that match the pattern"})]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-gray-900",children:"Column Filters (CSV):"}),a.jsx("span",{className:"text-gray-600 ml-1",children:"Filter specific columns in CSV data"})]})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Regex Examples"}),a.jsxs("div",{className:"bg-gray-50 rounded p-3 text-sm space-y-1",children:[a.jsxs("div",{children:[a.jsx("code",{className:"bg-white px-1 rounded",children:"^ERROR"}),' - Lines starting with "ERROR"']}),a.jsxs("div",{children:[a.jsxs("code",{className:"bg-white px-1 rounded",children:["\\d",4,"-\\d",2,"-\\d",2]})," - Date patterns (YYYY-MM-DD)"]}),a.jsxs("div",{children:[a.jsx("code",{className:"bg-white px-1 rounded",children:"\\b\\w+@\\w+\\.\\w+\\b"})," - Email addresses"]}),a.jsxs("div",{children:[a.jsx("code",{className:"bg-white px-1 rounded",children:"failed|error|exception"})," - Multiple keywords"]}),a.jsxs("div",{children:[a.jsx("code",{className:"bg-white px-1 rounded",children:"^\\s*$"})," - Empty lines"]})]})]}),f.length>0&&a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Keyboard Shortcuts"}),a.jsxs("div",{className:"space-y-1",children:[f.map(d=>a.jsxs("div",{className:"flex justify-between items-center text-sm",children:[a.jsx("span",{className:"text-gray-600",children:d.description}),a.jsx("kbd",{className:"bg-gray-100 px-2 py-1 rounded text-xs font-mono",children:It.formatShortcut(d.id)})]},d.id)),a.jsxs("div",{className:"flex justify-between items-center text-sm",children:[a.jsx("span",{className:"text-gray-600",children:"Add filter quickly"}),a.jsx("kbd",{className:"bg-gray-100 px-2 py-1 rounded text-xs font-mono",children:"â+Enter"})]})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Tips"}),a.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[a.jsx("li",{children:"â¢ Use multiple filters to narrow down results progressively"}),a.jsx("li",{children:"â¢ CSV headers are auto-detected, but you can toggle header detection"}),a.jsx("li",{children:"â¢ Case-sensitive matching is available for precise filtering"}),a.jsx("li",{children:"â¢ Large files are processed in chunks to keep the UI responsive"}),a.jsx("li",{children:"â¢ All processing happens locally in your browser for privacy"})]})]})]}),a.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:a.jsx("button",{type:"button",onClick:l,className:`
                w-full px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md
                hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500
              `,children:"Got it"})})]})]})})},Fi=({className:w=""})=>{const l=se(Be),f=se(Fr),[d,j]=ns.useState(!1),[S,E]=ns.useState(null),R=F.useCallback(async()=>{try{await je.clearAllData()}catch(W){console.error("Failed to clear data:",W)}},[]);F.useEffect(()=>{ni().catch(console.error);const W=[It.register({key:"Escape",description:"Clear all data and filters",handler:Z=>{Z.preventDefault(),Fr.get()&&R()}}),It.register({key:"c",metaKey:!0,shiftKey:!0,description:"Copy filtered results to clipboard",handler:Z=>{Z.preventDefault();const X=document.querySelector("[data-copy-results]");X&&X.click()}}),It.register({key:"Enter",metaKey:!0,shiftKey:!0,description:"Apply all active filters",handler:Z=>{Z.preventDefault(),Fr.get()&&je.applyAllActiveFilters().catch(console.error)}})];return()=>{W.forEach(Z=>It.unregister(Z))}},[]);const B=F.useCallback(W=>{E(W)},[]),q=F.useCallback(()=>{E(null)},[]);return a.jsx("div",{className:`${w}`,children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Line Filter Tool"}),a.jsx("button",{type:"button",onClick:()=>j(!0),className:`
                p-2 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded
              `,title:"Help",children:a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),a.jsx("p",{className:"text-gray-600",children:"Filter and search through large text files and CSV data efficiently"})]}),a.jsx("div",{className:"mb-6",children:a.jsx(hi,{})}),f?a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Filters"}),a.jsx(oi,{})]}),a.jsx("button",{type:"button",onClick:R,className:"px-3 py-1.5 bg-red-600 text-white text-sm font-medium rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 flex-shrink-0",children:"Clear Data"})]}),a.jsx("div",{className:"px-4 py-3 border-b border-gray-100",children:a.jsx("div",{className:"flex items-center space-x-4",children:a.jsx("div",{className:"flex-1 min-w-0",children:l==="csv"?a.jsx(ci,{editingFilterId:S,onEditComplete:q}):a.jsx(li,{editingFilterId:S,onEditComplete:q})})})}),a.jsx("div",{className:"px-4 py-2",children:a.jsx(ui,{onFilterEdit:B})})]}),a.jsx("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm",children:a.jsx("div",{className:"p-6",children:l==="csv"?a.jsx(fi,{}):a.jsx(di,{})})})]}):a.jsx(ai,{}),a.jsx("div",{className:"mt-12 pt-6 border-t border-gray-200",children:a.jsx("div",{className:"text-center text-sm text-gray-500",children:a.jsxs("p",{children:["Part of"," ",a.jsx("a",{href:"/",className:"text-blue-600 hover:text-blue-700 font-medium",children:"Devsgen"})," ","developer utilities"]})})}),a.jsx(pi,{isOpen:d,onClose:()=>j(!1)})]})})};export{Fi as default};
