import{P as K,a as g}from"./AnalyticsService.CwF1QyvA.js";let i=[],p=(a,e)=>{let t=[],r={get(){return r.lc||r.listen(()=>{})(),r.value},l:0,lc:0,listen(n,s){return r.lc=t.push(n,s||r.l)/2,()=>{let l=t.indexOf(n);~l&&(t.splice(l,2),--r.lc||r.off())}},notify(n,s){let l=!i.length;for(let o=0;o<t.length;o+=2)i.push(t[o],t[o+1],r.value,n,s);if(l){for(let o=0;o<i.length;o+=5){let y;for(let R=o+1;!y&&(R+=5)<i.length;)i[R]<i[o+1]&&(y=i.push(i[o],i[o+1],i[o+2],i[o+3],i[o+4]));y||i[o](i[o+2],i[o+3],i[o+4])}i.length=0}},off(){},set(n){let s=r.value;s!==n&&(r.value=n,r.notify(s))},subscribe(n,s){let l=r.listen(n,s);return n(r.value),l},value:a};return r},P=(a={})=>{let e=p(a);return e.setKey=function(t,r){let n=e.value;typeof r>"u"&&t in e.value?(e.value={...e.value},delete e.value[t],e.notify(n,t)):e.value[t]!==r&&(e.value={...e.value,[t]:r},e.notify(n,t))},e};class E{patterns=new Map;registerPattern(e,t,r,n){const s=this.validateRegex(t);if(!s.isValid)throw new Error(`Invalid search regex: ${s.error}`);this.patterns.set(e,{searchRegex:t,replaceRegex:r,flags:n})}registerPatterns(e){for(const t of e)this.registerPattern(t.id,t.searchRegex,t.replaceRegex,t.flags)}transform(e,t){const r=this.patterns.get(e);if(!r)throw new Error(`Pattern not found: ${e}`);return e==="extract-urls"||e==="extract-emails"?this.extractMatches(t,r.searchRegex,r.flags):e==="kebab-to-camel"?this.transformKebabToCamel(t):e==="camel-to-kebab"?this.transformCamelToKebab(t):e==="path-slash-to-dot"?this.transformSlashToDot(t):this.transformWithRegex(t,r.searchRegex,r.replaceRegex,r.flags)}transformKebabToCamel(e){return e.replace(/-([a-z])/g,(t,r)=>r.toUpperCase())}transformCamelToKebab(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}transformSlashToDot(e){return e.replace(/\//g,".")}transformWithRegex(e,t,r,n){try{const s=this.validateRegex(t);if(!s.isValid)throw new Error(`Invalid regex: ${s.error}`);const l=new RegExp(t,n||"g");return e.replace(l,r)}catch(s){throw s instanceof Error?new Error(`Transformation error: ${s.message}`):new Error("Unknown transformation error")}}extractMatches(e,t,r){try{const n=this.validateRegex(t);if(!n.isValid)throw new Error(`Invalid regex: ${n.error}`);const s=new RegExp(t,r||"g"),l=e.match(s);return!l||l.length===0?"":l.join(`
`)+`
`}catch(n){throw n instanceof Error?new Error(`Extraction error: ${n.message}`):new Error("Unknown extraction error")}}validateRegex(e){try{return new RegExp(e),{isValid:!0}}catch(t){return t instanceof Error?{isValid:!1,error:t.message}:{isValid:!1,error:"Invalid regular expression"}}}getPattern(e){return this.patterns.get(e)}hasPattern(e){return this.patterns.has(e)}clearPatterns(){this.patterns.clear()}}const u=new K,x=new E,m=p([]),c=p(null),d=p(!1),f=P({input:"",result:null,isProcessing:!1,error:null}),w=P({isCommandPaletteOpen:!1,isMobileMenuOpen:!1,layout:"horizontal"}),h=P({searchRegex:"",replaceRegex:"",flags:void 0}),v=p(!1),S=p(!1);typeof window<"u"&&w.setKey("layout",window.innerWidth>768?"horizontal":"vertical");async function $(){d.set(!0);try{await u.initialize();const a=await u.getAllPatterns();if(m.set(a),x.registerPatterns(a),typeof window<"u"&&a.length>0){const e=localStorage.getItem("regex_selected_pattern");e&&a.some(t=>t.id===e)?c.set(e):c.set(a[0].id)}}catch(a){console.error("Error initializing pattern store:",a)}finally{d.set(!1)}}function z(a,e="command_palette"){c.set(a),M(),C();const r=m.get().find(n=>n.id===a);r&&g.patternSelected(a,r.name,e),typeof window<"u"&&localStorage.setItem("regex_selected_pattern",a)}function b(){const a=m.get(),e=c.get();if(e)return a.find(t=>t.id===e)}async function O(a){const e=c.get(),t=v.get(),r=h.get();if(!e){f.setKey("error","No pattern selected");return}f.setKey("isProcessing",!0),f.setKey("input",a),f.setKey("error",null);try{const n=performance.now();let s;t&&r.searchRegex?s=x.transformWithRegex(a,r.searchRegex,r.replaceRegex,r.flags):s=x.transform(e,a);const l=performance.now();f.setKey("result",{output:s,executionTime:l-n}),g.textTransformed(e,a.length,s.length,l-n)}catch(n){const s=n instanceof Error?n.message:"Unknown error";f.setKey("error",s),f.setKey("result",null),g.transformError(e,s)}finally{f.setKey("isProcessing",!1)}}function V(a,e,t){const r=c.get(),n=b();h.setKey("searchRegex",a),h.setKey("replaceRegex",e),h.setKey("flags",t),v.set(!0),r&&n&&(a!==n.searchRegex&&g.patternModified(r,"search"),e!==n.replaceRegex&&g.patternModified(r,"replace"),t!==n.flags&&g.patternModified(r,"flags"))}function M(){const a=c.get();h.setKey("searchRegex",""),h.setKey("replaceRegex",""),h.setKey("flags",void 0),v.set(!1),a&&g.patternReset(a)}function C(){S.set(!1)}async function _(a){d.set(!0);try{const e=await u.createPattern(a),t=await u.getAllPatterns();return m.set(t),x.registerPattern(e.id,e.searchRegex,e.replaceRegex),e}catch(e){throw console.error("Error creating pattern:",e),e}finally{d.set(!1)}}async function A(a,e){d.set(!0);try{const t=await u.updatePattern(a,e),r=await u.getAllPatterns();return m.set(r),x.registerPattern(t.id,t.searchRegex,t.replaceRegex),t}catch(t){throw console.error("Error updating pattern:",t),t}finally{d.set(!1)}}async function L(a){d.set(!0);try{const e=await u.deletePattern(a);if(e){const t=await u.getAllPatterns();m.set(t),c.get()===a&&c.set(t.length>0?t[0].id:null)}return e}catch(e){throw console.error("Error deleting pattern:",e),e}finally{d.set(!1)}}function D(a="button"){const e=w.get().isCommandPaletteOpen;w.setKey("isCommandPaletteOpen",!e),e||g.commandPaletteOpened(a)}function U(){if(typeof window<"u"){const a=localStorage.getItem("regex-layout");a&&w.setKey("layout",a)}}export{v as a,V as b,h as c,L as d,U as e,f,c as g,O as h,$ as i,A as j,_ as k,m as p,M as r,z as s,D as t,w as u};
