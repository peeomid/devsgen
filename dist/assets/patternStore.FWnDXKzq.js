import{P as y,a as c}from"./AnalyticsService.CwF1QyvA.js";import{m as w,a as m}from"./index.Bda8kKQR.js";class P{patterns=new Map;registerPattern(e,t,a,s){const n=this.validateRegex(t);if(!n.isValid)throw new Error(`Invalid search regex: ${n.error}`);this.patterns.set(e,{searchRegex:t,replaceRegex:a,flags:s})}registerPatterns(e){for(const t of e)this.registerPattern(t.id,t.searchRegex,t.replaceRegex,t.flags)}transform(e,t){const a=this.patterns.get(e);if(!a)throw new Error(`Pattern not found: ${e}`);return e==="extract-urls"||e==="extract-emails"?this.extractMatches(t,a.searchRegex,a.flags):e==="kebab-to-camel"?this.transformKebabToCamel(t):e==="camel-to-kebab"?this.transformCamelToKebab(t):e==="path-slash-to-dot"?this.transformSlashToDot(t):this.transformWithRegex(t,a.searchRegex,a.replaceRegex,a.flags)}transformKebabToCamel(e){return e.replace(/-([a-z])/g,(t,a)=>a.toUpperCase())}transformCamelToKebab(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}transformSlashToDot(e){return e.replace(/\//g,".")}transformWithRegex(e,t,a,s){try{const n=this.validateRegex(t);if(!n.isValid)throw new Error(`Invalid regex: ${n.error}`);const i=new RegExp(t,s||"g");return e.replace(i,a)}catch(n){throw n instanceof Error?new Error(`Transformation error: ${n.message}`):new Error("Unknown transformation error")}}extractMatches(e,t,a){try{const s=this.validateRegex(t);if(!s.isValid)throw new Error(`Invalid regex: ${s.error}`);const n=new RegExp(t,a||"g"),i=e.match(n);return!i||i.length===0?"":i.join(`
`)+`
`}catch(s){throw s instanceof Error?new Error(`Extraction error: ${s.message}`):new Error("Unknown extraction error")}}validateRegex(e){try{return new RegExp(e),{isValid:!0}}catch(t){return t instanceof Error?{isValid:!1,error:t.message}:{isValid:!1,error:"Invalid regular expression"}}}getPattern(e){return this.patterns.get(e)}hasPattern(e){return this.patterns.has(e)}clearPatterns(){this.patterns.clear()}}const f=new y,h=new P,u=m([]),o=m(null),g=m(!1),l=w({input:"",result:null,isProcessing:!1,error:null}),p=w({isCommandPaletteOpen:!1,isMobileMenuOpen:!1,layout:"horizontal"}),d=w({searchRegex:"",replaceRegex:"",flags:void 0}),x=m(!1),R=m(!1);typeof window<"u"&&p.setKey("layout",window.innerWidth>768?"horizontal":"vertical");async function C(){g.set(!0);try{await f.initialize();const r=await f.getAllPatterns();if(u.set(r),h.registerPatterns(r),typeof window<"u"&&r.length>0){const e=localStorage.getItem("regex_selected_pattern");e&&r.some(t=>t.id===e)?o.set(e):o.set(r[0].id)}}catch(r){console.error("Error initializing pattern store:",r)}finally{g.set(!1)}}function M(r,e="command_palette"){o.set(r),E(),K();const a=u.get().find(s=>s.id===r);a&&c.patternSelected(r,a.name,e),typeof window<"u"&&localStorage.setItem("regex_selected_pattern",r)}function v(){const r=u.get(),e=o.get();if(e)return r.find(t=>t.id===e)}async function T(r){const e=o.get(),t=x.get(),a=d.get();if(!e){l.setKey("error","No pattern selected");return}l.setKey("isProcessing",!0),l.setKey("input",r),l.setKey("error",null);try{const s=performance.now();let n;t&&a.searchRegex?n=h.transformWithRegex(r,a.searchRegex,a.replaceRegex,a.flags):n=h.transform(e,r);const i=performance.now();l.setKey("result",{output:n,executionTime:i-s}),c.textTransformed(e,r.length,n.length,i-s)}catch(s){const n=s instanceof Error?s.message:"Unknown error";l.setKey("error",n),l.setKey("result",null),c.transformError(e,n)}finally{l.setKey("isProcessing",!1)}}function z(r,e,t){const a=o.get(),s=v();d.setKey("searchRegex",r),d.setKey("replaceRegex",e),d.setKey("flags",t),x.set(!0),a&&s&&(r!==s.searchRegex&&c.patternModified(a,"search"),e!==s.replaceRegex&&c.patternModified(a,"replace"),t!==s.flags&&c.patternModified(a,"flags"))}function E(){const r=o.get();d.setKey("searchRegex",""),d.setKey("replaceRegex",""),d.setKey("flags",void 0),x.set(!1),r&&c.patternReset(r)}function K(){R.set(!1)}async function $(r){g.set(!0);try{const e=await f.createPattern(r),t=await f.getAllPatterns();return u.set(t),h.registerPattern(e.id,e.searchRegex,e.replaceRegex),e}catch(e){throw console.error("Error creating pattern:",e),e}finally{g.set(!1)}}async function O(r,e){g.set(!0);try{const t=await f.updatePattern(r,e),a=await f.getAllPatterns();return u.set(a),h.registerPattern(t.id,t.searchRegex,t.replaceRegex),t}catch(t){throw console.error("Error updating pattern:",t),t}finally{g.set(!1)}}async function k(r){g.set(!0);try{const e=await f.deletePattern(r);if(e){const t=await f.getAllPatterns();u.set(t),o.get()===r&&o.set(t.length>0?t[0].id:null)}return e}catch(e){throw console.error("Error deleting pattern:",e),e}finally{g.set(!1)}}function V(r="button"){const e=p.get().isCommandPaletteOpen;p.setKey("isCommandPaletteOpen",!e),e||c.commandPaletteOpened(r)}function _(){if(typeof window<"u"){const r=localStorage.getItem("regex-layout");r&&p.setKey("layout",r)}}export{x as a,z as b,d as c,k as d,_ as e,l as f,o as g,T as h,C as i,O as j,$ as k,u as p,E as r,M as s,V as t,p as u};
