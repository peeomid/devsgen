import{j as a}from"./jsx-runtime.9DypCmAh.js";import{c as $s,g as zs,r as F,R as ss}from"./index.eCxJ45ll.js";import{u as se}from"./index.et05KHOM.js";import{a as De,m as ls}from"./index.Bda8kKQR.js";const Us=5,Cr=6,Sr=10;let Hs=(w,l,f,d)=>(w.events=w.events||{},w.events[f+Sr]||(w.events[f+Sr]=d(j=>{w.events[f].reduceRight((E,C)=>(C(E),E),{shared:{},...j})})),w.events[f]=w.events[f]||[],w.events[f].push(l),()=>{let j=w.events[f],E=j.indexOf(l);j.splice(E,1),j.length||(delete w.events[f],w.events[f+Sr](),delete w.events[f+Sr])}),Ws=1e3,Ys=(w,l)=>Hs(w,d=>{let j=l(d);j&&w.events[Cr].push(j)},Us,d=>{let j=w.listen;w.listen=(...C)=>(!w.lc&&!w.active&&(w.active=!0,d()),j(...C));let E=w.off;return w.events[Cr]=[],w.off=()=>{E(),setTimeout(()=>{if(w.active&&!w.lc){w.active=!1;for(let C of w.events[Cr])C();w.events[Cr]=[]}},Ws)},()=>{w.listen=j,w.off=E}}),Xs=(w,l,f)=>{Array.isArray(w)||(w=[w]);let d,j=0,E=()=>{let M=w.map(z=>z.get());if(d===void 0||M.some((z,H)=>z!==d[H])){let z=++j;d=M;let H=l(...M);H&&H.then&&H.t?H.then(X=>{z===j&&C.set(X)}):C.set(H)}},C=De(void 0,Math.max(...w.map(M=>M.l))+1),L=E;return Ys(C,()=>{let M=w.map(z=>z.listen(L,-1/C.l));return E(),()=>{for(let z of M)z()}}),C},Gt=(w,l)=>Xs(w,l);var Fr={exports:{}},Qs=Fr.exports,is;function Gs(){return is||(is=1,function(w,l){(function(f,d){w.exports=d()})(Qs,function(){var f=function(e,t){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=n[s])})(e,t)},d=function(){return(d=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};function j(e,t,r){for(var n,s=0,i=t.length;s<i;s++)!n&&s in t||((n=n||Array.prototype.slice.call(t,0,s))[s]=t[s]);return e.concat(n||Array.prototype.slice.call(t))}var E=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:$s,C=Object.keys,L=Array.isArray;function M(e,t){return typeof t!="object"||C(t).forEach(function(r){e[r]=t[r]}),e}typeof Promise>"u"||E.Promise||(E.Promise=Promise);var z=Object.getPrototypeOf,H={}.hasOwnProperty;function X(e,t){return H.call(e,t)}function Q(e,t){typeof t=="function"&&(t=t(z(e))),(typeof Reflect>"u"?C:Reflect.ownKeys)(t).forEach(function(r){Z(e,r,t[r])})}var R=Object.defineProperty;function Z(e,t,r,n){R(e,t,M(r&&X(r,"get")&&typeof r.get=="function"?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},n))}function ie(e){return{from:function(t){return e.prototype=Object.create(t.prototype),Z(e.prototype,"constructor",e),{extend:Q.bind(null,e.prototype)}}}}var he=Object.getOwnPropertyDescriptor,ae=[].slice;function de(e,t,r){return ae.call(e,t,r)}function ye(e,t){return t(e)}function xe(e){if(!e)throw new Error("Assertion Failed")}function pe(e){E.setImmediate?setImmediate(e):setTimeout(e,0)}function oe(e,t){if(typeof t=="string"&&X(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var r=[],n=0,s=t.length;n<s;++n){var i=oe(e,t[n]);r.push(i)}return r}var o=t.indexOf(".");if(o!==-1){var c=e[t.substr(0,o)];return c==null?void 0:oe(c,t.substr(o+1))}}function U(e,t,r){if(e&&t!==void 0&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){xe(typeof r!="string"&&"length"in r);for(var n=0,s=t.length;n<s;++n)U(e,t[n],r[n])}else{var i,o,c=t.indexOf(".");c!==-1?(i=t.substr(0,c),(o=t.substr(c+1))===""?r===void 0?L(e)&&!isNaN(parseInt(i))?e.splice(i,1):delete e[i]:e[i]=r:U(c=!(c=e[i])||!X(e,i)?e[i]={}:c,o,r)):r===void 0?L(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=r}}function te(e){var t,r={};for(t in e)X(e,t)&&(r[t]=e[t]);return r}var ge=[].concat;function ke(e){return ge.apply([],e)}var pt="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ke([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return E[e]}),Oe=new Set(pt.map(function(e){return E[e]})),ce=null;function $(e){return ce=new WeakMap,e=function t(r){if(!r||typeof r!="object")return r;var n=ce.get(r);if(n)return n;if(L(r)){n=[],ce.set(r,n);for(var s=0,i=r.length;s<i;++s)n.push(t(r[s]))}else if(Oe.has(r.constructor))n=r;else{var o,c=z(r);for(o in n=c===Object.prototype?{}:Object.create(c),ce.set(r,n),r)X(r,o)&&(n[o]=t(r[o]))}return n}(e),ce=null,e}var I={}.toString;function V(e){return I.call(e).slice(8,-1)}var G=typeof Symbol<"u"?Symbol.iterator:"@@iterator",we=typeof G=="symbol"?function(e){var t;return e!=null&&(t=e[G])&&t.apply(e)}:function(){return null};function Ke(e,t){return t=e.indexOf(t),0<=t&&e.splice(t,1),0<=t}var st={};function Ze(e){var t,r,n,s;if(arguments.length===1){if(L(e))return e.slice();if(this===st&&typeof e=="string")return[e];if(s=we(e)){for(r=[];!(n=s.next()).done;)r.push(n.value);return r}if(e==null)return[e];if(typeof(t=e.length)!="number")return[e];for(r=new Array(t);t--;)r[t]=e[t];return r}for(t=arguments.length,r=new Array(t);t--;)r[t]=arguments[t];return r}var Pr=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Rt=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],ze=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Rt),ds={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Nt(e,t){this.name=e,this.message=t}function jn(e,t){return e+". Errors: "+Object.keys(t).map(function(r){return t[r].toString()}).filter(function(r,n,s){return s.indexOf(r)===n}).join(`
`)}function Zt(e,t,r,n){this.failures=t,this.failedKeys=n,this.successCount=r,this.message=jn(e,t)}function Ct(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(r){return t[r]}),this.failuresByPos=t,this.message=jn(e,this.failures)}ie(Nt).from(Error).extend({toString:function(){return this.name+": "+this.message}}),ie(Zt).from(Nt),ie(Ct).from(Nt);var Ar=ze.reduce(function(e,t){return e[t]=t+"Error",e},{}),fs=Nt,Y=ze.reduce(function(e,t){var r=t+"Error";function n(s,i){this.name=r,s?typeof s=="string"?(this.message="".concat(s).concat(i?`
 `+i:""),this.inner=i||null):typeof s=="object"&&(this.message="".concat(s.name," ").concat(s.message),this.inner=s):(this.message=ds[t]||r,this.inner=null)}return ie(n).from(fs),e[t]=n,e},{});Y.Syntax=SyntaxError,Y.Type=TypeError,Y.Range=RangeError;var _n=Rt.reduce(function(e,t){return e[t+"Error"]=Y[t],e},{}),Jt=ze.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=Y[t]),e},{});function fe(){}function Kt(e){return e}function hs(e,t){return e==null||e===Kt?t:function(r){return t(e(r))}}function ht(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function ps(e,t){return e===fe?t:function(){var r=e.apply(this,arguments);r!==void 0&&(arguments[0]=r);var n=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var i=t.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?ht(n,this.onsuccess):n),s&&(this.onerror=this.onerror?ht(s,this.onerror):s),i!==void 0?i:r}}function ms(e,t){return e===fe?t:function(){e.apply(this,arguments);var r=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?ht(r,this.onsuccess):r),n&&(this.onerror=this.onerror?ht(n,this.onerror):n)}}function ys(e,t){return e===fe?t:function(r){var n=e.apply(this,arguments);M(r,n);var s=this.onsuccess,i=this.onerror;return this.onsuccess=null,this.onerror=null,r=t.apply(this,arguments),s&&(this.onsuccess=this.onsuccess?ht(s,this.onsuccess):s),i&&(this.onerror=this.onerror?ht(i,this.onerror):i),n===void 0?r===void 0?void 0:r:M(n,r)}}function gs(e,t){return e===fe?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function Lr(e,t){return e===fe?t:function(){var r=e.apply(this,arguments);if(r&&typeof r.then=="function"){for(var n=this,s=arguments.length,i=new Array(s);s--;)i[s]=arguments[s];return r.then(function(){return t.apply(n,i)})}return t.apply(this,arguments)}}Jt.ModifyError=Zt,Jt.DexieError=Nt,Jt.BulkError=Ct;var Ye=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Nn(e){Ye=e}var Mt={},Cn=100,pt=typeof Promise>"u"?[]:function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,z(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,z(t),e]}(),Rt=pt[0],ze=pt[1],pt=pt[2],ze=ze&&ze.then,mt=Rt&&Rt.constructor,Tr=!!pt,Bt=function(e,t){Vt.push([e,t]),er&&(queueMicrotask(bs),er=!1)},Ir=!0,er=!0,yt=[],tr=[],Kr=Kt,it={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:fe,pgp:!1,env:{},finalize:fe},W=it,Vt=[],gt=0,rr=[];function B(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=W;if(typeof e!="function"){if(e!==Mt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Rr(this,this._value))}this._state=null,this._value=null,++t.ref,function r(n,s){try{s(function(i){if(n._state===null){if(i===n)throw new TypeError("A promise cannot be resolved with itself.");var o=n._lib&&St();i&&typeof i.then=="function"?r(n,function(c,h){i instanceof B?i._then(c,h):i.then(c,h)}):(n._state=!0,n._value=i,En(n)),o&&Et()}},Rr.bind(null,n))}catch(i){Rr(n,i)}}(this,e)}var Mr={get:function(){var e=W,t=ar;function r(n,s){var i=this,o=!e.global&&(e!==W||t!==ar),c=o&&!ot(),h=new B(function(m,v){Br(i,new Sn(Dn(n,e,o,c),Dn(s,e,o,c),m,v,e))});return this._consoleTask&&(h._consoleTask=this._consoleTask),h}return r.prototype=Mt,r},set:function(e){Z(this,"then",e&&e.prototype===Mt?Mr:{get:function(){return e},set:Mr.set})}};function Sn(e,t,r,n,s){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=r,this.reject=n,this.psd=s}function Rr(e,t){var r,n;tr.push(t),e._state===null&&(r=e._lib&&St(),t=Kr(t),e._state=!1,e._value=t,n=e,yt.some(function(s){return s._value===n._value})||yt.push(n),En(e),r&&Et())}function En(e){var t=e._listeners;e._listeners=[];for(var r=0,n=t.length;r<n;++r)Br(e,t[r]);var s=e._PSD;--s.ref||s.finalize(),gt===0&&(++gt,Bt(function(){--gt==0&&Vr()},[]))}function Br(e,t){if(e._state!==null){var r=e._state?t.onFulfilled:t.onRejected;if(r===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++gt,Bt(vs,[r,e,t])}else e._listeners.push(t)}function vs(e,t,r){try{var n,s=t._value;!t._state&&tr.length&&(tr=[]),n=Ye&&t._consoleTask?t._consoleTask.run(function(){return e(s)}):e(s),t._state||tr.indexOf(s)!==-1||function(i){for(var o=yt.length;o;)if(yt[--o]._value===i._value)return yt.splice(o,1)}(t),r.resolve(n)}catch(i){r.reject(i)}finally{--gt==0&&Vr(),--r.psd.ref||r.psd.finalize()}}function bs(){vt(it,function(){St()&&Et()})}function St(){var e=Ir;return er=Ir=!1,e}function Et(){var e,t,r;do for(;0<Vt.length;)for(e=Vt,Vt=[],r=e.length,t=0;t<r;++t){var n=e[t];n[0].apply(null,n[1])}while(0<Vt.length);er=Ir=!0}function Vr(){var e=yt;yt=[],e.forEach(function(n){n._PSD.onunhandled.call(null,n._value,n)});for(var t=rr.slice(0),r=t.length;r;)t[--r]()}function nr(e){return new B(Mt,!1,e)}function ve(e,t){var r=W;return function(){var n=St(),s=W;try{return lt(r,!0),e.apply(this,arguments)}catch(i){t&&t(i)}finally{lt(s,!1),n&&Et()}}}Q(B.prototype,{then:Mr,_then:function(e,t){Br(this,new Sn(null,null,e,t,W))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=e,r=arguments[1];return typeof t=="function"?this.then(null,function(n){return(n instanceof t?r:nr)(n)}):this.then(null,function(n){return(n&&n.name===t?r:nr)(n)})},finally:function(e){return this.then(function(t){return B.resolve(e()).then(function(){return t})},function(t){return B.resolve(e()).then(function(){return nr(t)})})},timeout:function(e,t){var r=this;return e<1/0?new B(function(n,s){var i=setTimeout(function(){return s(new Y.Timeout(t))},e);r.then(n,s).finally(clearTimeout.bind(null,i))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&Z(B.prototype,Symbol.toStringTag,"Dexie.Promise"),it.env=Fn(),Q(B,{all:function(){var e=Ze.apply(null,arguments).map(or);return new B(function(t,r){e.length===0&&t([]);var n=e.length;e.forEach(function(s,i){return B.resolve(s).then(function(o){e[i]=o,--n||t(e)},r)})})},resolve:function(e){return e instanceof B?e:e&&typeof e.then=="function"?new B(function(t,r){e.then(t,r)}):new B(Mt,!0,e)},reject:nr,race:function(){var e=Ze.apply(null,arguments).map(or);return new B(function(t,r){e.map(function(n){return B.resolve(n).then(t,r)})})},PSD:{get:function(){return W},set:function(e){return W=e}},totalEchoes:{get:function(){return ar}},newPSD:at,usePSD:vt,scheduler:{get:function(){return Bt},set:function(e){Bt=e}},rejectionMapper:{get:function(){return Kr},set:function(e){Kr=e}},follow:function(e,t){return new B(function(r,n){return at(function(s,i){var o=W;o.unhandleds=[],o.onunhandled=i,o.finalize=ht(function(){var c,h=this;c=function(){h.unhandleds.length===0?s():i(h.unhandleds[0])},rr.push(function m(){c(),rr.splice(rr.indexOf(m),1)}),++gt,Bt(function(){--gt==0&&Vr()},[])},o.finalize),e()},t,r,n)})}}),mt&&(mt.allSettled&&Z(B,"allSettled",function(){var e=Ze.apply(null,arguments).map(or);return new B(function(t){e.length===0&&t([]);var r=e.length,n=new Array(r);e.forEach(function(s,i){return B.resolve(s).then(function(o){return n[i]={status:"fulfilled",value:o}},function(o){return n[i]={status:"rejected",reason:o}}).then(function(){return--r||t(n)})})})}),mt.any&&typeof AggregateError<"u"&&Z(B,"any",function(){var e=Ze.apply(null,arguments).map(or);return new B(function(t,r){e.length===0&&r(new AggregateError([]));var n=e.length,s=new Array(n);e.forEach(function(i,o){return B.resolve(i).then(function(c){return t(c)},function(c){s[o]=c,--n||r(new AggregateError(s))})})})}),mt.withResolvers&&(B.withResolvers=mt.withResolvers));var Ee={awaits:0,echoes:0,id:0},xs=0,sr=[],ir=0,ar=0,ws=0;function at(e,t,r,n){var s=W,i=Object.create(s);return i.parent=s,i.ref=0,i.global=!1,i.id=++ws,it.env,i.env=Tr?{Promise:B,PromiseProp:{value:B,configurable:!0,writable:!0},all:B.all,race:B.race,allSettled:B.allSettled,any:B.any,resolve:B.resolve,reject:B.reject}:{},t&&M(i,t),++s.ref,i.finalize=function(){--this.parent.ref||this.parent.finalize()},n=vt(i,e,r,n),i.ref===0&&i.finalize(),n}function Ft(){return Ee.id||(Ee.id=++xs),++Ee.awaits,Ee.echoes+=Cn,Ee.id}function ot(){return!!Ee.awaits&&(--Ee.awaits==0&&(Ee.id=0),Ee.echoes=Ee.awaits*Cn,!0)}function or(e){return Ee.echoes&&e&&e.constructor===mt?(Ft(),e.then(function(t){return ot(),t},function(t){return ot(),_e(t)})):e}function ks(){var e=sr[sr.length-1];sr.pop(),lt(e,!1)}function lt(e,t){var r,n=W;(t?!Ee.echoes||ir++&&e===W:!ir||--ir&&e===W)||queueMicrotask(t?function(s){++ar,Ee.echoes&&--Ee.echoes!=0||(Ee.echoes=Ee.awaits=Ee.id=0),sr.push(W),lt(s,!0)}.bind(null,e):ks),e!==W&&(W=e,n===it&&(it.env=Fn()),Tr&&(r=it.env.Promise,t=e.env,(n.global||e.global)&&(Object.defineProperty(E,"Promise",t.PromiseProp),r.all=t.all,r.race=t.race,r.resolve=t.resolve,r.reject=t.reject,t.allSettled&&(r.allSettled=t.allSettled),t.any&&(r.any=t.any))))}function Fn(){var e=E.Promise;return Tr?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(E,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function vt(e,t,r,n,s){var i=W;try{return lt(e,!0),t(r,n,s)}finally{lt(i,!1)}}function Dn(e,t,r,n){return typeof e!="function"?e:function(){var s=W;r&&Ft(),lt(t,!0);try{return e.apply(this,arguments)}finally{lt(s,!1),n&&queueMicrotask(ot)}}}function qr(e){Promise===mt&&Ee.echoes===0?ir===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(""+ze).indexOf("[native code]")===-1&&(Ft=ot=fe);var _e=B.reject,bt="ï¿¿",Je="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",On="String expected.",Dt=[],lr="__dbnames",$r="readonly",zr="readwrite";function xt(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var Pn={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function cr(e){return typeof e!="string"||/\./.test(e)?function(t){return t}:function(t){return t[e]===void 0&&e in t&&delete(t=$(t))[e],t}}function An(){throw Y.Type()}function le(e,t){try{var r=Ln(e),n=Ln(t);if(r!==n)return r==="Array"?1:n==="Array"?-1:r==="binary"?1:n==="binary"?-1:r==="string"?1:n==="string"?-1:r==="Date"?1:n!=="Date"?NaN:-1;switch(r){case"number":case"Date":case"string":return t<e?1:e<t?-1:0;case"binary":return function(s,i){for(var o=s.length,c=i.length,h=o<c?o:c,m=0;m<h;++m)if(s[m]!==i[m])return s[m]<i[m]?-1:1;return o===c?0:o<c?-1:1}(Tn(e),Tn(t));case"Array":return function(s,i){for(var o=s.length,c=i.length,h=o<c?o:c,m=0;m<h;++m){var v=le(s[m],i[m]);if(v!==0)return v}return o===c?0:o<c?-1:1}(e,t)}}catch{}return NaN}function Ln(e){var t=typeof e;return t!="object"?t:ArrayBuffer.isView(e)?"binary":(e=V(e),e==="ArrayBuffer"?"binary":e)}function Tn(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var In=(me.prototype._trans=function(e,t,r){var n=this._tx||W.trans,s=this.name,i=Ye&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(e==="readonly"?"read":"write"," ").concat(this.name));function o(m,v,u){if(!u.schema[s])throw new Y.NotFound("Table "+s+" not part of transaction");return t(u.idbtrans,u)}var c=St();try{var h=n&&n.db._novip===this.db._novip?n===W.trans?n._promise(e,o,r):at(function(){return n._promise(e,o,r)},{trans:n,transless:W.transless||W}):function m(v,u,x,p){if(v.idbdb&&(v._state.openComplete||W.letThrough||v._vip)){var g=v._createTransaction(u,x,v._dbSchema);try{g.create(),v._state.PR1398_maxLoop=3}catch(b){return b.name===Ar.InvalidState&&v.isOpen()&&0<--v._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),v.close({disableAutoOpen:!1}),v.open().then(function(){return m(v,u,x,p)})):_e(b)}return g._promise(u,function(b,y){return at(function(){return W.trans=g,p(b,y,g)})}).then(function(b){if(u==="readwrite")try{g.idbtrans.commit()}catch{}return u==="readonly"?b:g._completion.then(function(){return b})})}if(v._state.openComplete)return _e(new Y.DatabaseClosed(v._state.dbOpenError));if(!v._state.isBeingOpened){if(!v._state.autoOpen)return _e(new Y.DatabaseClosed);v.open().catch(fe)}return v._state.dbReadyPromise.then(function(){return m(v,u,x,p)})}(this.db,e,[this.name],o);return i&&(h._consoleTask=i,h=h.catch(function(m){return console.trace(m),_e(m)})),h}finally{c&&Et()}},me.prototype.get=function(e,t){var r=this;return e&&e.constructor===Object?this.where(e).first(t):e==null?_e(new Y.Type("Invalid argument to Table.get()")):this._trans("readonly",function(n){return r.core.get({trans:n,key:e}).then(function(s){return r.hook.reading.fire(s)})}).then(t)},me.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(L(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=C(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(c){if(c.compound&&t.every(function(m){return 0<=c.keyPath.indexOf(m)})){for(var h=0;h<t.length;++h)if(t.indexOf(c.keyPath[h])===-1)return!1;return!0}return!1}).sort(function(c,h){return c.keyPath.length-h.keyPath.length})[0];if(r&&this.db._maxKey!==bt){var i=r.keyPath.slice(0,t.length);return this.where(i).equals(i.map(function(h){return e[h]}))}!r&&Ye&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var n=this.schema.idxByName;function s(c,h){return le(c,h)===0}var o=t.reduce(function(u,h){var m=u[0],v=u[1],u=n[h],x=e[h];return[m||u,m||!u?xt(v,u&&u.multi?function(p){return p=oe(p,h),L(p)&&p.some(function(g){return s(x,g)})}:function(p){return s(x,oe(p,h))}):v]},[null,null]),i=o[0],o=o[1];return i?this.where(i.name).equals(e[i.keyPath]).filter(o):r?this.filter(o):this.where(t).equals("")},me.prototype.filter=function(e){return this.toCollection().and(e)},me.prototype.count=function(e){return this.toCollection().count(e)},me.prototype.offset=function(e){return this.toCollection().offset(e)},me.prototype.limit=function(e){return this.toCollection().limit(e)},me.prototype.each=function(e){return this.toCollection().each(e)},me.prototype.toArray=function(e){return this.toCollection().toArray(e)},me.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},me.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,L(e)?"[".concat(e.join("+"),"]"):e))},me.prototype.reverse=function(){return this.toCollection().reverse()},me.prototype.mapToClass=function(e){var t,r=this.db,n=this.name;function s(){return t!==null&&t.apply(this,arguments)||this}(this.schema.mappedClass=e).prototype instanceof An&&(function(h,m){if(typeof m!="function"&&m!==null)throw new TypeError("Class extends value "+String(m)+" is not a constructor or null");function v(){this.constructor=h}f(h,m),h.prototype=m===null?Object.create(m):(v.prototype=m.prototype,new v)}(s,t=e),Object.defineProperty(s.prototype,"db",{get:function(){return r},enumerable:!1,configurable:!0}),s.prototype.table=function(){return n},e=s);for(var i=new Set,o=e.prototype;o;o=z(o))Object.getOwnPropertyNames(o).forEach(function(h){return i.add(h)});function c(h){if(!h)return h;var m,v=Object.create(e.prototype);for(m in h)if(!i.has(m))try{v[m]=h[m]}catch{}return v}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=c,this.hook("reading",c),e},me.prototype.defineClass=function(){return this.mapToClass(function(e){M(this,e)})},me.prototype.add=function(e,t){var r=this,n=this.schema.primKey,s=n.auto,i=n.keyPath,o=e;return i&&s&&(o=cr(i)(e)),this._trans("readwrite",function(c){return r.core.mutate({trans:c,type:"add",keys:t!=null?[t]:null,values:[o]})}).then(function(c){return c.numFailures?B.reject(c.failures[0]):c.lastResult}).then(function(c){if(i)try{U(e,i,c)}catch{}return c})},me.prototype.update=function(e,t){return typeof e!="object"||L(e)?this.where(":id").equals(e).modify(t):(e=oe(e,this.schema.primKey.keyPath),e===void 0?_e(new Y.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(t))},me.prototype.put=function(e,t){var r=this,n=this.schema.primKey,s=n.auto,i=n.keyPath,o=e;return i&&s&&(o=cr(i)(e)),this._trans("readwrite",function(c){return r.core.mutate({trans:c,type:"put",values:[o],keys:t!=null?[t]:null})}).then(function(c){return c.numFailures?B.reject(c.failures[0]):c.lastResult}).then(function(c){if(i)try{U(e,i,c)}catch{}return c})},me.prototype.delete=function(e){var t=this;return this._trans("readwrite",function(r){return t.core.mutate({trans:r,type:"delete",keys:[e]})}).then(function(r){return r.numFailures?B.reject(r.failures[0]):void 0})},me.prototype.clear=function(){var e=this;return this._trans("readwrite",function(t){return e.core.mutate({trans:t,type:"deleteRange",range:Pn})}).then(function(t){return t.numFailures?B.reject(t.failures[0]):void 0})},me.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",function(r){return t.core.getMany({keys:e,trans:r}).then(function(n){return n.map(function(s){return t.hook.reading.fire(s)})})})},me.prototype.bulkAdd=function(e,t,r){var n=this,s=Array.isArray(t)?t:void 0,i=(r=r||(s?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",function(o){var m=n.schema.primKey,c=m.auto,m=m.keyPath;if(m&&s)throw new Y.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new Y.InvalidArgument("Arguments objects and keys must have the same length");var h=e.length,m=m&&c?e.map(cr(m)):e;return n.core.mutate({trans:o,type:"add",keys:s,values:m,wantResults:i}).then(function(g){var u=g.numFailures,x=g.results,p=g.lastResult,g=g.failures;if(u===0)return i?x:p;throw new Ct("".concat(n.name,".bulkAdd(): ").concat(u," of ").concat(h," operations failed"),g)})})},me.prototype.bulkPut=function(e,t,r){var n=this,s=Array.isArray(t)?t:void 0,i=(r=r||(s?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",function(o){var m=n.schema.primKey,c=m.auto,m=m.keyPath;if(m&&s)throw new Y.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new Y.InvalidArgument("Arguments objects and keys must have the same length");var h=e.length,m=m&&c?e.map(cr(m)):e;return n.core.mutate({trans:o,type:"put",keys:s,values:m,wantResults:i}).then(function(g){var u=g.numFailures,x=g.results,p=g.lastResult,g=g.failures;if(u===0)return i?x:p;throw new Ct("".concat(n.name,".bulkPut(): ").concat(u," of ").concat(h," operations failed"),g)})})},me.prototype.bulkUpdate=function(e){var t=this,r=this.core,n=e.map(function(o){return o.key}),s=e.map(function(o){return o.changes}),i=[];return this._trans("readwrite",function(o){return r.getMany({trans:o,keys:n,cache:"clone"}).then(function(c){var h=[],m=[];e.forEach(function(u,x){var p=u.key,g=u.changes,b=c[x];if(b){for(var y=0,k=Object.keys(g);y<k.length;y++){var _=k[y],N=g[_];if(_===t.schema.primKey.keyPath){if(le(N,p)!==0)throw new Y.Constraint("Cannot update primary key in bulkUpdate()")}else U(b,_,N)}i.push(x),h.push(p),m.push(b)}});var v=h.length;return r.mutate({trans:o,type:"put",keys:h,values:m,updates:{keys:n,changeSpecs:s}}).then(function(u){var x=u.numFailures,p=u.failures;if(x===0)return v;for(var g=0,b=Object.keys(p);g<b.length;g++){var y,k=b[g],_=i[Number(k)];_!=null&&(y=p[k],delete p[k],p[_]=y)}throw new Ct("".concat(t.name,".bulkUpdate(): ").concat(x," of ").concat(v," operations failed"),p)})})})},me.prototype.bulkDelete=function(e){var t=this,r=e.length;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"delete",keys:e})}).then(function(o){var s=o.numFailures,i=o.lastResult,o=o.failures;if(s===0)return i;throw new Ct("".concat(t.name,".bulkDelete(): ").concat(s," of ").concat(r," operations failed"),o)})},me);function me(){}function qt(e){function t(o,c){if(c){for(var h=arguments.length,m=new Array(h-1);--h;)m[h-1]=arguments[h];return r[o].subscribe.apply(null,m),e}if(typeof o=="string")return r[o]}var r={};t.addEventType=i;for(var n=1,s=arguments.length;n<s;++n)i(arguments[n]);return t;function i(o,c,h){if(typeof o!="object"){var m;c=c||gs;var v={subscribers:[],fire:h=h||fe,subscribe:function(u){v.subscribers.indexOf(u)===-1&&(v.subscribers.push(u),v.fire=c(v.fire,u))},unsubscribe:function(u){v.subscribers=v.subscribers.filter(function(x){return x!==u}),v.fire=v.subscribers.reduce(c,h)}};return r[o]=t[o]=v}C(m=o).forEach(function(u){var x=m[u];if(L(x))i(u,m[u][0],m[u][1]);else{if(x!=="asap")throw new Y.InvalidArgument("Invalid event config");var p=i(u,Kt,function(){for(var g=arguments.length,b=new Array(g);g--;)b[g]=arguments[g];p.subscribers.forEach(function(y){pe(function(){y.apply(null,b)})})})}})}}function $t(e,t){return ie(t).from({prototype:e}),t}function Ot(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Ur(e,t){e.filter=xt(e.filter,t)}function Hr(e,t,r){var n=e.replayFilter;e.replayFilter=n?function(){return xt(n(),t())}:t,e.justLimit=r&&!n}function ur(e,t){if(e.isPrimKey)return t.primaryKey;var r=t.getIndexByKeyPath(e.index);if(!r)throw new Y.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return r}function Kn(e,t,r){var n=ur(e,t.schema);return t.openCursor({trans:r,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:n,range:e.range}})}function dr(e,t,r,n){var s=e.replayFilter?xt(e.filter,e.replayFilter()):e.filter;if(e.or){var i={},o=function(c,h,m){var v,u;s&&!s(h,m,function(x){return h.stop(x)},function(x){return h.fail(x)})||((u=""+(v=h.primaryKey))=="[object ArrayBuffer]"&&(u=""+new Uint8Array(v)),X(i,u)||(i[u]=!0,t(c,h,m)))};return Promise.all([e.or._iterate(o,r),Mn(Kn(e,n,r),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}return Mn(Kn(e,n,r),xt(e.algorithm,s),t,!e.keysOnly&&e.valueMapper)}function Mn(e,t,r,n){var s=ve(n?function(i,o,c){return r(n(i),o,c)}:r);return e.then(function(i){if(i)return i.start(function(){var o=function(){return i.continue()};t&&!t(i,function(c){return o=c},function(c){i.stop(c),o=fe},function(c){i.fail(c),o=fe})||s(i.value,i,function(c){return o=c}),o()})})}var zt=(Rn.prototype.execute=function(e){var t=this["@@propmod"];if(t.add!==void 0){var r=t.add;if(L(r))return j(j([],L(e)?e:[],!0),r).sort();if(typeof r=="number")return(Number(e)||0)+r;if(typeof r=="bigint")try{return BigInt(e)+r}catch{return BigInt(0)+r}throw new TypeError("Invalid term ".concat(r))}if(t.remove!==void 0){var n=t.remove;if(L(n))return L(e)?e.filter(function(s){return!n.includes(s)}).sort():[];if(typeof n=="number")return Number(e)-n;if(typeof n=="bigint")try{return BigInt(e)-n}catch{return BigInt(0)-n}throw new TypeError("Invalid subtrahend ".concat(n))}return r=(r=t.replacePrefix)===null||r===void 0?void 0:r[0],r&&typeof e=="string"&&e.startsWith(r)?t.replacePrefix[1]+e.substring(r.length):e},Rn);function Rn(e){this["@@propmod"]=e}var js=(ue.prototype._read=function(e,t){var r=this._ctx;return r.error?r.table._trans(null,_e.bind(null,r.error)):r.table._trans("readonly",e).then(t)},ue.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,_e.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},ue.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=xt(t.algorithm,e)},ue.prototype._iterate=function(e,t){return dr(this._ctx,e,t,this._ctx.table.core)},ue.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&M(r,e),t._ctx=r,t},ue.prototype.raw=function(){return this._ctx.valueMapper=null,this},ue.prototype.each=function(e){var t=this._ctx;return this._read(function(r){return dr(t,e,r,t.table.core)})},ue.prototype.count=function(e){var t=this;return this._read(function(r){var n=t._ctx,s=n.table.core;if(Ot(n,!0))return s.count({trans:r,query:{index:ur(n,s.schema),range:n.range}}).then(function(o){return Math.min(o,n.limit)});var i=0;return dr(n,function(){return++i,!1},r,s).then(function(){return i})}).then(e)},ue.prototype.sortBy=function(e,t){var r=e.split(".").reverse(),n=r[0],s=r.length-1;function i(h,m){return m?i(h[r[m]],m-1):h[n]}var o=this._ctx.dir==="next"?1:-1;function c(h,m){return le(i(h,s),i(m,s))*o}return this.toArray(function(h){return h.sort(c)}).then(t)},ue.prototype.toArray=function(e){var t=this;return this._read(function(r){var n=t._ctx;if(n.dir==="next"&&Ot(n,!0)&&0<n.limit){var s=n.valueMapper,i=ur(n,n.table.core.schema);return n.table.core.query({trans:r,limit:n.limit,values:!0,query:{index:i,range:n.range}}).then(function(c){return c=c.result,s?c.map(s):c})}var o=[];return dr(n,function(c){return o.push(c)},r,n.table.core).then(function(){return o})},e)},ue.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,Ot(t)?Hr(t,function(){var r=e;return function(n,s){return r===0||(r===1?--r:s(function(){n.advance(r),r=0}),!1)}}):Hr(t,function(){var r=e;return function(){return--r<0}})),this},ue.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Hr(this._ctx,function(){var t=e;return function(r,n,s){return--t<=0&&n(s),0<=t}},!0),this},ue.prototype.until=function(e,t){return Ur(this._ctx,function(r,n,s){return!e(r.value)||(n(s),t)}),this},ue.prototype.first=function(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)},ue.prototype.last=function(e){return this.reverse().first(e)},ue.prototype.filter=function(e){var t;return Ur(this._ctx,function(r){return e(r.value)}),(t=this._ctx).isMatch=xt(t.isMatch,e),this},ue.prototype.and=function(e){return this.filter(e)},ue.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},ue.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},ue.prototype.desc=function(){return this.reverse()},ue.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,n){e(n.key,n)})},ue.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},ue.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,n){e(n.primaryKey,n)})},ue.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var r=[];return this.each(function(n,s){r.push(s.key)}).then(function(){return r}).then(e)},ue.prototype.primaryKeys=function(e){var t=this._ctx;if(t.dir==="next"&&Ot(t,!0)&&0<t.limit)return this._read(function(n){var s=ur(t,t.table.core.schema);return t.table.core.query({trans:n,values:!1,limit:t.limit,query:{index:s,range:t.range}})}).then(function(n){return n.result}).then(e);t.keysOnly=!t.isMatch;var r=[];return this.each(function(n,s){r.push(s.primaryKey)}).then(function(){return r}).then(e)},ue.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},ue.prototype.firstKey=function(e){return this.limit(1).keys(function(t){return t[0]}).then(e)},ue.prototype.lastKey=function(e){return this.reverse().firstKey(e)},ue.prototype.distinct=function(){var e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];if(!e||!e.multi)return this;var t={};return Ur(this._ctx,function(s){var n=s.primaryKey.toString(),s=X(t,n);return t[n]=!0,!s}),this},ue.prototype.modify=function(e){var t=this,r=this._ctx;return this._write(function(n){var s,i,o;o=typeof e=="function"?e:(s=C(e),i=s.length,function(y){for(var k=!1,_=0;_<i;++_){var N=s[_],S=e[N],D=oe(y,N);S instanceof zt?(U(y,N,S.execute(D)),k=!0):D!==S&&(U(y,N,S),k=!0)}return k});var c=r.table.core,u=c.schema.primaryKey,h=u.outbound,m=u.extractKey,v=200,u=t.db._options.modifyChunkSize;u&&(v=typeof u=="object"?u[c.name]||u["*"]||200:u);function x(y,N){var _=N.failures,N=N.numFailures;g+=y-N;for(var S=0,D=C(_);S<D.length;S++){var T=D[S];p.push(_[T])}}var p=[],g=0,b=[];return t.clone().primaryKeys().then(function(y){function k(N){var S=Math.min(v,y.length-N);return c.getMany({trans:n,keys:y.slice(N,N+S),cache:"immutable"}).then(function(D){for(var T=[],O=[],P=h?[]:null,K=[],A=0;A<S;++A){var q=D[A],ee={value:$(q),primKey:y[N+A]};o.call(ee,ee.value,ee)!==!1&&(ee.value==null?K.push(y[N+A]):h||le(m(q),m(ee.value))===0?(O.push(ee.value),h&&P.push(y[N+A])):(K.push(y[N+A]),T.push(ee.value)))}return Promise.resolve(0<T.length&&c.mutate({trans:n,type:"add",values:T}).then(function(re){for(var ne in re.failures)K.splice(parseInt(ne),1);x(T.length,re)})).then(function(){return(0<O.length||_&&typeof e=="object")&&c.mutate({trans:n,type:"put",keys:P,values:O,criteria:_,changeSpec:typeof e!="function"&&e,isAdditionalChunk:0<N}).then(function(re){return x(O.length,re)})}).then(function(){return(0<K.length||_&&e===Wr)&&c.mutate({trans:n,type:"delete",keys:K,criteria:_,isAdditionalChunk:0<N}).then(function(re){return x(K.length,re)})}).then(function(){return y.length>N+S&&k(N+v)})})}var _=Ot(r)&&r.limit===1/0&&(typeof e!="function"||e===Wr)&&{index:r.index,range:r.range};return k(0).then(function(){if(0<p.length)throw new Zt("Error modifying one or more objects",p,g,b);return y.length})})})},ue.prototype.delete=function(){var e=this._ctx,t=e.range;return Ot(e)&&(e.isPrimKey||t.type===3)?this._write(function(r){var n=e.table.core.schema.primaryKey,s=t;return e.table.core.count({trans:r,query:{index:n,range:s}}).then(function(i){return e.table.core.mutate({trans:r,type:"deleteRange",range:s}).then(function(o){var c=o.failures;if(o.lastResult,o.results,o=o.numFailures,o)throw new Zt("Could not delete some values",Object.keys(c).map(function(h){return c[h]}),i-o);return i-o})})}):this.modify(Wr)},ue);function ue(){}var Wr=function(e,t){return t.value=null};function _s(e,t){return e<t?-1:e===t?0:1}function Ns(e,t){return t<e?-1:e===t?0:1}function Ve(e,t,r){return e=e instanceof Vn?new e.Collection(e):e,e._ctx.error=new(r||TypeError)(t),e}function Pt(e){return new e.Collection(e,function(){return Bn("")}).limit(0)}function fr(e,t,r,n){var s,i,o,c,h,m,v,u=r.length;if(!r.every(function(g){return typeof g=="string"}))return Ve(e,On);function x(g){s=g==="next"?function(y){return y.toUpperCase()}:function(y){return y.toLowerCase()},i=g==="next"?function(y){return y.toLowerCase()}:function(y){return y.toUpperCase()},o=g==="next"?_s:Ns;var b=r.map(function(y){return{lower:i(y),upper:s(y)}}).sort(function(y,k){return o(y.lower,k.lower)});c=b.map(function(y){return y.upper}),h=b.map(function(y){return y.lower}),v=(m=g)==="next"?"":n}x("next"),e=new e.Collection(e,function(){return ct(c[0],h[u-1]+n)}),e._ondirectionchange=function(g){x(g)};var p=0;return e._addAlgorithm(function(g,b,y){var k=g.key;if(typeof k!="string")return!1;var _=i(k);if(t(_,h,p))return!0;for(var N=null,S=p;S<u;++S){var D=function(T,O,P,K,A,q){for(var ee=Math.min(T.length,K.length),re=-1,ne=0;ne<ee;++ne){var qe=O[ne];if(qe!==K[ne])return A(T[ne],P[ne])<0?T.substr(0,ne)+P[ne]+P.substr(ne+1):A(T[ne],K[ne])<0?T.substr(0,ne)+K[ne]+P.substr(ne+1):0<=re?T.substr(0,re)+O[re]+P.substr(re+1):null;A(T[ne],qe)<0&&(re=ne)}return ee<K.length&&q==="next"?T+P.substr(T.length):ee<T.length&&q==="prev"?T.substr(0,P.length):re<0?null:T.substr(0,re)+K[re]+P.substr(re+1)}(k,_,c[S],h[S],o,m);D===null&&N===null?p=S+1:(N===null||0<o(N,D))&&(N=D)}return b(N!==null?function(){g.continue(N+v)}:y),!1}),e}function ct(e,t,r,n){return{type:2,lower:e,upper:t,lowerOpen:r,upperOpen:n}}function Bn(e){return{type:1,lower:e,upper:e}}var Vn=(Object.defineProperty(Fe.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Fe.prototype.between=function(e,t,r,n){r=r!==!1,n=n===!0;try{return 0<this._cmp(e,t)||this._cmp(e,t)===0&&(r||n)&&(!r||!n)?Pt(this):new this.Collection(this,function(){return ct(e,t,!r,!n)})}catch{return Ve(this,Je)}},Fe.prototype.equals=function(e){return e==null?Ve(this,Je):new this.Collection(this,function(){return Bn(e)})},Fe.prototype.above=function(e){return e==null?Ve(this,Je):new this.Collection(this,function(){return ct(e,void 0,!0)})},Fe.prototype.aboveOrEqual=function(e){return e==null?Ve(this,Je):new this.Collection(this,function(){return ct(e,void 0,!1)})},Fe.prototype.below=function(e){return e==null?Ve(this,Je):new this.Collection(this,function(){return ct(void 0,e,!1,!0)})},Fe.prototype.belowOrEqual=function(e){return e==null?Ve(this,Je):new this.Collection(this,function(){return ct(void 0,e)})},Fe.prototype.startsWith=function(e){return typeof e!="string"?Ve(this,On):this.between(e,e+bt,!0,!0)},Fe.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):fr(this,function(t,r){return t.indexOf(r[0])===0},[e],bt)},Fe.prototype.equalsIgnoreCase=function(e){return fr(this,function(t,r){return t===r[0]},[e],"")},Fe.prototype.anyOfIgnoreCase=function(){var e=Ze.apply(st,arguments);return e.length===0?Pt(this):fr(this,function(t,r){return r.indexOf(t)!==-1},e,"")},Fe.prototype.startsWithAnyOfIgnoreCase=function(){var e=Ze.apply(st,arguments);return e.length===0?Pt(this):fr(this,function(t,r){return r.some(function(n){return t.indexOf(n)===0})},e,bt)},Fe.prototype.anyOf=function(){var e=this,t=Ze.apply(st,arguments),r=this._cmp;try{t.sort(r)}catch{return Ve(this,Je)}if(t.length===0)return Pt(this);var n=new this.Collection(this,function(){return ct(t[0],t[t.length-1])});n._ondirectionchange=function(i){r=i==="next"?e._ascending:e._descending,t.sort(r)};var s=0;return n._addAlgorithm(function(i,o,c){for(var h=i.key;0<r(h,t[s]);)if(++s===t.length)return o(c),!1;return r(h,t[s])===0||(o(function(){i.continue(t[s])}),!1)}),n},Fe.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Fe.prototype.noneOf=function(){var e=Ze.apply(st,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return Ve(this,Je)}var t=e.reduce(function(r,n){return r?r.concat([[r[r.length-1][1],n]]):[[-1/0,n]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},Fe.prototype.inAnyRange=function(k,t){var r=this,n=this._cmp,s=this._ascending,i=this._descending,o=this._min,c=this._max;if(k.length===0)return Pt(this);if(!k.every(function(_){return _[0]!==void 0&&_[1]!==void 0&&s(_[0],_[1])<=0}))return Ve(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Y.InvalidArgument);var h=!t||t.includeLowers!==!1,m=t&&t.includeUppers===!0,v,u=s;function x(_,N){return u(_[0],N[0])}try{(v=k.reduce(function(_,N){for(var S=0,D=_.length;S<D;++S){var T=_[S];if(n(N[0],T[1])<0&&0<n(N[1],T[0])){T[0]=o(T[0],N[0]),T[1]=c(T[1],N[1]);break}}return S===D&&_.push(N),_},[])).sort(x)}catch{return Ve(this,Je)}var p=0,g=m?function(_){return 0<s(_,v[p][1])}:function(_){return 0<=s(_,v[p][1])},b=h?function(_){return 0<i(_,v[p][0])}:function(_){return 0<=i(_,v[p][0])},y=g,k=new this.Collection(this,function(){return ct(v[0][0],v[v.length-1][1],!h,!m)});return k._ondirectionchange=function(_){u=_==="next"?(y=g,s):(y=b,i),v.sort(x)},k._addAlgorithm(function(_,N,S){for(var D,T=_.key;y(T);)if(++p===v.length)return N(S),!1;return!g(D=T)&&!b(D)||(r._cmp(T,v[p][1])===0||r._cmp(T,v[p][0])===0||N(function(){u===s?_.continue(v[p][0]):_.continue(v[p][1])}),!1)}),k},Fe.prototype.startsWithAnyOf=function(){var e=Ze.apply(st,arguments);return e.every(function(t){return typeof t=="string"})?e.length===0?Pt(this):this.inAnyRange(e.map(function(t){return[t,t+bt]})):Ve(this,"startsWithAnyOf() only works with strings")},Fe);function Fe(){}function Xe(e){return ve(function(t){return Ut(t),e(t.target.error),!1})}function Ut(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var Ht="storagemutated",Yr="x-storagemutated-1",ut=qt(null,Ht),Cs=(Qe.prototype._lock=function(){return xe(!W.global),++this._reculock,this._reculock!==1||W.global||(W.lockOwnerFor=this),this},Qe.prototype._unlock=function(){if(xe(!W.global),--this._reculock==0)for(W.global||(W.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{vt(e[1],e[0])}catch{}}return this},Qe.prototype._locked=function(){return this._reculock&&W.lockOwnerFor!==this},Qe.prototype.create=function(e){var t=this;if(!this.mode)return this;var r=this.db.idbdb,n=this.db._state.dbOpenError;if(xe(!this.idbtrans),!e&&!r)switch(n&&n.name){case"DatabaseClosedError":throw new Y.DatabaseClosed(n);case"MissingAPIError":throw new Y.MissingAPI(n.message,n);default:throw new Y.OpenFailed(n)}if(!this.active)throw new Y.TransactionInactive;return xe(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||r).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=ve(function(s){Ut(s),t._reject(e.error)}),e.onabort=ve(function(s){Ut(s),t.active&&t._reject(new Y.Abort(e.error)),t.active=!1,t.on("abort").fire(s)}),e.oncomplete=ve(function(){t.active=!1,t._resolve(),"mutatedParts"in e&&ut.storagemutated.fire(e.mutatedParts)}),this},Qe.prototype._promise=function(e,t,r){var n=this;if(e==="readwrite"&&this.mode!=="readwrite")return _e(new Y.ReadOnly("Transaction is readonly"));if(!this.active)return _e(new Y.TransactionInactive);if(this._locked())return new B(function(i,o){n._blockedFuncs.push([function(){n._promise(e,t,r).then(i,o)},W])});if(r)return at(function(){var i=new B(function(o,c){n._lock();var h=t(o,c,n);h&&h.then&&h.then(o,c)});return i.finally(function(){return n._unlock()}),i._lib=!0,i});var s=new B(function(i,o){var c=t(i,o,n);c&&c.then&&c.then(i,o)});return s._lib=!0,s},Qe.prototype._root=function(){return this.parent?this.parent._root():this},Qe.prototype.waitFor=function(e){var t,r=this._root(),n=B.resolve(e);r._waitingFor?r._waitingFor=r._waitingFor.then(function(){return n}):(r._waitingFor=n,r._waitingQueue=[],t=r.idbtrans.objectStore(r.storeNames[0]),function i(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(t.get(-1/0).onsuccess=i)}());var s=r._waitingFor;return new B(function(i,o){n.then(function(c){return r._waitingQueue.push(ve(i.bind(null,c)))},function(c){return r._waitingQueue.push(ve(o.bind(null,c)))}).finally(function(){r._waitingFor===s&&(r._waitingFor=null)})})},Qe.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Y.Abort))},Qe.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(X(t,e))return t[e];var r=this.schema[e];if(!r)throw new Y.NotFound("Table "+e+" not part of transaction");return r=new this.db.Table(e,r,this),r.core=this.db.core.table(e),t[e]=r},Qe);function Qe(){}function Xr(e,t,r,n,s,i,o){return{name:e,keyPath:t,unique:r,multi:n,auto:s,compound:i,src:(r&&!o?"&":"")+(n?"*":"")+(s?"++":"")+qn(t)}}function qn(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function Qr(e,t,r){return{name:e,primKey:t,indexes:r,mappedClass:null,idxByName:(n=function(s){return[s.name,s]},r.reduce(function(s,i,o){return o=n(i,o),o&&(s[o[0]]=o[1]),s},{}))};var n}var Wt=function(e){try{return e.only([[]]),Wt=function(){return[[]]},[[]]}catch{return Wt=function(){return bt},bt}};function Gr(e){return e==null?function(){}:typeof e=="string"?(t=e).split(".").length===1?function(r){return r[t]}:function(r){return oe(r,t)}:function(r){return oe(r,e)};var t}function $n(e){return[].slice.call(e)}var Ss=0;function Yt(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function Es(e,t,h){function n(y){if(y.type===3)return null;if(y.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var p=y.lower,g=y.upper,b=y.lowerOpen,y=y.upperOpen;return p===void 0?g===void 0?null:t.upperBound(g,!!y):g===void 0?t.lowerBound(p,!!b):t.bound(p,g,!!b,!!y)}function s(x){var p,g=x.name;return{name:g,schema:x,mutate:function(b){var y=b.trans,k=b.type,_=b.keys,N=b.values,S=b.range;return new Promise(function(D,T){D=ve(D);var O=y.objectStore(g),P=O.keyPath==null,K=k==="put"||k==="add";if(!K&&k!=="delete"&&k!=="deleteRange")throw new Error("Invalid operation type: "+k);var A,q=(_||N||{length:1}).length;if(_&&N&&_.length!==N.length)throw new Error("Given keys array must have same length as given values array.");if(q===0)return D({numFailures:0,failures:{},results:[],lastResult:void 0});function ee(Ie){++qe,Ut(Ie)}var re=[],ne=[],qe=0;if(k==="deleteRange"){if(S.type===4)return D({numFailures:qe,failures:ne,results:[],lastResult:void 0});S.type===3?re.push(A=O.clear()):re.push(A=O.delete(n(S)))}else{var P=K?P?[N,_]:[N,null]:[_,null],J=P[0],Ae=P[1];if(K)for(var Le=0;Le<q;++Le)re.push(A=Ae&&Ae[Le]!==void 0?O[k](J[Le],Ae[Le]):O[k](J[Le])),A.onerror=ee;else for(Le=0;Le<q;++Le)re.push(A=O[k](J[Le])),A.onerror=ee}function Nr(Ie){Ie=Ie.target.result,re.forEach(function(jt,yn){return jt.error!=null&&(ne[yn]=jt.error)}),D({numFailures:qe,failures:ne,results:k==="delete"?_:re.map(function(jt){return jt.result}),lastResult:Ie})}A.onerror=function(Ie){ee(Ie),Nr(Ie)},A.onsuccess=Nr})},getMany:function(b){var y=b.trans,k=b.keys;return new Promise(function(_,N){_=ve(_);for(var S,D=y.objectStore(g),T=k.length,O=new Array(T),P=0,K=0,A=function(re){re=re.target,O[re._pos]=re.result,++K===P&&_(O)},q=Xe(N),ee=0;ee<T;++ee)k[ee]!=null&&((S=D.get(k[ee]))._pos=ee,S.onsuccess=A,S.onerror=q,++P);P===0&&_(O)})},get:function(b){var y=b.trans,k=b.key;return new Promise(function(_,N){_=ve(_);var S=y.objectStore(g).get(k);S.onsuccess=function(D){return _(D.target.result)},S.onerror=Xe(N)})},query:(p=m,function(b){return new Promise(function(y,k){y=ve(y);var _,N,S,P=b.trans,D=b.values,T=b.limit,A=b.query,O=T===1/0?void 0:T,K=A.index,A=A.range,P=P.objectStore(g),K=K.isPrimaryKey?P:P.index(K.name),A=n(A);if(T===0)return y({result:[]});p?((O=D?K.getAll(A,O):K.getAllKeys(A,O)).onsuccess=function(q){return y({result:q.target.result})},O.onerror=Xe(k)):(_=0,N=!D&&"openKeyCursor"in K?K.openKeyCursor(A):K.openCursor(A),S=[],N.onsuccess=function(q){var ee=N.result;return ee?(S.push(D?ee.value:ee.primaryKey),++_===T?y({result:S}):void ee.continue()):y({result:S})},N.onerror=Xe(k))})}),openCursor:function(b){var y=b.trans,k=b.values,_=b.query,N=b.reverse,S=b.unique;return new Promise(function(D,T){D=ve(D);var K=_.index,O=_.range,P=y.objectStore(g),P=K.isPrimaryKey?P:P.index(K.name),K=N?S?"prevunique":"prev":S?"nextunique":"next",A=!k&&"openKeyCursor"in P?P.openKeyCursor(n(O),K):P.openCursor(n(O),K);A.onerror=Xe(T),A.onsuccess=ve(function(q){var ee,re,ne,qe,J=A.result;J?(J.___id=++Ss,J.done=!1,ee=J.continue.bind(J),re=(re=J.continuePrimaryKey)&&re.bind(J),ne=J.advance.bind(J),qe=function(){throw new Error("Cursor not stopped")},J.trans=y,J.stop=J.continue=J.continuePrimaryKey=J.advance=function(){throw new Error("Cursor not started")},J.fail=ve(T),J.next=function(){var Ae=this,Le=1;return this.start(function(){return Le--?Ae.continue():Ae.stop()}).then(function(){return Ae})},J.start=function(Ae){function Le(){if(A.result)try{Ae()}catch(Ie){J.fail(Ie)}else J.done=!0,J.start=function(){throw new Error("Cursor behind last entry")},J.stop()}var Nr=new Promise(function(Ie,jt){Ie=ve(Ie),A.onerror=Xe(jt),J.fail=jt,J.stop=function(yn){J.stop=J.continue=J.continuePrimaryKey=J.advance=qe,Ie(yn)}});return A.onsuccess=ve(function(Ie){A.onsuccess=Le,Le()}),J.continue=ee,J.continuePrimaryKey=re,J.advance=ne,Le(),Nr},D(J)):D(null)},T)})},count:function(b){var y=b.query,k=b.trans,_=y.index,N=y.range;return new Promise(function(S,D){var T=k.objectStore(g),O=_.isPrimaryKey?T:T.index(_.name),T=n(N),O=T?O.count(T):O.count();O.onsuccess=ve(function(P){return S(P.target.result)}),O.onerror=Xe(D)})}}}var i,o,c,v=(o=h,c=$n((i=e).objectStoreNames),{schema:{name:i.name,tables:c.map(function(x){return o.objectStore(x)}).map(function(x){var p=x.keyPath,y=x.autoIncrement,g=L(p),b={},y={name:x.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:p==null,compound:g,keyPath:p,autoIncrement:y,unique:!0,extractKey:Gr(p)},indexes:$n(x.indexNames).map(function(k){return x.index(k)}).map(function(S){var _=S.name,N=S.unique,D=S.multiEntry,S=S.keyPath,D={name:_,compound:L(S),keyPath:S,unique:N,multiEntry:D,extractKey:Gr(S)};return b[Yt(S)]=D}),getIndexByKeyPath:function(k){return b[Yt(k)]}};return b[":id"]=y.primaryKey,p!=null&&(b[Yt(p)]=y.primaryKey),y})},hasGetAll:0<c.length&&"getAll"in o.objectStore(c[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),h=v.schema,m=v.hasGetAll,v=h.tables.map(s),u={};return v.forEach(function(x){return u[x.name]=x}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(x){if(!u[x])throw new Error("Table '".concat(x,"' not found"));return u[x]},MIN_KEY:-1/0,MAX_KEY:Wt(t),schema:h}}function Fs(e,t,r,n){var s=r.IDBKeyRange;return r.indexedDB,{dbcore:(n=Es(t,s,n),e.dbcore.reduce(function(i,o){return o=o.create,d(d({},i),o(i))},n))}}function hr(e,n){var r=n.db,n=Fs(e._middlewares,r,e._deps,n);e.core=n.dbcore,e.tables.forEach(function(s){var i=s.name;e.core.schema.tables.some(function(o){return o.name===i})&&(s.core=e.core.table(i),e[i]instanceof e.Table&&(e[i].core=s.core))})}function pr(e,t,r,n){r.forEach(function(s){var i=n[s];t.forEach(function(o){var c=function h(m,v){return he(m,v)||(m=z(m))&&h(m,v)}(o,s);(!c||"value"in c&&c.value===void 0)&&(o===e.Transaction.prototype||o instanceof e.Transaction?Z(o,s,{get:function(){return this.table(s)},set:function(h){R(this,s,{value:h,writable:!0,configurable:!0,enumerable:!0})}}):o[s]=new e.Table(s,i))})})}function Zr(e,t){t.forEach(function(r){for(var n in r)r[n]instanceof e.Table&&delete r[n]})}function Ds(e,t){return e._cfg.version-t._cfg.version}function Os(e,t,r,n){var s=e._dbSchema;r.objectStoreNames.contains("$meta")&&!s.$meta&&(s.$meta=Qr("$meta",Un("")[0],[]),e._storeNames.push("$meta"));var i=e._createTransaction("readwrite",e._storeNames,s);i.create(r),i._completion.catch(n);var o=i._reject.bind(i),c=W.transless||W;at(function(){return W.trans=i,W.transless=c,t!==0?(hr(e,r),m=t,((h=i).storeNames.includes("$meta")?h.table("$meta").get("version").then(function(v){return v??m}):B.resolve(m)).then(function(v){return x=v,p=i,g=r,b=[],v=(u=e)._versions,y=u._dbSchema=yr(0,u.idbdb,g),(v=v.filter(function(k){return k._cfg.version>=x})).length!==0?(v.forEach(function(k){b.push(function(){var _=y,N=k._cfg.dbschema;gr(u,_,g),gr(u,N,g),y=u._dbSchema=N;var S=Jr(_,N);S.add.forEach(function(K){en(g,K[0],K[1].primKey,K[1].indexes)}),S.change.forEach(function(K){if(K.recreate)throw new Y.Upgrade("Not yet support for changing primary key");var A=g.objectStore(K.name);K.add.forEach(function(q){return mr(A,q)}),K.change.forEach(function(q){A.deleteIndex(q.name),mr(A,q)}),K.del.forEach(function(q){return A.deleteIndex(q)})});var D=k._cfg.contentUpgrade;if(D&&k._cfg.version>x){hr(u,g),p._memoizedTables={};var T=te(N);S.del.forEach(function(K){T[K]=_[K]}),Zr(u,[u.Transaction.prototype]),pr(u,[u.Transaction.prototype],C(T),T),p.schema=T;var O,P=Pr(D);return P&&Ft(),S=B.follow(function(){var K;(O=D(p))&&P&&(K=ot.bind(null,null),O.then(K,K))}),O&&typeof O.then=="function"?B.resolve(O):S.then(function(){return O})}}),b.push(function(_){var N,S,D=k._cfg.dbschema;N=D,S=_,[].slice.call(S.db.objectStoreNames).forEach(function(T){return N[T]==null&&S.db.deleteObjectStore(T)}),Zr(u,[u.Transaction.prototype]),pr(u,[u.Transaction.prototype],u._storeNames,u._dbSchema),p.schema=u._dbSchema}),b.push(function(_){u.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(u.idbdb.version/10)===k._cfg.version?(u.idbdb.deleteObjectStore("$meta"),delete u._dbSchema.$meta,u._storeNames=u._storeNames.filter(function(N){return N!=="$meta"})):_.objectStore("$meta").put(k._cfg.version,"version"))})}),function k(){return b.length?B.resolve(b.shift()(p.idbtrans)).then(k):B.resolve()}().then(function(){zn(y,g)})):B.resolve();var u,x,p,g,b,y}).catch(o)):(C(s).forEach(function(v){en(r,v,s[v].primKey,s[v].indexes)}),hr(e,r),void B.follow(function(){return e.on.populate.fire(i)}).catch(o));var h,m})}function Ps(e,t){zn(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var r=yr(0,e.idbdb,t);gr(e,e._dbSchema,t);for(var n=0,s=Jr(r,e._dbSchema).change;n<s.length;n++){var i=function(o){if(o.change.length||o.recreate)return console.warn("Unable to patch indexes of table ".concat(o.name," because it has changes on the type of index or primary key.")),{value:void 0};var c=t.objectStore(o.name);o.add.forEach(function(h){Ye&&console.debug("Dexie upgrade patch: Creating missing index ".concat(o.name,".").concat(h.src)),mr(c,h)})}(s[n]);if(typeof i=="object")return i.value}}function Jr(e,t){var r,n={del:[],add:[],change:[]};for(r in e)t[r]||n.del.push(r);for(r in t){var s=e[r],i=t[r];if(s){var o={name:r,def:i,recreate:!1,del:[],add:[],change:[]};if(""+(s.primKey.keyPath||"")!=""+(i.primKey.keyPath||"")||s.primKey.auto!==i.primKey.auto)o.recreate=!0,n.change.push(o);else{var c=s.idxByName,h=i.idxByName,m=void 0;for(m in c)h[m]||o.del.push(m);for(m in h){var v=c[m],u=h[m];v?v.src!==u.src&&o.change.push(u):o.add.push(u)}(0<o.del.length||0<o.add.length||0<o.change.length)&&n.change.push(o)}}else n.add.push([r,i])}return n}function en(e,t,r,n){var s=e.db.createObjectStore(t,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return n.forEach(function(i){return mr(s,i)}),s}function zn(e,t){C(e).forEach(function(r){t.db.objectStoreNames.contains(r)||(Ye&&console.debug("Dexie: Creating missing table",r),en(t,r,e[r].primKey,e[r].indexes))})}function mr(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function yr(e,t,r){var n={};return de(t.objectStoreNames,0).forEach(function(s){for(var i=r.objectStore(s),o=Xr(qn(m=i.keyPath),m||"",!0,!1,!!i.autoIncrement,m&&typeof m!="string",!0),c=[],h=0;h<i.indexNames.length;++h){var v=i.index(i.indexNames[h]),m=v.keyPath,v=Xr(v.name,m,!!v.unique,!!v.multiEntry,!1,m&&typeof m!="string",!1);c.push(v)}n[s]=Qr(s,o,c)}),n}function gr(e,t,r){for(var n=r.db.objectStoreNames,s=0;s<n.length;++s){var i=n[s],o=r.objectStore(i);e._hasGetAll="getAll"in o;for(var c=0;c<o.indexNames.length;++c){var h=o.indexNames[c],m=o.index(h).keyPath,v=typeof m=="string"?m:"["+de(m).join("+")+"]";!t[i]||(m=t[i].idxByName[v])&&(m.name=h,delete t[i].idxByName[v],t[i].idxByName[h]=m)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&E.WorkerGlobalScope&&E instanceof E.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function Un(e){return e.split(",").map(function(t,r){var n=(t=t.trim()).replace(/([&*]|\+\+)/g,""),s=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return Xr(n,s||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),L(s),r===0)})}var As=(vr.prototype._parseStoresSpec=function(e,t){C(e).forEach(function(r){if(e[r]!==null){var n=Un(e[r]),s=n.shift();if(s.unique=!0,s.multi)throw new Y.Schema("Primary key cannot be multi-valued");n.forEach(function(i){if(i.auto)throw new Y.Schema("Only primary key can be marked as autoIncrement (++)");if(!i.keyPath)throw new Y.Schema("Index must have a name and cannot be an empty string")}),t[r]=Qr(r,s,n)}})},vr.prototype.stores=function(r){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?M(this._cfg.storesSource,r):r;var r=t._versions,n={},s={};return r.forEach(function(i){M(n,i._cfg.storesSource),s=i._cfg.dbschema={},i._parseStoresSpec(n,s)}),t._dbSchema=s,Zr(t,[t._allTables,t,t.Transaction.prototype]),pr(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],C(s),s),t._storeNames=C(s),this},vr.prototype.upgrade=function(e){return this._cfg.contentUpgrade=Lr(this._cfg.contentUpgrade||fe,e),this},vr);function vr(){}function tn(e,t){var r=e._dbNamesDB;return r||(r=e._dbNamesDB=new et(lr,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),r.table("dbnames")}function rn(e){return e&&typeof e.databases=="function"}function nn(e){return at(function(){return W.letThrough=!0,e()})}function sn(e){return!("from"in e)}var Pe=function(e,t){if(!this){var r=new Pe;return e&&"d"in e&&M(r,e),r}M(this,arguments.length?{d:1,from:e,to:1<arguments.length?t:e}:{d:0})};function Xt(e,t,r){var n=le(t,r);if(!isNaN(n)){if(0<n)throw RangeError();if(sn(e))return M(e,{from:t,to:r,d:1});var s=e.l,n=e.r;if(le(r,e.from)<0)return s?Xt(s,t,r):e.l={from:t,to:r,d:1,l:null,r:null},Wn(e);if(0<le(t,e.to))return n?Xt(n,t,r):e.r={from:t,to:r,d:1,l:null,r:null},Wn(e);le(t,e.from)<0&&(e.from=t,e.l=null,e.d=n?n.d+1:1),0<le(r,e.to)&&(e.to=r,e.r=null,e.d=e.l?e.l.d+1:1),r=!e.r,s&&!e.l&&Qt(e,s),n&&r&&Qt(e,n)}}function Qt(e,t){sn(t)||function r(n,h){var i=h.from,o=h.to,c=h.l,h=h.r;Xt(n,i,o),c&&r(n,c),h&&r(n,h)}(e,t)}function Hn(e,t){var r=br(t),n=r.next();if(n.done)return!1;for(var s=n.value,i=br(e),o=i.next(s.from),c=o.value;!n.done&&!o.done;){if(le(c.from,s.to)<=0&&0<=le(c.to,s.from))return!0;le(s.from,c.from)<0?s=(n=r.next(c.from)).value:c=(o=i.next(s.from)).value}return!1}function br(e){var t=sn(e)?null:{s:0,n:e};return{next:function(r){for(var n=0<arguments.length;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&le(r,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||le(r,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function Wn(e){var t,r,n=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((r=e.l)===null||r===void 0?void 0:r.d)||0),s=1<n?"r":n<-1?"l":"";s&&(t=s=="r"?"l":"r",r=d({},e),n=e[s],e.from=n.from,e.to=n.to,e[s]=n[s],r[s]=n[t],(e[t]=r).d=Yn(r)),e.d=Yn(e)}function Yn(r){var t=r.r,r=r.l;return(t?r?Math.max(t.d,r.d):t.d:r?r.d:0)+1}function xr(e,t){return C(t).forEach(function(r){e[r]?Qt(e[r],t[r]):e[r]=function n(s){var i,o,c={};for(i in s)X(s,i)&&(o=s[i],c[i]=!o||typeof o!="object"||Oe.has(o.constructor)?o:n(o));return c}(t[r])}),e}function an(e,t){return e.all||t.all||Object.keys(e).some(function(r){return t[r]&&Hn(t[r],e[r])})}Q(Pe.prototype,((ze={add:function(e){return Qt(this,e),this},addKey:function(e){return Xt(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(r){return Xt(t,r,r)}),this},hasKey:function(e){var t=br(this).next(e).value;return t&&le(t.from,e)<=0&&0<=le(t.to,e)}})[G]=function(){return br(this)},ze));var wt={},on={},ln=!1;function wr(e){xr(on,e),ln||(ln=!0,setTimeout(function(){ln=!1,cn(on,!(on={}))},0))}function cn(e,t){t===void 0&&(t=!1);var r=new Set;if(e.all)for(var n=0,s=Object.values(wt);n<s.length;n++)Xn(o=s[n],e,r,t);else for(var i in e){var o,c=/^idb\:\/\/(.*)\/(.*)\//.exec(i);c&&(i=c[1],c=c[2],(o=wt["idb://".concat(i,"/").concat(c)])&&Xn(o,e,r,t))}r.forEach(function(h){return h()})}function Xn(e,t,r,n){for(var s=[],i=0,o=Object.entries(e.queries.query);i<o.length;i++){for(var c=o[i],h=c[0],m=[],v=0,u=c[1];v<u.length;v++){var x=u[v];an(t,x.obsSet)?x.subscribers.forEach(function(y){return r.add(y)}):n&&m.push(x)}n&&s.push([h,m])}if(n)for(var p=0,g=s;p<g.length;p++){var b=g[p],h=b[0],m=b[1];e.queries.query[h]=m}}function Ls(e){var t=e._state,r=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?_e(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var n=t.openCanceller,s=Math.round(10*e.verno),i=!1;function o(){if(t.openCanceller!==n)throw new Y.DatabaseClosed("db.open() was cancelled")}function c(){return new B(function(x,p){if(o(),!r)throw new Y.MissingAPI;var g=e.name,b=t.autoSchema||!s?r.open(g):r.open(g,s);if(!b)throw new Y.MissingAPI;b.onerror=Xe(p),b.onblocked=ve(e._fireOnBlocked),b.onupgradeneeded=ve(function(y){var k;v=b.transaction,t.autoSchema&&!e._options.allowEmptyDB?(b.onerror=Ut,v.abort(),b.result.close(),(k=r.deleteDatabase(g)).onsuccess=k.onerror=ve(function(){p(new Y.NoSuchDatabase("Database ".concat(g," doesnt exist")))})):(v.onerror=Xe(p),y=y.oldVersion>Math.pow(2,62)?0:y.oldVersion,u=y<1,e.idbdb=b.result,i&&Ps(e,v),Os(e,y/10,v,p))},p),b.onsuccess=ve(function(){v=null;var y,k,_,N,S,D=e.idbdb=b.result,T=de(D.objectStoreNames);if(0<T.length)try{var O=D.transaction((N=T).length===1?N[0]:N,"readonly");if(t.autoSchema)k=D,_=O,(y=e).verno=k.version/10,_=y._dbSchema=yr(0,k,_),y._storeNames=de(k.objectStoreNames,0),pr(y,[y._allTables],C(_),_);else if(gr(e,e._dbSchema,O),((S=Jr(yr(0,(S=e).idbdb,O),S._dbSchema)).add.length||S.change.some(function(P){return P.add.length||P.change.length}))&&!i)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),D.close(),s=D.version+1,i=!0,x(c());hr(e,O)}catch{}Dt.push(e),D.onversionchange=ve(function(P){t.vcFired=!0,e.on("versionchange").fire(P)}),D.onclose=ve(function(P){e.on("close").fire(P)}),u&&(S=e._deps,O=g,D=S.indexedDB,S=S.IDBKeyRange,rn(D)||O===lr||tn(D,S).put({name:O}).catch(fe)),x()},p)}).catch(function(x){switch(x?.name){case"UnknownError":if(0<t.PR1398_maxLoop)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),c();break;case"VersionError":if(0<s)return s=0,c()}return B.reject(x)})}var h,m=t.dbReadyResolve,v=null,u=!1;return B.race([n,(typeof navigator>"u"?B.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(x){function p(){return indexedDB.databases().finally(x)}h=setInterval(p,100),p()}).finally(function(){return clearInterval(h)}):Promise.resolve()).then(c)]).then(function(){return o(),t.onReadyBeingFired=[],B.resolve(nn(function(){return e.on.ready.fire(e.vip)})).then(function x(){if(0<t.onReadyBeingFired.length){var p=t.onReadyBeingFired.reduce(Lr,fe);return t.onReadyBeingFired=[],B.resolve(nn(function(){return p(e.vip)})).then(x)}})}).finally(function(){t.openCanceller===n&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(x){t.dbOpenError=x;try{v&&v.abort()}catch{}return n===t.openCanceller&&e._close(),_e(x)}).finally(function(){t.openComplete=!0,m()}).then(function(){var x;return u&&(x={},e.tables.forEach(function(p){p.schema.indexes.forEach(function(g){g.name&&(x["idb://".concat(e.name,"/").concat(p.name,"/").concat(g.name)]=new Pe(-1/0,[[[]]]))}),x["idb://".concat(e.name,"/").concat(p.name,"/")]=x["idb://".concat(e.name,"/").concat(p.name,"/:dels")]=new Pe(-1/0,[[[]]])}),ut(Ht).fire(x),cn(x,!0)),e})}function un(e){function t(i){return e.next(i)}var r=s(t),n=s(function(i){return e.throw(i)});function s(i){return function(h){var c=i(h),h=c.value;return c.done?h:h&&typeof h.then=="function"?h.then(r,n):L(h)?Promise.all(h).then(r,n):r(h)}}return s(t)()}function kr(e,t,r){for(var n=L(e)?e.slice():[e],s=0;s<r;++s)n.push(t);return n}var Ts={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return d(d({},e),{table:function(t){var r=e.table(t),n=r.schema,s={},i=[];function o(u,x,p){var g=Yt(u),b=s[g]=s[g]||[],y=u==null?0:typeof u=="string"?1:u.length,k=0<x,k=d(d({},p),{name:k?"".concat(g,"(virtual-from:").concat(p.name,")"):p.name,lowLevelIndex:p,isVirtual:k,keyTail:x,keyLength:y,extractKey:Gr(u),unique:!k&&p.unique});return b.push(k),k.isPrimaryKey||i.push(k),1<y&&o(y===2?u[0]:u.slice(0,y-1),x+1,p),b.sort(function(_,N){return _.keyTail-N.keyTail}),k}t=o(n.primaryKey.keyPath,0,n.primaryKey),s[":id"]=[t];for(var c=0,h=n.indexes;c<h.length;c++){var m=h[c];o(m.keyPath,0,m)}function v(u){var x,p=u.query.index;return p.isVirtual?d(d({},u),{query:{index:p.lowLevelIndex,range:(x=u.query.range,p=p.keyTail,{type:x.type===1?2:x.type,lower:kr(x.lower,x.lowerOpen?e.MAX_KEY:e.MIN_KEY,p),lowerOpen:!0,upper:kr(x.upper,x.upperOpen?e.MIN_KEY:e.MAX_KEY,p),upperOpen:!0})}}):u}return d(d({},r),{schema:d(d({},n),{primaryKey:t,indexes:i,getIndexByKeyPath:function(u){return(u=s[Yt(u)])&&u[0]}}),count:function(u){return r.count(v(u))},query:function(u){return r.query(v(u))},openCursor:function(u){var x=u.query.index,p=x.keyTail,g=x.isVirtual,b=x.keyLength;return g?r.openCursor(v(u)).then(function(k){return k&&y(k)}):r.openCursor(u);function y(k){return Object.create(k,{continue:{value:function(_){_!=null?k.continue(kr(_,u.reverse?e.MAX_KEY:e.MIN_KEY,p)):u.unique?k.continue(k.key.slice(0,b).concat(u.reverse?e.MIN_KEY:e.MAX_KEY,p)):k.continue()}},continuePrimaryKey:{value:function(_,N){k.continuePrimaryKey(kr(_,e.MAX_KEY,p),N)}},primaryKey:{get:function(){return k.primaryKey}},key:{get:function(){var _=k.key;return b===1?_[0]:_.slice(0,b)}},value:{get:function(){return k.value}}})}}})}})}};function dn(e,t,r,n){return r=r||{},n=n||"",C(e).forEach(function(s){var i,o,c;X(t,s)?(i=e[s],o=t[s],typeof i=="object"&&typeof o=="object"&&i&&o?(c=V(i))!==V(o)?r[n+s]=t[s]:c==="Object"?dn(i,o,r,n+s+"."):i!==o&&(r[n+s]=t[s]):i!==o&&(r[n+s]=t[s])):r[n+s]=void 0}),C(t).forEach(function(s){X(e,s)||(r[n+s]=t[s])}),r}function fn(e,t){return t.type==="delete"?t.keys:t.keys||t.values.map(e.extractKey)}var Is={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return d(d({},e),{table:function(t){var r=e.table(t),n=r.schema.primaryKey;return d(d({},r),{mutate:function(s){var i=W.trans,o=i.table(t).hook,c=o.deleting,h=o.creating,m=o.updating;switch(s.type){case"add":if(h.fire===fe)break;return i._promise("readwrite",function(){return v(s)},!0);case"put":if(h.fire===fe&&m.fire===fe)break;return i._promise("readwrite",function(){return v(s)},!0);case"delete":if(c.fire===fe)break;return i._promise("readwrite",function(){return v(s)},!0);case"deleteRange":if(c.fire===fe)break;return i._promise("readwrite",function(){return function u(x,p,g){return r.query({trans:x,values:!1,query:{index:n,range:p},limit:g}).then(function(b){var y=b.result;return v({type:"delete",keys:y,trans:x}).then(function(k){return 0<k.numFailures?Promise.reject(k.failures[0]):y.length<g?{failures:[],numFailures:0,lastResult:void 0}:u(x,d(d({},p),{lower:y[y.length-1],lowerOpen:!0}),g)})})}(s.trans,s.range,1e4)},!0)}return r.mutate(s);function v(u){var x,p,g,b=W.trans,y=u.keys||fn(n,u);if(!y)throw new Error("Keys missing");return(u=u.type==="add"||u.type==="put"?d(d({},u),{keys:y}):d({},u)).type!=="delete"&&(u.values=j([],u.values)),u.keys&&(u.keys=j([],u.keys)),x=r,g=y,((p=u).type==="add"?Promise.resolve([]):x.getMany({trans:p.trans,keys:g,cache:"immutable"})).then(function(k){var _=y.map(function(N,S){var D,T,O,P=k[S],K={onerror:null,onsuccess:null};return u.type==="delete"?c.fire.call(K,N,P,b):u.type==="add"||P===void 0?(D=h.fire.call(K,N,u.values[S],b),N==null&&D!=null&&(u.keys[S]=N=D,n.outbound||U(u.values[S],n.keyPath,N))):(D=dn(P,u.values[S]),(T=m.fire.call(K,D,N,P,b))&&(O=u.values[S],Object.keys(T).forEach(function(A){X(O,A)?O[A]=T[A]:U(O,A,T[A])}))),K});return r.mutate(u).then(function(N){for(var S=N.failures,D=N.results,T=N.numFailures,N=N.lastResult,O=0;O<y.length;++O){var P=(D||y)[O],K=_[O];P==null?K.onerror&&K.onerror(S[O]):K.onsuccess&&K.onsuccess(u.type==="put"&&k[O]?u.values[O]:P)}return{failures:S,results:D,numFailures:T,lastResult:N}}).catch(function(N){return _.forEach(function(S){return S.onerror&&S.onerror(N)}),Promise.reject(N)})})}}})}})}};function Qn(e,t,r){try{if(!t||t.keys.length<e.length)return null;for(var n=[],s=0,i=0;s<t.keys.length&&i<e.length;++s)le(t.keys[s],e[i])===0&&(n.push(r?$(t.values[s]):t.values[s]),++i);return n.length===e.length?n:null}catch{return null}}var Ks={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var r=e.table(t);return d(d({},r),{getMany:function(n){if(!n.cache)return r.getMany(n);var s=Qn(n.keys,n.trans._cache,n.cache==="clone");return s?B.resolve(s):r.getMany(n).then(function(i){return n.trans._cache={keys:n.keys,values:n.cache==="clone"?$(i):i},i})},mutate:function(n){return n.type!=="add"&&(n.trans._cache=null),r.mutate(n)}})}}}};function Gn(e,t){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!t.schema.primaryKey.outbound}function Zn(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Ms={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,r=new Pe(e.MIN_KEY,e.MAX_KEY);return d(d({},e),{transaction:function(n,s,i){if(W.subscr&&s!=="readonly")throw new Y.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(W.querier));return e.transaction(n,s,i)},table:function(n){var s=e.table(n),i=s.schema,o=i.primaryKey,u=i.indexes,c=o.extractKey,h=o.outbound,m=o.autoIncrement&&u.filter(function(p){return p.compound&&p.keyPath.includes(o.keyPath)}),v=d(d({},s),{mutate:function(p){function g(A){return A="idb://".concat(t,"/").concat(n,"/").concat(A),N[A]||(N[A]=new Pe)}var b,y,k,_=p.trans,N=p.mutatedParts||(p.mutatedParts={}),S=g(""),D=g(":dels"),T=p.type,K=p.type==="deleteRange"?[p.range]:p.type==="delete"?[p.keys]:p.values.length<50?[fn(o,p).filter(function(A){return A}),p.values]:[],O=K[0],P=K[1],K=p.trans._cache;return L(O)?(S.addKeys(O),(K=T==="delete"||O.length===P.length?Qn(O,K):null)||D.addKeys(O),(K||P)&&(b=g,y=K,k=P,i.indexes.forEach(function(A){var q=b(A.name||"");function ee(ne){return ne!=null?A.extractKey(ne):null}function re(ne){return A.multiEntry&&L(ne)?ne.forEach(function(qe){return q.addKey(qe)}):q.addKey(ne)}(y||k).forEach(function(ne,Ae){var J=y&&ee(y[Ae]),Ae=k&&ee(k[Ae]);le(J,Ae)!==0&&(J!=null&&re(J),Ae!=null&&re(Ae))})}))):O?(P={from:(P=O.lower)!==null&&P!==void 0?P:e.MIN_KEY,to:(P=O.upper)!==null&&P!==void 0?P:e.MAX_KEY},D.add(P),S.add(P)):(S.add(r),D.add(r),i.indexes.forEach(function(A){return g(A.name).add(r)})),s.mutate(p).then(function(A){return!O||p.type!=="add"&&p.type!=="put"||(S.addKeys(A.results),m&&m.forEach(function(q){for(var ee=p.values.map(function(J){return q.extractKey(J)}),re=q.keyPath.findIndex(function(J){return J===o.keyPath}),ne=0,qe=A.results.length;ne<qe;++ne)ee[ne][re]=A.results[ne];g(q.name).addKeys(ee)})),_.mutatedParts=xr(_.mutatedParts||{},N),A})}}),u=function(g){var b=g.query,g=b.index,b=b.range;return[g,new Pe((g=b.lower)!==null&&g!==void 0?g:e.MIN_KEY,(b=b.upper)!==null&&b!==void 0?b:e.MAX_KEY)]},x={get:function(p){return[o,new Pe(p.key)]},getMany:function(p){return[o,new Pe().addKeys(p.keys)]},count:u,query:u,openCursor:u};return C(x).forEach(function(p){v[p]=function(g){var b=W.subscr,y=!!b,k=Gn(W,s)&&Zn(p,g)?g.obsSet={}:b;if(y){var _=function(P){return P="idb://".concat(t,"/").concat(n,"/").concat(P),k[P]||(k[P]=new Pe)},N=_(""),S=_(":dels"),b=x[p](g),y=b[0],b=b[1];if((p==="query"&&y.isPrimaryKey&&!g.values?S:_(y.name||"")).add(b),!y.isPrimaryKey){if(p!=="count"){var D=p==="query"&&h&&g.values&&s.query(d(d({},g),{values:!1}));return s[p].apply(this,arguments).then(function(P){if(p==="query"){if(h&&g.values)return D.then(function(ee){return ee=ee.result,N.addKeys(ee),P});var K=g.values?P.result.map(c):P.result;(g.values?N:S).addKeys(K)}else if(p==="openCursor"){var A=P,q=g.values;return A&&Object.create(A,{key:{get:function(){return S.addKey(A.primaryKey),A.key}},primaryKey:{get:function(){var ee=A.primaryKey;return S.addKey(ee),ee}},value:{get:function(){return q&&N.addKey(A.primaryKey),A.value}}})}return P})}S.add(r)}}return s[p].apply(this,arguments)}}),v}})}};function Jn(e,t,r){if(r.numFailures===0)return t;if(t.type==="deleteRange")return null;var n=t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1;return r.numFailures===n?null:(t=d({},t),L(t.keys)&&(t.keys=t.keys.filter(function(s,i){return!(i in r.failures)})),"values"in t&&L(t.values)&&(t.values=t.values.filter(function(s,i){return!(i in r.failures)})),t)}function hn(e,t){return r=e,((n=t).lower===void 0||(n.lowerOpen?0<le(r,n.lower):0<=le(r,n.lower)))&&(e=e,(t=t).upper===void 0||(t.upperOpen?le(e,t.upper)<0:le(e,t.upper)<=0));var r,n}function es(e,t,x,n,s,i){if(!x||x.length===0)return e;var o=t.query.index,c=o.multiEntry,h=t.query.range,m=n.schema.primaryKey.extractKey,v=o.extractKey,u=(o.lowLevelIndex||o).extractKey,x=x.reduce(function(p,g){var b=p,y=[];if(g.type==="add"||g.type==="put")for(var k=new Pe,_=g.values.length-1;0<=_;--_){var N,S=g.values[_],D=m(S);k.hasKey(D)||(N=v(S),(c&&L(N)?N.some(function(A){return hn(A,h)}):hn(N,h))&&(k.addKey(D),y.push(S)))}switch(g.type){case"add":var T=new Pe().addKeys(t.values?p.map(function(q){return m(q)}):p),b=p.concat(t.values?y.filter(function(q){return q=m(q),!T.hasKey(q)&&(T.addKey(q),!0)}):y.map(function(q){return m(q)}).filter(function(q){return!T.hasKey(q)&&(T.addKey(q),!0)}));break;case"put":var O=new Pe().addKeys(g.values.map(function(q){return m(q)}));b=p.filter(function(q){return!O.hasKey(t.values?m(q):q)}).concat(t.values?y:y.map(function(q){return m(q)}));break;case"delete":var P=new Pe().addKeys(g.keys);b=p.filter(function(q){return!P.hasKey(t.values?m(q):q)});break;case"deleteRange":var K=g.range;b=p.filter(function(q){return!hn(m(q),K)})}return b},e);return x===e?e:(x.sort(function(p,g){return le(u(p),u(g))||le(m(p),m(g))}),t.limit&&t.limit<1/0&&(x.length>t.limit?x.length=t.limit:e.length===t.limit&&x.length<t.limit&&(s.dirty=!0)),i?Object.freeze(x):x)}function ts(e,t){return le(e.lower,t.lower)===0&&le(e.upper,t.upper)===0&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function Rs(e,t){return function(r,n,s,i){if(r===void 0)return n!==void 0?-1:0;if(n===void 0)return 1;if((n=le(r,n))===0){if(s&&i)return 0;if(s)return 1;if(i)return-1}return n}(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&0<=function(r,n,s,i){if(r===void 0)return n!==void 0?1:0;if(n===void 0)return-1;if((n=le(r,n))===0){if(s&&i)return 0;if(s)return-1;if(i)return 1}return n}(e.upper,t.upper,e.upperOpen,t.upperOpen)}function Bs(e,t,r,n){e.subscribers.add(r),n.addEventListener("abort",function(){var s,i;e.subscribers.delete(r),e.subscribers.size===0&&(s=e,i=t,setTimeout(function(){s.subscribers.size===0&&Ke(i,s)},3e3))})}var Vs={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name;return d(d({},e),{transaction:function(r,n,s){var i,o,c=e.transaction(r,n,s);return n==="readwrite"&&(o=(i=new AbortController).signal,s=function(h){return function(){if(i.abort(),n==="readwrite"){for(var m=new Set,v=0,u=r;v<u.length;v++){var x=u[v],p=wt["idb://".concat(t,"/").concat(x)];if(p){var g=e.table(x),b=p.optimisticOps.filter(function(q){return q.trans===c});if(c._explicit&&h&&c.mutatedParts)for(var y=0,k=Object.values(p.queries.query);y<k.length;y++)for(var _=0,N=(T=k[y]).slice();_<N.length;_++)an((O=N[_]).obsSet,c.mutatedParts)&&(Ke(T,O),O.subscribers.forEach(function(q){return m.add(q)}));else if(0<b.length){p.optimisticOps=p.optimisticOps.filter(function(q){return q.trans!==c});for(var S=0,D=Object.values(p.queries.query);S<D.length;S++)for(var T,O,P,K=0,A=(T=D[S]).slice();K<A.length;K++)(O=A[K]).res!=null&&c.mutatedParts&&(h&&!O.dirty?(P=Object.isFrozen(O.res),P=es(O.res,O.req,b,g,O,P),O.dirty?(Ke(T,O),O.subscribers.forEach(function(q){return m.add(q)})):P!==O.res&&(O.res=P,O.promise=B.resolve({result:P}))):(O.dirty&&Ke(T,O),O.subscribers.forEach(function(q){return m.add(q)})))}}}m.forEach(function(q){return q()})}}},c.addEventListener("abort",s(!1),{signal:o}),c.addEventListener("error",s(!1),{signal:o}),c.addEventListener("complete",s(!0),{signal:o})),c},table:function(r){var n=e.table(r),s=n.schema.primaryKey;return d(d({},n),{mutate:function(i){var o=W.trans;if(s.outbound||o.db._options.cache==="disabled"||o.explicit||o.idbtrans.mode!=="readwrite")return n.mutate(i);var c=wt["idb://".concat(t,"/").concat(r)];return c?(o=n.mutate(i),i.type!=="add"&&i.type!=="put"||!(50<=i.values.length||fn(s,i).some(function(h){return h==null}))?(c.optimisticOps.push(i),i.mutatedParts&&wr(i.mutatedParts),o.then(function(h){0<h.numFailures&&(Ke(c.optimisticOps,i),(h=Jn(0,i,h))&&c.optimisticOps.push(h),i.mutatedParts&&wr(i.mutatedParts))}),o.catch(function(){Ke(c.optimisticOps,i),i.mutatedParts&&wr(i.mutatedParts)})):o.then(function(h){var m=Jn(0,d(d({},i),{values:i.values.map(function(v,u){var x;return h.failures[u]?v:(v=(x=s.keyPath)!==null&&x!==void 0&&x.includes(".")?$(v):d({},v),U(v,s.keyPath,h.results[u]),v)})}),h);c.optimisticOps.push(m),queueMicrotask(function(){return i.mutatedParts&&wr(i.mutatedParts)})}),o):n.mutate(i)},query:function(i){if(!Gn(W,n)||!Zn("query",i))return n.query(i);var o=((m=W.trans)===null||m===void 0?void 0:m.db._options.cache)==="immutable",u=W,c=u.requery,h=u.signal,m=function(g,b,y,k){var _=wt["idb://".concat(g,"/").concat(b)];if(!_)return[];if(!(b=_.queries[y]))return[null,!1,_,null];var N=b[(k.query?k.query.index.name:null)||""];if(!N)return[null,!1,_,null];switch(y){case"query":var S=N.find(function(D){return D.req.limit===k.limit&&D.req.values===k.values&&ts(D.req.query.range,k.query.range)});return S?[S,!0,_,N]:[N.find(function(D){return("limit"in D.req?D.req.limit:1/0)>=k.limit&&(!k.values||D.req.values)&&Rs(D.req.query.range,k.query.range)}),!1,_,N];case"count":return S=N.find(function(D){return ts(D.req.query.range,k.query.range)}),[S,!!S,_,N]}}(t,r,"query",i),v=m[0],u=m[1],x=m[2],p=m[3];return v&&u?v.obsSet=i.obsSet:(u=n.query(i).then(function(g){var b=g.result;if(v&&(v.res=b),o){for(var y=0,k=b.length;y<k;++y)Object.freeze(b[y]);Object.freeze(b)}else g.result=$(b);return g}).catch(function(g){return p&&v&&Ke(p,v),Promise.reject(g)}),v={obsSet:i.obsSet,promise:u,subscribers:new Set,type:"query",req:i,dirty:!1},p?p.push(v):(p=[v],(x=x||(wt["idb://".concat(t,"/").concat(r)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[i.query.index.name||""]=p)),Bs(v,p,c,h),v.promise.then(function(g){return{result:es(g.result,i,x?.optimisticOps,n,v,o)}})}})}})}};function jr(e,t){return new Proxy(e,{get:function(r,n,s){return n==="db"?t:Reflect.get(r,n,s)}})}var et=(Ne.prototype.version=function(e){if(isNaN(e)||e<.1)throw new Y.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new Y.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,r=t.filter(function(n){return n._cfg.version===e})[0];return r||(r=new this.Version(e),t.push(r),t.sort(Ds),r.stores({}),this._state.autoSchema=!1,r)},Ne.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||W.letThrough||this._vip)?e():new B(function(r,n){if(t._state.openComplete)return n(new Y.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void n(new Y.DatabaseClosed);t.open().catch(fe)}t._state.dbReadyPromise.then(r,n)}).then(e)},Ne.prototype.use=function(e){var t=e.stack,r=e.create,n=e.level,s=e.name;return s&&this.unuse({stack:t,name:s}),e=this._middlewares[t]||(this._middlewares[t]=[]),e.push({stack:t,create:r,level:n??10,name:s}),e.sort(function(i,o){return i.level-o.level}),this},Ne.prototype.unuse=function(e){var t=e.stack,r=e.name,n=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(s){return n?s.create!==n:!!r&&s.name!==r})),this},Ne.prototype.open=function(){var e=this;return vt(it,function(){return Ls(e)})},Ne.prototype._close=function(){var e=this._state,t=Dt.indexOf(this);if(0<=t&&Dt.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new B(function(r){e.dbReadyResolve=r}),e.openCanceller=new B(function(r,n){e.cancelOpen=n}))},Ne.prototype.close=function(r){var t=(r===void 0?{disableAutoOpen:!0}:r).disableAutoOpen,r=this._state;t?(r.isBeingOpened&&r.cancelOpen(new Y.DatabaseClosed),this._close(),r.autoOpen=!1,r.dbOpenError=new Y.DatabaseClosed):(this._close(),r.autoOpen=this._options.autoOpen||r.isBeingOpened,r.openComplete=!1,r.dbOpenError=null)},Ne.prototype.delete=function(e){var t=this;e===void 0&&(e={disableAutoOpen:!0});var r=0<arguments.length&&typeof arguments[0]!="object",n=this._state;return new B(function(s,i){function o(){t.close(e);var c=t._deps.indexedDB.deleteDatabase(t.name);c.onsuccess=ve(function(){var h,m,v;h=t._deps,m=t.name,v=h.indexedDB,h=h.IDBKeyRange,rn(v)||m===lr||tn(v,h).delete(m).catch(fe),s()}),c.onerror=Xe(i),c.onblocked=t._fireOnBlocked}if(r)throw new Y.InvalidArgument("Invalid closeOptions argument to db.delete()");n.isBeingOpened?n.dbReadyPromise.then(o):o()})},Ne.prototype.backendDB=function(){return this.idbdb},Ne.prototype.isOpen=function(){return this.idbdb!==null},Ne.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},Ne.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Ne.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Ne.prototype,"tables",{get:function(){var e=this;return C(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),Ne.prototype.transaction=function(){var e=function(t,r,n){var s=arguments.length;if(s<2)throw new Y.InvalidArgument("Too few arguments");for(var i=new Array(s-1);--s;)i[s-1]=arguments[s];return n=i.pop(),[t,ke(i),n]}.apply(this,arguments);return this._transaction.apply(this,e)},Ne.prototype._transaction=function(e,t,r){var n=this,s=W.trans;s&&s.db===this&&e.indexOf("!")===-1||(s=null);var i,o,c=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");try{if(o=t.map(function(m){if(m=m instanceof n.Table?m.name:m,typeof m!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return m}),e=="r"||e===$r)i=$r;else{if(e!="rw"&&e!=zr)throw new Y.InvalidArgument("Invalid transaction mode: "+e);i=zr}if(s){if(s.mode===$r&&i===zr){if(!c)throw new Y.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");s=null}s&&o.forEach(function(m){if(s&&s.storeNames.indexOf(m)===-1){if(!c)throw new Y.SubTransaction("Table "+m+" not included in parent transaction.");s=null}}),c&&s&&!s.active&&(s=null)}}catch(m){return s?s._promise(null,function(v,u){u(m)}):_e(m)}var h=function m(v,u,x,p,g){return B.resolve().then(function(){var b=W.transless||W,y=v._createTransaction(u,x,v._dbSchema,p);if(y.explicit=!0,b={trans:y,transless:b},p)y.idbtrans=p.idbtrans;else try{y.create(),y.idbtrans._explicit=!0,v._state.PR1398_maxLoop=3}catch(N){return N.name===Ar.InvalidState&&v.isOpen()&&0<--v._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),v.close({disableAutoOpen:!1}),v.open().then(function(){return m(v,u,x,null,g)})):_e(N)}var k,_=Pr(g);return _&&Ft(),b=B.follow(function(){var N;(k=g.call(y,y))&&(_?(N=ot.bind(null,null),k.then(N,N)):typeof k.next=="function"&&typeof k.throw=="function"&&(k=un(k)))},b),(k&&typeof k.then=="function"?B.resolve(k).then(function(N){return y.active?N:_e(new Y.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):b.then(function(){return k})).then(function(N){return p&&y._resolve(),y._completion.then(function(){return N})}).catch(function(N){return y._reject(N),_e(N)})})}.bind(null,this,i,o,s,r);return s?s._promise(i,h,"lock"):W.trans?vt(W.transless,function(){return n._whenReady(h)}):this._whenReady(h)},Ne.prototype.table=function(e){if(!X(this._allTables,e))throw new Y.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},Ne);function Ne(e,t){var r=this;this._middlewares={},this.verno=0;var n=Ne.dependencies;this._options=t=d({addons:Ne.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,cache:"cloned"},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange},n=t.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var s,i,o,c,h,m={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:fe,dbReadyPromise:null,cancelOpen:fe,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:t.autoOpen};m.dbReadyPromise=new B(function(u){m.dbReadyResolve=u}),m.openCanceller=new B(function(u,x){m.cancelOpen=x}),this._state=m,this.name=e,this.on=qt(this,"populate","blocked","versionchange","close",{ready:[Lr,fe]}),this.on.ready.subscribe=ye(this.on.ready.subscribe,function(u){return function(x,p){Ne.vip(function(){var g,b=r._state;b.openComplete?(b.dbOpenError||B.resolve().then(x),p&&u(x)):b.onReadyBeingFired?(b.onReadyBeingFired.push(x),p&&u(x)):(u(x),g=r,p||u(function y(){g.on.ready.unsubscribe(x),g.on.ready.unsubscribe(y)}))})}}),this.Collection=(s=this,$t(js.prototype,function(k,y){this.db=s;var p=Pn,g=null;if(y)try{p=y()}catch(_){g=_}var b=k._ctx,y=b.table,k=y.hook.reading.fire;this._ctx={table:y,index:b.index,isPrimKey:!b.index||y.schema.primKey.keyPath&&b.index===y.schema.primKey.name,range:p,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:g,or:b.or,valueMapper:k!==Kt?k:null}})),this.Table=(i=this,$t(In.prototype,function(u,x,p){this.db=i,this._tx=p,this.name=u,this.schema=x,this.hook=i._allTables[u]?i._allTables[u].hook:qt(null,{creating:[ps,fe],reading:[hs,Kt],updating:[ys,fe],deleting:[ms,fe]})})),this.Transaction=(o=this,$t(Cs.prototype,function(u,x,p,g,b){var y=this;this.db=o,this.mode=u,this.storeNames=x,this.schema=p,this.chromeTransactionDurability=g,this.idbtrans=null,this.on=qt(this,"complete","error","abort"),this.parent=b||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new B(function(k,_){y._resolve=k,y._reject=_}),this._completion.then(function(){y.active=!1,y.on.complete.fire()},function(k){var _=y.active;return y.active=!1,y.on.error.fire(k),y.parent?y.parent._reject(k):_&&y.idbtrans&&y.idbtrans.abort(),_e(k)})})),this.Version=(c=this,$t(As.prototype,function(u){this.db=c,this._cfg={version:u,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(h=this,$t(Vn.prototype,function(u,x,p){if(this.db=h,this._ctx={table:u,index:x===":id"?null:x,or:p},this._cmp=this._ascending=le,this._descending=function(g,b){return le(b,g)},this._max=function(g,b){return 0<le(g,b)?g:b},this._min=function(g,b){return le(g,b)<0?g:b},this._IDBKeyRange=h._deps.IDBKeyRange,!this._IDBKeyRange)throw new Y.MissingAPI})),this.on("versionchange",function(u){0<u.newVersion?console.warn("Another connection wants to upgrade database '".concat(r.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(r.name,"'. Closing db now to resume the delete request.")),r.close({disableAutoOpen:!1})}),this.on("blocked",function(u){!u.newVersion||u.newVersion<u.oldVersion?console.warn("Dexie.delete('".concat(r.name,"') was blocked")):console.warn("Upgrade '".concat(r.name,"' blocked by other connection holding version ").concat(u.oldVersion/10))}),this._maxKey=Wt(t.IDBKeyRange),this._createTransaction=function(u,x,p,g){return new r.Transaction(u,x,p,r._options.chromeTransactionDurability,g)},this._fireOnBlocked=function(u){r.on("blocked").fire(u),Dt.filter(function(x){return x.name===r.name&&x!==r&&!x._state.vcFired}).map(function(x){return x.on("versionchange").fire(u)})},this.use(Ks),this.use(Vs),this.use(Ms),this.use(Ts),this.use(Is);var v=new Proxy(this,{get:function(u,x,p){if(x==="_vip")return!0;if(x==="table")return function(b){return jr(r.table(b),v)};var g=Reflect.get(u,x,p);return g instanceof In?jr(g,v):x==="tables"?g.map(function(b){return jr(b,v)}):x==="_createTransaction"?function(){return jr(g.apply(this,arguments),v)}:g}});this.vip=v,n.forEach(function(u){return u(r)})}var _r,ze=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",qs=(pn.prototype.subscribe=function(e,t,r){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:t,complete:r})},pn.prototype[ze]=function(){return this},pn);function pn(e){this._subscribe=e}try{_r={indexedDB:E.indexedDB||E.mozIndexedDB||E.webkitIndexedDB||E.msIndexedDB,IDBKeyRange:E.IDBKeyRange||E.webkitIDBKeyRange}}catch{_r={indexedDB:null,IDBKeyRange:null}}function rs(e){var t,r=!1,n=new qs(function(s){var i=Pr(e),o,c=!1,h={},m={},v={get closed(){return c},unsubscribe:function(){c||(c=!0,o&&o.abort(),u&&ut.storagemutated.unsubscribe(p))}};s.start&&s.start(v);var u=!1,x=function(){return qr(g)},p=function(b){xr(h,b),an(m,h)&&x()},g=function(){var b,y,k;!c&&_r.indexedDB&&(h={},b={},o&&o.abort(),o=new AbortController,k=function(_){var N=St();try{i&&Ft();var S=at(e,_);return S=i?S.finally(ot):S}finally{N&&Et()}}(y={subscr:b,signal:o.signal,requery:x,querier:e,trans:null}),Promise.resolve(k).then(function(_){r=!0,t=_,c||y.signal.aborted||(h={},function(N){for(var S in N)if(X(N,S))return;return 1}(m=b)||u||(ut(Ht,p),u=!0),qr(function(){return!c&&s.next&&s.next(_)}))},function(_){r=!1,["DatabaseClosedError","AbortError"].includes(_?.name)||c||qr(function(){c||s.error&&s.error(_)})}))};return setTimeout(x,0),v});return n.hasValue=function(){return r},n.getValue=function(){return t},n}var kt=et;function mn(e){var t=dt;try{dt=!0,ut.storagemutated.fire(e),cn(e,!0)}finally{dt=t}}Q(kt,d(d({},Jt),{delete:function(e){return new kt(e,{addons:[]}).delete()},exists:function(e){return new kt(e,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return t=kt.dependencies,r=t.indexedDB,t=t.IDBKeyRange,(rn(r)?Promise.resolve(r.databases()).then(function(n){return n.map(function(s){return s.name}).filter(function(s){return s!==lr})}):tn(r,t).toCollection().primaryKeys()).then(e)}catch{return _e(new Y.MissingAPI)}var t,r},defineClass:function(){return function(e){M(this,e)}},ignoreTransaction:function(e){return W.trans?vt(W.transless,e):e()},vip:nn,async:function(e){return function(){try{var t=un(e.apply(this,arguments));return t&&typeof t.then=="function"?t:B.resolve(t)}catch(r){return _e(r)}}},spawn:function(e,t,r){try{var n=un(e.apply(r,t||[]));return n&&typeof n.then=="function"?n:B.resolve(n)}catch(s){return _e(s)}},currentTransaction:{get:function(){return W.trans||null}},waitFor:function(e,t){return t=B.resolve(typeof e=="function"?kt.ignoreTransaction(e):e).timeout(t||6e4),W.trans?W.trans.waitFor(t):t},Promise:B,debug:{get:function(){return Ye},set:function(e){Nn(e)}},derive:ie,extend:M,props:Q,override:ye,Events:qt,on:ut,liveQuery:rs,extendObservabilitySet:xr,getByKeyPath:oe,setByKeyPath:U,delByKeyPath:function(e,t){typeof t=="string"?U(e,t,void 0):"length"in t&&[].map.call(t,function(r){U(e,r,void 0)})},shallowClone:te,deepClone:$,getObjectDiff:dn,cmp:le,asap:pe,minKey:-1/0,addons:[],connections:Dt,errnames:Ar,dependencies:_r,cache:wt,semVer:"4.0.11",version:"4.0.11".split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,r){return e+t/Math.pow(10,2*r)})})),kt.maxKey=Wt(kt.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(ut(Ht,function(e){dt||(e=new CustomEvent(Yr,{detail:e}),dt=!0,dispatchEvent(e),dt=!1)}),addEventListener(Yr,function(e){e=e.detail,dt||mn(e)}));var At,dt=!1,ns=function(){};return typeof BroadcastChannel<"u"&&((ns=function(){(At=new BroadcastChannel(Yr)).onmessage=function(e){return e.data&&mn(e.data)}})(),typeof At.unref=="function"&&At.unref(),ut(Ht,function(e){dt||At.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!et.disableBfCache&&e.persisted){Ye&&console.debug("Dexie: handling persisted pagehide"),At?.close();for(var t=0,r=Dt;t<r.length;t++)r[t].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!et.disableBfCache&&e.persisted&&(Ye&&console.debug("Dexie: handling persisted pageshow"),ns(),mn({all:new Pe(-1/0,[[]])}))})),B.rejectionMapper=function(e,t){return!e||e instanceof Nt||e instanceof TypeError||e instanceof SyntaxError||!e.name||!_n[e.name]?e:(t=new _n[e.name](t||e.message,e),"stack"in e&&Z(t,"stack",{get:function(){return this.inner.stack}}),t)},Nn(Ye),d(et,Object.freeze({__proto__:null,Dexie:et,liveQuery:rs,Entity:An,cmp:le,PropModification:zt,replacePrefix:function(e,t){return new zt({replacePrefix:[e,t]})},add:function(e){return new zt({add:e})},remove:function(e){return new zt({remove:e})},default:et,RangeSet:Pe,mergeRanges:Qt,rangesOverlap:Hn}),{default:et}),et})}(Fr)),Fr.exports}var Zs=Gs();const wn=zs(Zs),as=Symbol.for("Dexie"),Or=globalThis[as]||(globalThis[as]=wn);if(wn.semVer!==Or.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${wn.semVer} and ${Or.semVer}`);const{liveQuery:ji,mergeRanges:_i,rangesOverlap:Ni,RangeSet:Ci,cmp:Si,Entity:Ei,PropModification:Fi,replacePrefix:Di,add:Oi,remove:Pi}=Or,Js=typeof indexedDB<"u";class Er{data=[];autoIncrement=1;async clear(){this.data=[]}async bulkAdd(l){for(const f of l)await this.put(f)}async put(l){if(typeof l.id>"u"||l.id===null){l.id=this.autoIncrement++,this.data.push(l);return}const f=this.data.findIndex(d=>d.id===l.id);f===-1?this.data.push(l):this.data[f]=l}async get(l){return this.data.find(f=>f.id===l)}createQuery(l){let f=0,d=null;return{offset(E){return f=E,this},limit(E){return d=E,this},toArray:async()=>{const E=[...this.data].sort((M,z)=>{const H=M[l],X=z[l];return typeof H=="number"&&typeof X=="number"?H-X:String(H??"").localeCompare(String(X??""))}),C=Math.max(0,f),L=d!=null?C+d:void 0;return E.slice(C,L)}}}orderBy(l){return this.createQuery(l)}where(l){return{anyOf:f=>({toArray:async()=>this.data.filter(d=>f.includes(d[l]))})}}async count(){return this.data.length}}class ei{files=new Er;lines=new Er;csvLines=new Er;originalLines=new Er;async transaction(l,f,d){await d()}}class ti extends Or{files;lines;csvLines;originalLines;constructor(){super("LineFilterDB"),this.version(1).stores({files:"id, name, type, uploadedAt",lines:"++id, lineNumber",csvLines:"++id, lineNumber"}),this.version(2).stores({files:"id, name, type, uploadedAt",lines:"++id, lineNumber",csvLines:"++id, lineNumber",originalLines:"++id, fileId"})}}function ri(){return Js?new ti:new ei}class ni{db;constructor(){this.db=ri()}async storeTextLines(l,f){try{const d=f.map((j,E)=>({content:j,lineNumber:E+1}));await this.db.transaction("rw",this.db.lines,async()=>{await this.db.lines.clear(),await this.db.lines.bulkAdd(d)})}catch(d){throw new Error(`Failed to store text lines: ${d instanceof Error?d.message:"Unknown error"}`)}}async storeCSVLines(l,f,d){try{const j=f.map((E,C)=>({lineNumber:C+1,data:E,originalContent:E.join(",")}));await this.db.transaction("rw",this.db.csvLines,async()=>{await this.db.csvLines.clear(),await this.db.csvLines.bulkAdd(j)})}catch(j){throw new Error(`Failed to store CSV lines: ${j instanceof Error?j.message:"Unknown error"}`)}}async storeFileData(l){try{await this.db.files.put(l)}catch(f){throw new Error(`Failed to store file data: ${f instanceof Error?f.message:"Unknown error"}`)}}async getFileData(l){try{return await this.db.files.get(l)}catch(f){throw new Error(`Failed to get file data: ${f instanceof Error?f.message:"Unknown error"}`)}}async getTextLines(l,f){try{let d=this.db.lines.orderBy("lineNumber");return f&&(d=d.offset(f)),l&&(d=d.limit(l)),await d.toArray()}catch(d){throw new Error(`Failed to get text lines: ${d instanceof Error?d.message:"Unknown error"}`)}}async getCSVLines(l,f){try{let d=this.db.csvLines.orderBy("lineNumber");return f&&(d=d.offset(f)),l&&(d=d.limit(l)),await d.toArray()}catch(d){throw new Error(`Failed to get CSV lines: ${d instanceof Error?d.message:"Unknown error"}`)}}async getLinesByNumbers(l,f){try{return f==="text"?await this.db.lines.where("lineNumber").anyOf(l).toArray():await this.db.csvLines.where("lineNumber").anyOf(l).toArray()}catch(d){throw new Error(`Failed to get lines by numbers: ${d instanceof Error?d.message:"Unknown error"}`)}}async getLineCount(){try{const[l,f]=await Promise.all([this.db.lines.count(),this.db.csvLines.count()]);return{text:l,csv:f}}catch(l){throw new Error(`Failed to get line count: ${l instanceof Error?l.message:"Unknown error"}`)}}async clearData(){try{await this.db.transaction("rw",[this.db.files,this.db.lines,this.db.csvLines,this.db.originalLines],async()=>{await Promise.all([this.db.files.clear(),this.db.lines.clear(),this.db.csvLines.clear(),this.db.originalLines.clear()])})}catch(l){throw new Error(`Failed to clear data: ${l instanceof Error?l.message:"Unknown error"}`)}}async getAllTextLinesForFiltering(){try{return await this.db.lines.orderBy("lineNumber").toArray()}catch(l){throw new Error(`Failed to get all text lines: ${l instanceof Error?l.message:"Unknown error"}`)}}async getAllCSVLinesForFiltering(){try{return await this.db.csvLines.orderBy("lineNumber").toArray()}catch(l){throw new Error(`Failed to get all CSV lines: ${l instanceof Error?l.message:"Unknown error"}`)}}async hasData(l){try{if(!await this.db.files.get(l))return!1;const d=await this.getLineCount();return d.text>0||d.csv>0}catch(f){return console.warn("Failed to check if data exists:",f),!1}}async storeOriginalLines(l,f){try{await this.db.originalLines.clear(),await this.db.originalLines.add({fileId:l,lines:f})}catch(d){throw new Error(`Failed to store original lines: ${d instanceof Error?d.message:"Unknown error"}`)}}async getOriginalLines(l){try{return(await this.db.originalLines.where("fileId").equals(l).first())?.lines||[]}catch(f){return console.warn("Failed to get original lines:",f),[]}}async clearCSVData(){try{await this.db.csvLines.clear()}catch(l){throw new Error(`Failed to clear CSV data: ${l instanceof Error?l.message:"Unknown error"}`)}}async deleteDatabase(){try{await this.db.delete()}catch(l){throw new Error(`Failed to delete database: ${l instanceof Error?l.message:"Unknown error"}`)}}}const be=new ni;class $e{static MAX_FILE_SIZE=5*1024*1024;static MAX_LINES=1e4;static CSV_DELIMITERS=[",",";","	","|"];async parseFile(l,f=!0){this.validateFile(l);const d=await this.readFileContent(l),j=this.splitIntoLines(d);this.validateLineCount(j);const E=this.detectFileType(l,j),C=this.generateFileId(l);if(E==="csv"){const{csvData:L,headers:M,delimiter:z}=this.parseCSV(j,f);return{data:{csvData:L,headers:M},fileInfo:{id:C,name:l.name,type:"csv",size:l.size,lineCount:L.length,headers:M},delimiter:z}}else return{data:{lines:j},fileInfo:{id:C,name:l.name,type:"text",size:l.size,lineCount:j.length}}}parseText(l,f=!0){const d=this.splitIntoLines(l);this.validateLineCount(d);const j=this.detectTextType(d),E=this.generateTextId();if(j==="csv"){const{csvData:C,headers:L,delimiter:M}=this.parseCSV(d,f);return{data:{csvData:C,headers:L},fileInfo:{id:E,name:"Pasted Text",type:"csv",size:l.length,lineCount:C.length,headers:L},delimiter:M}}else return{data:{lines:d},fileInfo:{id:E,name:"Pasted Text",type:"text",size:l.length,lineCount:d.length}}}detectFileType(l,f){const d=l.name.toLowerCase().split(".").pop();return d==="csv"||d==="tsv"?"csv":this.detectTextType(f)}detectTextType(l){if(l.length===0)return"text";const f=Math.min(5,l.length),d=l.slice(0,f);for(const j of $e.CSV_DELIMITERS)if(this.looksLikeCSV(d,j))return"csv";return"text"}looksLikeCSV(l,f){if(l.length<2)return!1;const d=l.map(E=>E.split(f).length);return Math.min(...d)>=2}extractCSVHeaders(l,f=",",d=!0){if(l.length===0)return[];if(d)return l[0].split(f).map(j=>j.trim().replace(/^["']|["']$/g,""));{const j=l[0].split(f).length;return Array.from({length:j},(E,C)=>`Column ${C+1}`)}}parseCSV(l,f=!0){let d=",",j=0;for(const L of $e.CSV_DELIMITERS)if(l.length>0){const M=l[0].split(L).length;M>j&&this.looksLikeCSV(l.slice(0,Math.min(3,l.length)),L)&&(j=M,d=L)}const E=l.map(L=>L.split(d).map(M=>M.trim().replace(/^["']|["']$/g,""))),C=f&&E.length>0?[...E[0]]:this.extractCSVHeaders(l,d,f);return{csvData:E,headers:C,delimiter:d}}validateFile(l){if(l.size>$e.MAX_FILE_SIZE)throw new Error(`File size exceeds maximum limit of ${$e.MAX_FILE_SIZE/1024/1024}MB`)}validateLineCount(l){if(l.length>$e.MAX_LINES)throw new Error(`File contains ${l.length} lines, which exceeds the maximum limit of ${$e.MAX_LINES} lines`)}async readFileContent(l){if(typeof l.text=="function")return console.log("using file.text"),await l.text();if(typeof l.arrayBuffer=="function"){console.log("using file.arrayBuffer");const j=await l.arrayBuffer();return new TextDecoder().decode(j)}const f=l.name?.toLowerCase().split(".").pop();if(!(l.type==="text/plain"||f==="txt")){const j=Object.getOwnPropertySymbols(l);for(const E of j){const C=l[E];if(C&&C._buffer){console.log("using internal buffer");const L=C._buffer instanceof Uint8Array?C._buffer:new Uint8Array(C._buffer.data??C._buffer);return new TextDecoder().decode(L)}}}if(typeof Response<"u")try{console.log("using Response fallback");const j=Object.getOwnPropertySymbols(l);return console.log("file descriptors",Object.getOwnPropertyNames(l),typeof l.text,typeof l.arrayBuffer,j),j.length&&console.log("symbol content",l[j[0]]),await new Response(l).text()}catch{}return new Promise((j,E)=>{const C=new FileReader;console.log("using FileReader fallback"),C.onload=L=>{if(L.target){const M=L.target.result;j(typeof M=="string"?M:String(M??""))}else E(new Error("Failed to read file content"))},C.onerror=()=>{E(new Error("File reading failed"))},C.readAsText(l)})}splitIntoLines(l){return l.split(/\r\n|\n|\r/g).filter(f=>f.trim().length>0)}generateFileId(l){return`file_${Date.now()}_${Math.random().toString(36).substr(2,9)}_${l.name.replace(/[^a-zA-Z0-9]/g,"")}`}generateTextId(){return`text_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static getMaxFileSize(){return $e.MAX_FILE_SIZE}static getMaxLines(){return $e.MAX_LINES}static getSupportedDelimiters(){return[...$e.CSV_DELIMITERS]}reParseCSV(l,f){return this.parseCSV(l,f)}}const gn=new $e;class si{worker=null;isInitialized=!1;callbacks={};currentData=null;currentDataType=null;async initialize(){if(!this.isInitialized)try{this.worker=new Worker("/filter.worker.js"),this.setupWorkerListeners(),await new Promise((l,f)=>{const d=setTimeout(()=>{f(new Error("Worker initialization timeout"))},5e3),j=E=>{E.data.type==="ready"&&(clearTimeout(d),this.worker?.removeEventListener("message",j),l())};this.worker?.addEventListener("message",j)}),this.isInitialized=!0}catch(l){throw new Error(`Failed to initialize worker: ${l instanceof Error?l.message:"Unknown error"}`)}}async setData(l,f){if(!this.worker||!this.isInitialized)throw new Error("Worker not initialized");return this.currentData=l,this.currentDataType=f,new Promise((d,j)=>{const E=setTimeout(()=>{j(new Error("Set data timeout"))},1e4),C=L=>{L.data.type==="dataSet"?(clearTimeout(E),this.worker?.removeEventListener("message",C),L.data.payload.success?d():j(new Error("Failed to set data in worker"))):L.data.type==="error"&&(clearTimeout(E),this.worker?.removeEventListener("message",C),j(new Error(L.data.payload.error)))};this.worker?.addEventListener("message",C),this.worker?.postMessage({type:"setData",payload:{data:l,dataType:f}})})}async filter(l,f={}){if(!this.worker||!this.isInitialized)throw new Error("Worker not initialized");if(!this.currentData)throw new Error("No data loaded in worker");return this.callbacks=f,new Promise((d,j)=>{const E=setTimeout(()=>{j(new Error("Filter operation timeout"))},3e4),C=L=>{const{type:M,payload:z}=L.data;switch(M){case"progress":z.filterId===l.filterId&&f.onProgress&&f.onProgress(z.filterId,z.progress,z.processedLines,z.totalLines);break;case"complete":if(z.filterId===l.filterId){clearTimeout(E),this.worker?.removeEventListener("message",C);const X={filterId:z.filterId,matchedLines:z.matchedLines,totalMatches:z.totalMatches,processingTime:z.processingTime};f.onComplete&&f.onComplete(X),d(X)}break;case"error":clearTimeout(E),this.worker?.removeEventListener("message",C);const H=z.error||"Unknown worker error";f.onError&&f.onError(l.filterId,H),j(new Error(H));break}};this.worker?.addEventListener("message",C),this.worker?.postMessage({type:"filter",payload:l})})}clearData(){this.worker&&this.isInitialized&&(this.worker.postMessage({type:"clear"}),this.currentData=null,this.currentDataType=null)}terminate(){this.worker&&(this.worker.terminate(),this.worker=null,this.isInitialized=!1,this.currentData=null,this.currentDataType=null,this.callbacks={})}setupWorkerListeners(){this.worker&&(this.worker.addEventListener("error",l=>{console.error("Worker error:",l),this.callbacks.onError&&this.callbacks.onError("unknown",`Worker error: ${l.message}`)}),this.worker.addEventListener("messageerror",l=>{console.error("Worker message error:",l),this.callbacks.onError&&this.callbacks.onError("unknown","Worker message error")}))}isReady(){return this.isInitialized&&this.worker!==null}hasData(){return this.currentData!==null}getDataInfo(){return{lineCount:this.currentData?this.currentData.length:0,dataType:this.currentDataType}}}const Re=new si,Be=De("none"),We=De(0),Ge=De([]),He=De(!0),nt=De(","),ft=De(null),Lt=De(null),Te=De("idle"),Se=De(0),Me=De(null),Ce=ls({}),Ue=ls({}),_t=De(!1),vn=De(0),bn=De(!1),xn=De(null),rt=De(1),kn=De(100),os=De(null),Dr=Gt([Be,We],(w,l)=>w!=="none"&&l>0),cs=Gt([Dr,_t],(w,l)=>w&&!l);Gt(Ce,w=>Object.keys(w).length);Gt(Ue,w=>Object.values(w).reduce((l,f)=>l+f.totalMatches,0));Gt(Te,w=>w!=="idle"&&w!=="complete"&&w!=="error");const je={async loadFile(w){try{Te.set("uploading"),Se.set(0),Me.set(null);const l=He.get(),f=await gn.parseFile(w,l);Te.set("parsing"),Se.set(30);const d={...f.fileInfo,uploadedAt:new Date};if(await be.storeFileData(d),Se.set(60),f.fileInfo.type==="csv"&&f.data.csvData){const C=(await w.text()).split(/\r?\n/).filter(L=>L.trim().length>0);await be.storeOriginalLines(d.id,C),await be.storeCSVLines(d.id,f.data.csvData,f.data.headers),Ge.set(f.data.headers||[]),nt.set(f.delimiter||",")}else f.data.lines&&await be.storeTextLines(d.id,f.data.lines);Se.set(80),Re.isReady()||await Re.initialize();let j;f.fileInfo.type==="csv"?j=await be.getAllCSVLinesForFiltering():j=await be.getAllTextLinesForFiltering(),await Re.setData(j,f.fileInfo.type),Be.set(f.fileInfo.type),We.set(f.fileInfo.lineCount),ft.set(d.id),Lt.set(d.name),Se.set(100),Te.set("complete"),tt()}catch(l){const f=l instanceof Error?l.message:"Failed to load file";throw Me.set(f),Te.set("error"),l}},async loadText(w){try{Te.set("parsing"),Se.set(0),Me.set(null);const l=He.get(),f=gn.parseText(w,l);Se.set(30);const d={...f.fileInfo,uploadedAt:new Date};if(await be.storeFileData(d),Se.set(60),f.fileInfo.type==="csv"&&f.data.csvData){const E=w.split(/\r?\n/).filter(C=>C.trim().length>0);await be.storeOriginalLines(d.id,E),await be.storeCSVLines(d.id,f.data.csvData,f.data.headers),Ge.set(f.data.headers||[]),nt.set(f.delimiter||",")}else f.data.lines&&await be.storeTextLines(d.id,f.data.lines);Se.set(80),Re.isReady()||await Re.initialize();let j;f.fileInfo.type==="csv"?j=await be.getAllCSVLinesForFiltering():j=await be.getAllTextLinesForFiltering(),await Re.setData(j,f.fileInfo.type),Be.set(f.fileInfo.type),We.set(f.fileInfo.lineCount),ft.set(d.id),Lt.set(d.name),Se.set(100),Te.set("complete"),tt()}catch(l){const f=l instanceof Error?l.message:"Failed to load text";throw Me.set(f),Te.set("error"),l}},async addFilter(w){const l=Ce.get();Ce.set({...l,[w.id]:w});try{await this.applyFilter(w.id),tt()}catch(f){throw console.error("Failed to auto-apply filter:",f),this.removeFilter(w.id),f}},removeFilter(w){const f={...Ce.get()};delete f[w],Ce.set(f);const j={...Ue.get()};delete j[w],Ue.set(j),rt.set(1),tt()},updateFilter(w,l){const f=Ce.get(),d=f[w];d&&(Ce.set({...f,[w]:{...d,...l}}),tt())},toggleFilter(w){const f=Ce.get()[w];f&&this.updateFilter(w,{isActive:!f.isActive})},async applyFilter(w){const l=Ce.get()[w];if(!l)throw new Error("Filter not found");try{_t.set(!0),Me.set(null);const f={filterId:l.id,pattern:l.pattern,patterns:l.patterns,filterType:l.type,caseSensitive:l.caseSensitive,useRegex:l.useRegex,columnIndex:"columnIndex"in l?l.columnIndex:void 0,scope:"scope"in l?l.scope:"all"},d=await Re.filter(f,{onProgress:(E,C)=>{Se.set(C)},onError:(E,C)=>{Me.set(C)}}),j=Ue.get();return Ue.set({...j,[w]:d}),rt.set(1),vn.set(Date.now()),d}catch(f){const d=f instanceof Error?f.message:"Filter operation failed";throw Me.set(d),f}finally{_t.set(!1)}},async applyAllActiveFilters(){const w=Ce.get(),l=Object.keys(w).filter(f=>w[f].isActive);for(const f of l)await this.applyFilter(f)},clearFilters(){Ce.set({}),Ue.set({}),rt.set(1),tt()},async clearAllData(){try{await be.clearData(),Re.clearData(),Be.set("none"),We.set(0),Ge.set([]),He.set(!0),nt.set(","),ft.set(null),Lt.set(null),Te.set("idle"),Se.set(0),Me.set(null),Ce.set({}),Ue.set({}),_t.set(!1),vn.set(0),rt.set(1),ai()}catch(w){const l=w instanceof Error?w.message:"Failed to clear data";throw Me.set(l),w}},openModal(){bn.set(!0)},closeModal(){bn.set(!1),xn.set(null)},selectFilter(w){xn.set(w)},setFocus(w){os.set(w)},setPage(w){rt.set(w)},async setHasHeaders(w){const l=Be.get(),f=ft.get();if(l!=="csv"||!f){He.set(w),tt();return}try{Te.set("parsing"),Se.set(0);const d=await this.getOriginalCSVLines();if(d.length===0){He.set(w),tt(),Te.set("complete");return}Se.set(30);const{csvData:j,headers:E,delimiter:C}=gn.reParseCSV(d,w);if(Se.set(60),await be.clearCSVData(),await be.storeCSVLines(f,j,E),Se.set(80),He.set(w),Ge.set(E),We.set(j.length),nt.set(C),Ce.set({}),Ue.set({}),rt.set(1),Re.isReady()){const L=await be.getAllCSVLinesForFiltering();await Re.setData(L,"csv")}Se.set(100),Te.set("complete"),tt()}catch(d){console.error("Failed to update header setting:",d),Me.set("Failed to update header setting"),Te.set("error")}},async getOriginalCSVLines(){const w=ft.get();return w?await be.getOriginalLines(w):[]},setDelimiter(w){nt.set(w)},getState(){return{data:{fileId:ft.get(),fileName:Lt.get(),dataType:Be.get(),lineCount:We.get(),csvHeaders:Ge.get(),hasHeaders:He.get(),delimiter:nt.get()},processing:{status:Te.get(),progress:Se.get(),error:Me.get()},filters:{active:Object.keys(Ce.get()),results:Object.values(Ue.get()),isFiltering:_t.get(),lastFilterTime:vn.get()},ui:{isModalOpen:bn.get(),selectedFilter:xn.get(),currentPage:rt.get(),pageSize:kn.get(),focusedElement:os.get()}}}},Tt="lineFilterState",tt=()=>{try{const w={fileId:ft.get()||"",fileName:Lt.get()||"",dataType:Be.get(),lineCount:We.get(),csvHeaders:Ge.get(),hasHeaders:He.get(),delimiter:nt.get(),activeFilters:Ce.get(),timestamp:Date.now()};w.dataType!=="none"&&w.fileId&&localStorage.setItem(Tt,JSON.stringify(w))}catch(w){console.warn("Failed to save state to localStorage:",w)}},ii=async()=>{try{const w=localStorage.getItem(Tt);if(!w)return!1;const l=JSON.parse(w),f=1440*60*1e3;if(Date.now()-l.timestamp>f||!await be.hasData(l.fileId))return localStorage.removeItem(Tt),!1;ft.set(l.fileId),Lt.set(l.fileName),Be.set(l.dataType),We.set(l.lineCount),Ge.set(l.csvHeaders),He.set(l.hasHeaders),nt.set(l.delimiter),Ce.set(l.activeFilters),Re.isReady()||await Re.initialize();let j;l.dataType==="csv"?j=await be.getAllCSVLinesForFiltering():j=await be.getAllTextLinesForFiltering(),await Re.setData(j,l.dataType);const E=Object.values(l.activeFilters).filter(C=>C.isActive);for(const C of E)try{await je.applyFilter(C.id)}catch(L){console.warn("Failed to restore filter:",C.id,L)}return!0}catch(w){return console.warn("Failed to restore state from localStorage:",w),localStorage.removeItem(Tt),!1}},ai=()=>{try{localStorage.removeItem(Tt)}catch(w){console.warn("Failed to clear stored state:",w)}},oi=async()=>{try{await Re.initialize(),await ii()&&console.log("Restored previous line filter session")}catch(w){console.error("Failed to initialize line filter store:",w),Me.set("Failed to initialize filtering system")}};class li{shortcuts=new Map;isEnabled=!0;isBrowser;constructor(){this.isBrowser=typeof window<"u",this.isBrowser&&document.addEventListener("keydown",this.handleKeyDown.bind(this))}generateShortcutId(l){const f=[l.ctrlKey?"Ctrl":"",l.metaKey?"Meta":"",l.shiftKey?"Shift":"",l.altKey?"Alt":""].filter(Boolean).join("+");return f?`${f}+${l.key}`:l.key}register(l){const f=this.generateShortcutId(l);return this.shortcuts.set(f,{...l,id:f}),f}unregister(l){return this.shortcuts.delete(l)}enable(){this.isEnabled=!0}disable(){this.isEnabled=!1}handleKeyDown(l){if(!this.isEnabled)return;const f=l.target;if(f.tagName==="INPUT"||f.tagName==="TEXTAREA"||f.isContentEditable){const d=(l.metaKey||l.ctrlKey)&&l.key==="k",j=(l.metaKey||l.ctrlKey)&&l.key==="Enter";if(!d&&!j)return}for(const d of this.shortcuts.values())if(l.key.toLowerCase()===d.key.toLowerCase()&&!!l.ctrlKey==!!d.ctrlKey&&!!l.metaKey==!!d.metaKey&&!!l.shiftKey==!!d.shiftKey&&!!l.altKey==!!d.altKey){d.handler(l);return}}getShortcuts(){return Array.from(this.shortcuts.values())}formatShortcut(l){const f=this.shortcuts.get(l);if(!f)return"";const d=[];f.ctrlKey&&d.push("Ctrl"),f.metaKey&&d.push("â"),f.shiftKey&&d.push("â§"),f.altKey&&d.push("â¥");let j=f.key;return j===" "?j="Space":j==="ArrowUp"?j="â":j==="ArrowDown"?j="â":j==="ArrowLeft"?j="â":j==="ArrowRight"?j="â":j==="Enter"?j="âµ":j==="Escape"?j="Esc":j.length===1&&(j=j.toUpperCase()),d.push(j),d.join("+")}}const ci=()=>new li,It=typeof window<"u"?ci():{register:()=>"",unregister:()=>!1,enable:()=>{},disable:()=>{},getShortcuts:()=>[],formatShortcut:()=>""},ui=({className:w=""})=>{const[l,f]=F.useState(!1),[d,j]=F.useState(""),[E,C]=F.useState("both"),L=F.useRef(null),M=se(Te),z=se(Se),H=se(Me),X=se(He),Q=M==="uploading"||M==="parsing",R=F.useMemo(()=>{if(!d.trim())return null;const $=d.split(`
`).filter(V=>V.trim().length>0);if($.length<2)return null;const I=[{char:",",name:"Comma"},{char:";",name:"Semicolon"},{char:"	",name:"Tab"}];for(const V of I){const G=$[0].split(V.char).length;if(G>1&&$.slice(0,Math.min(3,$.length)).every(Ke=>Ke.split(V.char).length===G))return{delimiter:V.name,columns:G,format:`${V.name} CSV (${G} columns)`}}return null},[d]),Z=d.split(`
`).filter($=>$.trim().length>0).length,ie=d.trim().length>0,he=F.useCallback(async $=>{try{C("file-focused"),j(""),await je.loadFile($)}catch(I){console.error("File upload failed:",I),C("both")}},[]),ae=F.useCallback($=>{const I=$.target.files?.[0];I&&he(I)},[he]),de=F.useCallback($=>{$.preventDefault(),f(!1);const I=$.dataTransfer.files[0];I&&he(I)},[he]),ye=F.useCallback($=>{$.preventDefault(),f(!0)},[]),xe=F.useCallback($=>{$.preventDefault(),f(!1)},[]),pe=F.useCallback(()=>{L.current?.click()},[]),oe=F.useCallback($=>{const I=$.target.value;j(I),I.trim()?C("text-focused"):E==="text-focused"&&C("both")},[E]),U=F.useCallback($=>{const I=$.clipboardData.getData("text");I&&(j(I),C("text-focused"))},[]),te=F.useCallback(async()=>{if(d.trim())try{await je.loadText(d),j(""),C("both")}catch($){console.error("Text processing failed:",$)}},[d]),ge=F.useCallback(()=>{j(""),C("both")},[]),ke=$e.getMaxFileSize(),Oe=$e.getMaxLines(),ce=Math.round(ke/1024/1024);return a.jsx("div",{className:`${w}`,children:a.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-xl overflow-hidden shadow-sm hover:shadow-md transition-all duration-200",children:[a.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 px-6 py-4 border-b border-gray-200",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Add Your Data"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Upload a file or paste text directly"})]})]})}),a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsxs("div",{className:`
              relative border-2 border-dashed rounded-lg text-center transition-all duration-200
              ${l?"border-blue-400 bg-blue-50 scale-[1.01]":"border-gray-300 hover:border-blue-300"}
              ${E==="text-focused"?"opacity-60 bg-gray-50":"opacity-100"}
              ${Q?"opacity-50 cursor-not-allowed":"cursor-pointer hover:bg-gray-50"}
            `,onDrop:de,onDragOver:ye,onDragLeave:xe,onClick:Q?void 0:pe,children:[a.jsx("input",{ref:L,type:"file",accept:".txt,.csv,.tsv,.log",onChange:ae,className:"hidden",disabled:Q}),a.jsxs("div",{className:"py-8",children:[a.jsx("div",{className:"flex justify-center mb-4",children:a.jsx("svg",{className:`w-10 h-10 ${l?"text-blue-500":"text-gray-400"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),a.jsx("p",{className:"text-base font-medium text-gray-700 mb-2",children:l?"Drop your file here":"Drop file or click to browse"}),a.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Supports .txt, .csv, .tsv, .log files"}),a.jsxs("div",{className:"inline-flex items-center space-x-3 text-xs text-gray-400 bg-gray-50 px-3 py-2 rounded-full",children:[a.jsxs("span",{children:["Max: ",ce,"MB"]}),a.jsx("span",{children:"â¢"}),a.jsxs("span",{children:[Oe.toLocaleString()," lines"]})]})]})]}),a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-0 flex items-center",children:a.jsx("div",{className:"w-full border-t border-gray-200"})}),a.jsx("div",{className:"relative flex justify-center",children:a.jsx("span",{className:"bg-white px-4 text-sm font-medium text-gray-500",children:"OR"})})]}),a.jsx("div",{className:`transition-all duration-200 ${E==="file-focused"?"opacity-60 bg-gray-50 rounded-lg":"opacity-100"}`,children:a.jsxs("div",{className:"border border-gray-300 rounded-lg overflow-hidden focus-within:border-blue-500 focus-within:ring-1 focus-within:ring-blue-500",children:[a.jsx("textarea",{value:d,onChange:oe,onPaste:U,placeholder:"Paste your text data here, or start typing...",className:"w-full h-32 p-4 text-sm font-mono resize-none border-0 focus:outline-none focus:ring-0 placeholder-gray-400",disabled:Q}),ie&&a.jsxs("div",{className:"bg-gray-50 px-4 py-2 border-t border-gray-200 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx("svg",{className:"w-4 h-4 mr-1 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),Z," lines ready"]}),R&&a.jsxs("div",{className:"flex items-center text-sm text-blue-600",children:[a.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),R.format]})]}),a.jsx("button",{type:"button",onClick:ge,className:"text-sm text-gray-500 hover:text-red-600 font-medium",disabled:Q,children:"Clear"})]})]})}),R&&a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("svg",{className:"w-5 h-5 text-blue-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("p",{className:"text-sm font-medium text-blue-900 mb-2",children:["CSV Format Detected: ",R.format]}),a.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:X,onChange:$=>je.setHasHeaders($.target.checked),className:"rounded border-blue-300 text-blue-600 focus:ring-blue-500 focus:ring-offset-0",disabled:Q}),a.jsx("span",{className:"text-sm text-blue-800",children:"First row contains column headers"})]})]})]})}),Q&&a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-medium text-blue-900",children:M==="uploading"?"Uploading file...":"Processing data..."}),a.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2 mt-2",children:a.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${z}%`}})}),a.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:[z,"% complete"]})]})]})}),H&&a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("svg",{className:"h-5 w-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),a.jsx("div",{className:"ml-3",children:a.jsx("p",{className:"text-sm text-red-700 font-medium",children:H})})]})}),!Q&&a.jsx("div",{className:"text-center",children:a.jsxs("button",{type:"button",onClick:te,disabled:!ie,className:`inline-flex items-center px-8 py-4 text-lg font-semibold rounded-lg focus:outline-none focus:ring-4 transform transition-all duration-200 shadow-lg ${ie?"text-white bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 hover:scale-105 active:scale-95 focus:ring-blue-300 hover:shadow-xl":"text-gray-500 bg-gray-300 cursor-not-allowed focus:ring-gray-300"}`,children:["Process",a.jsx("svg",{className:"w-5 h-5 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7l5 5m0 0l-5 5m5-5H6"})})]})})]})]})})},di=({className:w=""})=>{const l=se(Be),f=se(We),d=se(Ge),j=se(He);if(se(nt),l==="none")return null;const E=()=>l==="csv"?`${l.toUpperCase()} â¢ ${f.toLocaleString()} lines â¢ ${d.length} columns`:`${l.toUpperCase()} â¢ ${f.toLocaleString()} lines`;return a.jsx("div",{className:`${w}`,children:a.jsxs("div",{className:"inline-flex items-center space-x-2",children:[a.jsxs("div",{className:"flex items-center space-x-2 bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm",children:[a.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),a.jsx("span",{className:"font-medium",children:E()})]}),l==="csv"&&a.jsxs("label",{className:"flex items-center space-x-1 cursor-pointer text-sm text-gray-600 hover:text-gray-800",children:[a.jsx("input",{type:"checkbox",checked:j,onChange:C=>je.setHasHeaders(C.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500 focus:ring-offset-0 w-3 h-3"}),a.jsx("span",{className:"text-xs",children:"Headers"})]})]})})},us=({patterns:w,onPatternsChange:l,onAddFilter:f,placeholder:d="Enter pattern...",disabled:j=!1,className:E=""})=>{const[C,L]=F.useState(""),[M,z]=F.useState(null),[H,X]=F.useState(""),Q=F.useRef(null),R=F.useCallback(()=>`pattern_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,[]),Z=F.useCallback(U=>U.trim()?{isValid:!0}:{isValid:!1,error:"Pattern cannot be empty"},[]),ie=F.useCallback(()=>{if(!C.trim())return;const U=Z(C),te={id:R(),value:C.trim(),isValid:U.isValid,error:U.error};l([...w,te]),L(""),setTimeout(()=>Q.current?.focus(),0)},[C,w,l,R,Z]),he=F.useCallback(U=>{l(w.filter(te=>te.id!==U)),setTimeout(()=>Q.current?.focus(),0)},[w,l]),ae=F.useCallback(U=>{z(U.id),X(U.value)},[]),de=F.useCallback(()=>{if(!M||!H.trim()){z(null);return}const U=Z(H),te=w.map(ge=>ge.id===M?{...ge,value:H.trim(),isValid:U.isValid,error:U.error}:ge);l(te),z(null),X(""),setTimeout(()=>Q.current?.focus(),0)},[M,H,w,l,Z]),ye=F.useCallback(()=>{z(null),X(""),setTimeout(()=>Q.current?.focus(),0)},[]),xe=F.useCallback(U=>{switch(U.key){case"Enter":U.preventDefault(),U.shiftKey?(C.trim()&&ie(),f()):ie();break;case"Backspace":if(!C&&w.length>0){U.preventDefault();const te=w[w.length-1];he(te.id)}break;case"Escape":U.preventDefault(),C&&L("");break}},[C,w,ie,f,he]),pe=F.useCallback(U=>{switch(U.key){case"Enter":U.preventDefault(),de();break;case"Escape":U.preventDefault(),ye();break}},[de,ye]);F.useEffect(()=>{M||Q.current?.focus()},[M]);const oe=w.length>0;return oe||C.trim(),a.jsxs("div",{className:`${E}`,children:[oe&&a.jsxs("div",{className:"flex flex-wrap items-center gap-1 mb-2",children:[w.map(U=>a.jsxs("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs border ${U.isValid?"bg-blue-100 border-blue-300 text-blue-800":"bg-red-100 border-red-300 text-red-800"}`,children:[M===U.id?a.jsx("input",{type:"text",value:H,onChange:te=>X(te.target.value),onKeyDown:pe,onBlur:de,className:"bg-transparent border-none outline-none text-xs w-20 min-w-0",autoFocus:!0}):a.jsx("span",{onClick:()=>ae(U),className:"cursor-pointer truncate max-w-32",title:U.error||U.value,children:U.value}),a.jsx("button",{type:"button",onClick:()=>he(U.id),className:"ml-1 hover:bg-white hover:bg-opacity-50 rounded-full p-0.5",title:"Remove pattern",disabled:j,children:a.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},U.id)),w.length>1&&a.jsx("span",{className:"text-xs text-gray-500 font-medium px-1",children:"OR"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"flex-1",children:a.jsx("input",{ref:Q,type:"text",value:C,onChange:U=>L(U.target.value),onKeyDown:xe,placeholder:oe?"Add another pattern...":d,className:"w-full px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500",disabled:j})}),oe&&a.jsx("button",{type:"button",onClick:ie,disabled:!C.trim()||j,className:"px-2 py-1.5 text-xs text-blue-600 border border-blue-300 rounded-md hover:bg-blue-50 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",title:"Add OR pattern (Enter)",children:"+ OR"})]}),!j&&a.jsx("div",{className:"mt-1 text-xs text-gray-500",children:oe?a.jsx("span",{children:"Press Enter to add OR pattern, Shift+Enter to add filter"}):a.jsx("span",{children:"Press Enter for OR patterns, Shift+Enter to add filter"})})]})},fi=({className:w="",onFilterAdded:l,editingFilterId:f,onEditComplete:d})=>{const[j,E]=F.useState([]),[C,L]=F.useState("include"),[M,z]=F.useState(!1),[H,X]=F.useState(!1),[Q,R]=F.useState(""),[Z,ie]=F.useState(!1),he=se(Be),ae=se(cs),de=se(Ce);F.useEffect(()=>{if(f){const te=de[f];if(te&&!("scope"in te)){const ge=Array.isArray(te.patterns)?te.patterns.map((ke,Oe)=>({id:`pattern_${Oe}_${Date.now()}`,value:ke,isValid:!0})):[{id:`pattern_0_${Date.now()}`,value:te.pattern,isValid:!0}];E(ge),L(te.type),z(te.caseSensitive),X(te.useRegex),ie(!0),R("")}}else ie(!1)},[f,de]),F.useCallback(te=>{if(!te.trim())return{isValid:!1,error:"Pattern cannot be empty"};if(H)try{new RegExp(te)}catch(ge){return{isValid:!1,error:`Invalid regex: ${ge instanceof Error?ge.message:"Unknown error"}`}}return{isValid:!0}},[H]);const ye=F.useCallback(te=>{E(te),R("")},[]),xe=F.useCallback(()=>`filter_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,[]),pe=F.useCallback(async()=>{if(j.length===0||!ae)return;if(j.some(ke=>!ke.isValid)){R("Please fix invalid patterns before adding filter");return}const ge=j.map(ke=>ke.value);if(Z&&f){const ke={patterns:ge,pattern:ge[0],type:C,caseSensitive:M,useRegex:H};try{je.updateFilter(f,ke),await je.applyFilter(f),E([]),R(""),ie(!1),d?.()}catch(Oe){console.error("Failed to update filter:",Oe),R("Failed to update filter. Please try again.")}}else{const ke={id:xe(),patterns:ge,pattern:ge[0],type:C,caseSensitive:M,useRegex:H,isActive:!0,created:new Date};try{await je.addFilter(ke),l?.(ke),E([]),R("")}catch(Oe){console.error("Failed to add filter:",Oe),R("Failed to add filter. Please try again.")}}},[j,C,M,H,ae,xe,l,Z,f,d]);if(he==="none")return null;const oe=F.useCallback(()=>{E([]),R(""),ie(!1),d?.()},[d]),U=j.length>0&&j.every(te=>te.isValid)&&ae;return a.jsxs("div",{className:`${w}`,children:[a.jsx("div",{className:"mb-2",children:a.jsx(us,{patterns:j,onPatternsChange:ye,onAddFilter:pe,placeholder:"Text filter pattern...",disabled:!ae,className:""})}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs("select",{value:C,onChange:te=>L(te.target.value),className:"px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white",disabled:!ae,children:[a.jsx("option",{value:"include",children:"Include"}),a.jsx("option",{value:"exclude",children:"Exclude"})]}),a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx("button",{type:"button",onClick:()=>z(!M),className:`px-1.5 py-1 text-xs rounded ${M?"bg-blue-100 text-blue-800 border border-blue-300":"bg-gray-100 text-gray-600 border border-gray-300"}`,title:"Case sensitive",disabled:!ae,children:"Aa"}),a.jsx("button",{type:"button",onClick:()=>X(!H),className:`px-1.5 py-1 text-xs rounded ${H?"bg-blue-100 text-blue-800 border border-blue-300":"bg-gray-100 text-gray-600 border border-gray-300"}`,title:"Use regex",disabled:!ae,children:".*"})]}),a.jsx("button",{type:"button",onClick:pe,disabled:!U,className:"px-3 py-1.5 bg-blue-600 text-white text-xs font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:Z?"Update Filter":"Add Filter"}),Z&&a.jsx("button",{type:"button",onClick:oe,className:"px-2 py-1.5 bg-gray-500 text-white text-xs font-medium rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Cancel"})]}),Q&&a.jsx("div",{className:"mt-2",children:a.jsx("p",{className:"text-xs text-red-600",children:Q})})]})},hi=({className:w="",onFilterAdded:l,editingFilterId:f,onEditComplete:d})=>{const[j,E]=F.useState([]),[C,L]=F.useState("include"),[M,z]=F.useState(!1),[H,X]=F.useState(!1),[Q,R]=F.useState("all"),[Z,ie]=F.useState(-1),[he,ae]=F.useState(""),[de,ye]=F.useState(!1),xe=se(Be),pe=se(cs),oe=se(Ge),U=se(Ce);F.useEffect(()=>{if(f){const I=U[f];if(I&&"scope"in I){const V=Array.isArray(I.patterns)?I.patterns.map((G,we)=>({id:`pattern_${we}_${Date.now()}`,value:G,isValid:!0})):[{id:`pattern_0_${Date.now()}`,value:I.pattern,isValid:!0}];E(V),L(I.type),z(I.caseSensitive),X(I.useRegex),R(I.scope),ie(I.columnIndex||-1),ye(!0),ae("")}}else ye(!1)},[f,U]);const te=F.useMemo(()=>oe.map((I,V)=>({index:V,name:I||`Column ${V+1}`,displayName:I?`${I} (${V+1})`:`Column ${V+1}`})),[oe]);F.useCallback(I=>{if(!I.trim())return{isValid:!1,error:"Pattern cannot be empty"};if(H)try{new RegExp(I)}catch(V){return{isValid:!1,error:`Invalid regex: ${V instanceof Error?V.message:"Unknown error"}`}}return{isValid:!0}},[H]);const ge=F.useCallback(I=>{E(I),ae("")},[]);F.useCallback(I=>{R(I),I==="all"?ie(-1):te.length>0&&Z===-1&&ie(0)},[te.length,Z]);const ke=F.useCallback(()=>`csvfilter_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,[]),Oe=F.useCallback(async()=>{if(j.length===0||!pe||Q==="column"&&(Z===-1||Z>=oe.length))return;if(j.some(G=>!G.isValid)){ae("Please fix invalid patterns before adding filter");return}const V=j.map(G=>G.value);if(de&&f){const G={patterns:V,pattern:V[0],type:C,caseSensitive:M,useRegex:H,scope:Q,columnIndex:Q==="column"?Z:void 0,columnName:Q==="column"?oe[Z]:void 0};try{je.updateFilter(f,G),await je.applyFilter(f),E([]),ae(""),ye(!1),d?.()}catch(we){console.error("Failed to update filter:",we),ae("Failed to update filter. Please try again.")}}else{const G={id:ke(),patterns:V,pattern:V[0],type:C,caseSensitive:M,useRegex:H,scope:Q,columnIndex:Q==="column"?Z:void 0,columnName:Q==="column"?oe[Z]:void 0,isActive:!0,created:new Date};try{await je.addFilter(G),l?.(G),E([]),ae("")}catch(we){console.error("Failed to add filter:",we),ae("Failed to add filter. Please try again.")}}},[j,C,M,H,Q,Z,oe,pe,ke,l,de,f,d]);if(xe!=="csv")return null;Object.keys(U).length;const ce=j.length>0&&j.every(I=>I.isValid)&&pe&&(Q==="all"||Q==="column"&&Z>=0),$=F.useCallback(()=>{E([]),ae(""),R("all"),ie(-1),ye(!1),d?.()},[d]);return a.jsxs("div",{className:`${w}`,children:[a.jsx("div",{className:"mb-2",children:a.jsx(us,{patterns:j,onPatternsChange:ge,onAddFilter:Oe,placeholder:"CSV filter pattern...",disabled:!pe,className:""})}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs("select",{value:C,onChange:I=>L(I.target.value),className:"px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white",disabled:!pe,children:[a.jsx("option",{value:"include",children:"Include"}),a.jsx("option",{value:"exclude",children:"Exclude"})]}),a.jsxs("select",{value:Q==="column"?Z:"all",onChange:I=>{const V=I.target.value;V==="all"?(R("all"),ie(-1)):(R("column"),ie(parseInt(V)))},className:"px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white",disabled:!pe,children:[a.jsx("option",{value:"all",children:"All columns"}),oe.map((I,V)=>a.jsx("option",{value:V,children:I||`Column ${V+1}`},V))]}),a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx("button",{type:"button",onClick:()=>z(!M),className:`px-1.5 py-1 text-xs rounded ${M?"bg-blue-100 text-blue-800 border border-blue-300":"bg-gray-100 text-gray-600 border border-gray-300"}`,title:"Case sensitive",disabled:!pe,children:"Aa"}),a.jsx("button",{type:"button",onClick:()=>X(!H),className:`px-1.5 py-1 text-xs rounded ${H?"bg-blue-100 text-blue-800 border border-blue-300":"bg-gray-100 text-gray-600 border border-gray-300"}`,title:"Use regex",disabled:!pe,children:".*"})]}),a.jsx("button",{type:"button",onClick:Oe,disabled:!ce,className:"px-3 py-1.5 bg-blue-600 text-white text-xs font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:de?"Update Filter":"Add Filter"}),de&&a.jsx("button",{type:"button",onClick:$,className:"px-2 py-1.5 bg-gray-500 text-white text-xs font-medium rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Cancel"})]}),he&&a.jsx("div",{className:"mt-2",children:a.jsx("p",{className:"text-xs text-red-600",children:he})})]})},pi=({className:w="",onFilterEdit:l})=>{const f=se(Ce),d=se(Ue),j=se(_t),E=Object.values(f),C=F.useCallback(R=>{je.toggleFilter(R)},[]),L=F.useCallback(R=>{je.removeFilter(R)},[]);F.useCallback(async R=>{try{await je.applyFilter(R)}catch(Z){console.error("Failed to apply filter:",Z)}},[]);const M=F.useCallback(async()=>{try{await je.applyAllActiveFilters()}catch(R){console.error("Failed to apply filters:",R)}},[]),z=F.useCallback(()=>{je.clearFilters()},[]),H=R=>{const Z=R.patterns&&R.patterns.length>0?R.patterns:[R.pattern];return Z.length===1?Z[0]:Z.join(" OR ")},X=R=>{const Z=R.type.charAt(0).toUpperCase()+R.type.slice(1);let ie="All columns";"scope"in R&&R.scope==="column"&&(ie=R.columnName||`Column ${(R.columnIndex||0)+1}`);const he=[];R.caseSensitive&&he.push("Case sensitive"),R.useRegex&&he.push("Regex");let ae=`${Z} in ${ie}`;return he.length>0&&(ae+=` â¢ ${he.join(", ")}`),ae};if(E.length===0)return null;const Q=E.filter(R=>R.isActive).length;return a.jsx("div",{className:`${w}`,children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:Q>0?`${Q} Active`:"No Filters"}),Q>0&&a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",onClick:M,disabled:j,className:"px-2 py-1 bg-blue-600 text-white text-xs font-medium rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Apply"}),a.jsx("button",{type:"button",onClick:z,className:"px-2 py-1 bg-gray-500 text-white text-xs font-medium rounded hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Clear"})]})]}),E.length>0&&a.jsx("div",{className:"flex items-center flex-wrap gap-2",children:E.map(R=>(d[R.id],a.jsxs("div",{className:`inline-flex items-center space-x-1 px-2 py-1 rounded-full text-xs border transition-colors ${R.isActive?"bg-blue-100 border-blue-300 text-blue-800":"bg-gray-100 border-gray-300 text-gray-600"}`,children:[a.jsx("input",{type:"checkbox",checked:R.isActive,onChange:()=>C(R.id),className:"w-3 h-3 rounded"}),a.jsx("span",{className:"truncate max-w-32",title:X(R),children:H(R)}),a.jsxs("div",{className:"flex items-center space-x-0.5",children:[l&&a.jsx("button",{type:"button",onClick:()=>l(R.id),className:"p-0.5 hover:bg-white hover:bg-opacity-50 rounded",title:"Edit filter",children:a.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),a.jsx("button",{type:"button",onClick:()=>L(R.id),className:"p-0.5 hover:bg-red-200 hover:text-red-800 rounded",title:"Remove filter",children:a.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]},R.id)))}),j&&a.jsxs("div",{className:"inline-flex items-center space-x-2 text-sm text-blue-600",children:[a.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-600"}),a.jsx("span",{children:"Applying..."})]})]})})},mi=({className:w=""})=>{const[l,f]=F.useState([]),[d,j]=F.useState(!1),[E,C]=F.useState(null),[L,M]=F.useState(!1),[z,H]=F.useState(null),X=se(Ue),Q=se(Be),R=se(rt),Z=se(kn),ie=se(We),he=se(Ce),ae=F.useMemo(()=>{if(!(Object.keys(he).length>0))return Array.from({length:ie},(V,G)=>G+1);const $=Object.values(he).filter(V=>V.isActive).map(V=>X[V.id]).filter(V=>V!==void 0);if($.length===0)return[];let I=new Set($[0].matchedLines);for(let V=1;V<$.length;V++){const G=new Set($[V].matchedLines);I=new Set([...I].filter(we=>G.has(we)))}return Array.from(I).sort((V,G)=>V-G)},[X,he,ie]),de=ae.length,ye=Math.ceil(de/Z),xe=(R-1)*Z,pe=xe+Z,oe=F.useMemo(()=>ae.slice(xe,pe),[ae,xe,pe]);F.useEffect(()=>{if(Q!=="text"||oe.length===0){f([]);return}(async()=>{j(!0),C(null);try{const I=(await be.getLinesByNumbers(oe,"text")).sort((V,G)=>V.lineNumber-G.lineNumber);f(I)}catch($){const I=$ instanceof Error?$.message:"Failed to load lines";C(I),f([])}finally{j(!1)}})()},[Q,oe]);const U=F.useCallback(async()=>{try{const I=(await be.getLinesByNumbers(ae,"text")).sort((V,G)=>V.lineNumber-G.lineNumber).map(V=>V.content).join(`
`);await navigator.clipboard.writeText(I),M(!0),setTimeout(()=>M(!1),2e3)}catch(ce){console.error("Failed to copy results:",ce)}},[ae]),te=F.useCallback(ce=>ce,[]);F.useCallback(ce=>{H(ce)},[]),F.useCallback(()=>{H(null)},[]);const ge=F.useCallback(ce=>{z!==ce&&H(ce)},[z]),ke=F.useCallback(ce=>{ce.stopPropagation()},[]),Oe=F.useCallback(ce=>{z&&H(null)},[z]);return Q!=="text"?null:de===0?a.jsx("div",{className:`${w}`,children:a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx("svg",{className:"w-12 h-12 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),a.jsx("p",{children:"No results found"}),a.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Try adjusting your filters"})]})}):a.jsx("div",{className:`${w}`,children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h3",{className:"text-sm font-medium text-gray-900",children:["Results (",de.toLocaleString()," lines)"]}),a.jsx("div",{className:"flex items-center space-x-2",children:a.jsx("button",{type:"button",onClick:U,"data-copy-results":!0,className:`
                px-3 py-1 bg-gray-600 text-white text-xs font-medium rounded
                hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500
              `,children:L?"Copied!":"Copy All"})})]}),d&&a.jsx("div",{className:"text-center py-4",children:a.jsxs("div",{className:"inline-flex items-center space-x-2 text-sm text-gray-600",children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600"}),a.jsx("span",{children:"Loading results..."})]})}),E&&a.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:a.jsx("p",{className:"text-sm text-red-700",children:E})}),!d&&!E&&l.length>0&&a.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[a.jsx("div",{className:"bg-gray-50 px-4 py-2 border-b border-gray-200",children:a.jsxs("p",{className:"text-xs text-gray-600",children:["Showing ",xe+1,"-",Math.min(pe,de)," of ",de.toLocaleString()," results"]})}),a.jsx("div",{className:"max-h-[32rem] overflow-y-auto",onClick:Oe,children:l.map(ce=>a.jsxs("div",{className:`flex border-b border-gray-100 ${z===ce.id?"bg-blue-50":"hover:bg-gray-50"}`,onClick:()=>ge(ce.id),children:[a.jsx("div",{className:"flex-shrink-0 w-16 px-3 py-2 bg-gray-50 border-r border-gray-200 text-xs text-gray-500 text-right font-mono",children:ce.lineNumber}),a.jsx("div",{className:"flex-1 px-3 py-2 text-sm font-mono",children:z===ce.id?a.jsx("textarea",{value:ce.content,readOnly:!0,onClick:ke,className:"w-full h-24 p-2 text-sm font-mono border border-blue-300 rounded resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 bg-blue-50"}):a.jsx("pre",{className:"whitespace-pre-wrap break-words max-h-20 overflow-hidden cursor-pointer hover:bg-gray-50 rounded p-1 -m-1",children:te(ce.content)})})]},ce.id))})]}),ye>1&&a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("p",{className:"text-sm text-gray-700",children:["Page ",R," of ",ye]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx("button",{type:"button",onClick:()=>je.setPage(R-1),disabled:R<=1,className:`
                  px-3 py-1 border border-gray-300 text-sm rounded
                  hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500
                  disabled:opacity-50 disabled:cursor-not-allowed
                `,children:"Previous"}),a.jsx("button",{type:"button",onClick:()=>je.setPage(R+1),disabled:R>=ye,className:`
                  px-3 py-1 border border-gray-300 text-sm rounded
                  hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500
                  disabled:opacity-50 disabled:cursor-not-allowed
                `,children:"Next"})]})]})]})})},yi=({className:w=""})=>{const[l,f]=F.useState([]),[d,j]=F.useState(!1),[E,C]=F.useState(null),[L,M]=F.useState(!1),[z,H]=F.useState(null),X=se(Ue),Q=se(Be),R=se(Ge),Z=se(rt),ie=se(kn),he=se(We),ae=se(Ce),de=F.useMemo(()=>{if(!(Object.keys(ae).length>0))return Array.from({length:he},(G,we)=>we+1);const I=Object.values(ae).filter(G=>G.isActive).map(G=>X[G.id]).filter(G=>G!==void 0);if(I.length===0)return[];let V=new Set(I[0].matchedLines);for(let G=1;G<I.length;G++){const we=new Set(I[G].matchedLines);V=new Set([...V].filter(Ke=>we.has(Ke)))}return Array.from(V).sort((G,we)=>G-we)},[X,ae,he]),ye=de.length,xe=Math.ceil(ye/ie),pe=(Z-1)*ie,oe=pe+ie,U=F.useMemo(()=>de.slice(pe,oe),[de,pe,oe]);F.useEffect(()=>{if(Q!=="csv"||U.length===0){f([]);return}(async()=>{j(!0),C(null);try{const V=(await be.getLinesByNumbers(U,"csv")).sort((G,we)=>G.lineNumber-we.lineNumber);f(V)}catch(I){const V=I instanceof Error?I.message:"Failed to load lines";C(V),f([])}finally{j(!1)}})()},[Q,U]);const te=F.useCallback(async()=>{try{const I=(await be.getLinesByNumbers(de,"csv")).sort((G,we)=>G.lineNumber-we.lineNumber);let V="";R.length>0&&(V+=R.join(",")+`
`),V+=I.map(G=>G.originalContent).join(`
`),await navigator.clipboard.writeText(V),M(!0),setTimeout(()=>M(!1),2e3)}catch($){console.error("Failed to copy results:",$)}},[de,R]),ge=R;F.useCallback($=>{H($)},[]),F.useCallback(()=>{H(null)},[]);const ke=F.useCallback(($,I)=>{I.stopPropagation(),z!==$&&H($)},[z]),Oe=F.useCallback($=>{$.stopPropagation()},[]),ce=F.useCallback(()=>{z&&H(null)},[z]);return Q!=="csv"?null:ye===0?a.jsx("div",{className:`${w}`,children:a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx("svg",{className:"w-12 h-12 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),a.jsx("p",{children:"No results found"}),a.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Try adjusting your filters"})]})}):a.jsx("div",{className:`${w}`,children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h3",{className:"text-sm font-medium text-gray-900",children:["CSV Results (",ye.toLocaleString()," rows)"]}),a.jsx("div",{className:"flex items-center space-x-2",children:a.jsx("button",{type:"button",onClick:te,"data-copy-results":!0,className:`
                px-3 py-1 bg-gray-600 text-white text-xs font-medium rounded
                hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500
              `,children:L?"Copied!":"Copy CSV"})})]}),d&&a.jsx("div",{className:"text-center py-4",children:a.jsxs("div",{className:"inline-flex items-center space-x-2 text-sm text-gray-600",children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600"}),a.jsx("span",{children:"Loading results..."})]})}),E&&a.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:a.jsx("p",{className:"text-sm text-red-700",children:E})}),!d&&!E&&l.length>0&&a.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[a.jsx("div",{className:"bg-gray-50 px-4 py-2 border-b border-gray-200",children:a.jsxs("p",{className:"text-xs text-gray-600",children:["Showing ",pe+1,"-",Math.min(oe,ye)," of ",ye.toLocaleString()," results",R.length>1&&` (${R.length} columns)`]})}),a.jsx("div",{className:"overflow-x-auto max-h-[32rem] overflow-y-auto",onClick:ce,children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50 sticky top-0",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200",children:"Line"}),ge.map(($,I)=>a.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200 last:border-r-0",children:a.jsx("div",{className:"truncate max-w-32",title:$||`Column ${I+1}`,children:$||`Column ${I+1}`})},I))]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map($=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-xs text-gray-500 font-mono border-r border-gray-200",children:$.lineNumber}),ge.map((I,V)=>{const G=$.data[V]||"",we=`${$.id}-${V}`,Ke=z===we;return a.jsx("td",{className:`px-3 py-2 text-sm text-gray-900 border-r border-gray-200 last:border-r-0 ${Ke?"bg-blue-50":""}`,onClick:st=>ke(we,st),children:Ke?a.jsx("textarea",{value:G,readOnly:!0,onClick:Oe,className:"w-full h-16 p-2 text-xs font-mono border border-blue-300 rounded resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 bg-blue-50"}):a.jsx("div",{className:"max-w-32 truncate cursor-pointer hover:bg-gray-50 rounded p-1 -m-1",title:G,children:G})},V)})]},$.id))})]})})]}),xe>1&&a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("p",{className:"text-sm text-gray-700",children:["Page ",Z," of ",xe]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx("button",{type:"button",onClick:()=>je.setPage(Z-1),disabled:Z<=1,className:`
                  px-3 py-1 border border-gray-300 text-sm rounded
                  hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500
                  disabled:opacity-50 disabled:cursor-not-allowed
                `,children:"Previous"}),a.jsx("button",{type:"button",onClick:()=>je.setPage(Z+1),disabled:Z>=xe,className:`
                  px-3 py-1 border border-gray-300 text-sm rounded
                  hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500
                  disabled:opacity-50 disabled:cursor-not-allowed
                `,children:"Next"})]})]})]})})},gi=({className:w=""})=>{const l=se(Te),f=se(Se),d=se(Me),j=se(_t),E=l!=="idle"&&l!=="complete"&&l!=="error",C=E||j;if(!C&&!d)return null;const L=()=>{if(j)return"Filtering data...";switch(l){case"uploading":return"Uploading file...";case"parsing":return"Processing file...";case"complete":return"Complete";case"error":return"Error occurred";default:return"Processing..."}},M=()=>d?"bg-red-500":l==="complete"?"bg-green-500":"bg-blue-500";return a.jsxs("div",{className:`${w}`,children:[C&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:L()}),a.jsxs("span",{className:"text-sm text-gray-500",children:[Math.round(f),"%"]})]}),a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:a.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${M()}`,style:{width:`${f}%`},children:E&&a.jsx("div",{className:"h-full bg-white bg-opacity-30 animate-pulse"})})}),(E||j)&&f===0&&a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:a.jsx("div",{className:"h-2 bg-blue-500 rounded-full animate-pulse"})})]}),d&&a.jsx("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded-md",children:a.jsxs("div",{className:"flex items-start",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("svg",{className:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.96-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),a.jsxs("div",{className:"ml-3",children:[a.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Processing Error"}),a.jsx("p",{className:"mt-1 text-sm text-red-700",children:d})]})]})})]})},vi=({isOpen:w,onClose:l})=>{if(!w)return null;const f=It.getShortcuts().filter(d=>d.description.toLowerCase().includes("filter")||d.description.toLowerCase().includes("copy")||d.description.toLowerCase().includes("clear"));return a.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:a.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[a.jsx("div",{className:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75",onClick:l}),a.jsxs("div",{className:"inline-block w-full max-w-2xl p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-lg",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Line Filter Tool - Help"}),a.jsx("button",{type:"button",onClick:l,className:"text-gray-400 hover:text-gray-600 focus:outline-none",children:a.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Overview"}),a.jsx("p",{className:"text-sm text-gray-600",children:"The Line Filter Tool helps you efficiently filter and search through large text files and CSV data. Upload files or paste text, then use include/exclude filters to find exactly what you need."})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Features"}),a.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[a.jsxs("li",{children:["â¢ ",a.jsx("strong",{children:"File Support:"})," .txt, .csv, .tsv, .log files up to 5MB and 10,000 lines"]}),a.jsxs("li",{children:["â¢ ",a.jsx("strong",{children:"Text Paste:"})," Paste content directly from clipboard"]}),a.jsxs("li",{children:["â¢ ",a.jsx("strong",{children:"Auto-Detection:"})," Automatically detects CSV format and headers"]}),a.jsxs("li",{children:["â¢ ",a.jsx("strong",{children:"Pattern Matching:"})," Include or exclude lines based on patterns"]}),a.jsxs("li",{children:["â¢ ",a.jsx("strong",{children:"Regex Support:"})," Use regular expressions for complex patterns"]}),a.jsxs("li",{children:["â¢ ",a.jsx("strong",{children:"CSV Filtering:"})," Filter by specific columns or search all data"]}),a.jsxs("li",{children:["â¢ ",a.jsx("strong",{children:"Export Results:"})," Copy filtered results to clipboard"]})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Filter Types"}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-gray-900",children:"Include Filters:"}),a.jsx("span",{className:"text-gray-600 ml-1",children:"Show only lines that match the pattern"})]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-gray-900",children:"Exclude Filters:"}),a.jsx("span",{className:"text-gray-600 ml-1",children:"Hide lines that match the pattern"})]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-gray-900",children:"Column Filters (CSV):"}),a.jsx("span",{className:"text-gray-600 ml-1",children:"Filter specific columns in CSV data"})]})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Regex Examples"}),a.jsxs("div",{className:"bg-gray-50 rounded p-3 text-sm space-y-1",children:[a.jsxs("div",{children:[a.jsx("code",{className:"bg-white px-1 rounded",children:"^ERROR"}),' - Lines starting with "ERROR"']}),a.jsxs("div",{children:[a.jsxs("code",{className:"bg-white px-1 rounded",children:["\\d",4,"-\\d",2,"-\\d",2]})," - Date patterns (YYYY-MM-DD)"]}),a.jsxs("div",{children:[a.jsx("code",{className:"bg-white px-1 rounded",children:"\\b\\w+@\\w+\\.\\w+\\b"})," - Email addresses"]}),a.jsxs("div",{children:[a.jsx("code",{className:"bg-white px-1 rounded",children:"failed|error|exception"})," - Multiple keywords"]}),a.jsxs("div",{children:[a.jsx("code",{className:"bg-white px-1 rounded",children:"^\\s*$"})," - Empty lines"]})]})]}),f.length>0&&a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Keyboard Shortcuts"}),a.jsxs("div",{className:"space-y-1",children:[f.map(d=>a.jsxs("div",{className:"flex justify-between items-center text-sm",children:[a.jsx("span",{className:"text-gray-600",children:d.description}),a.jsx("kbd",{className:"bg-gray-100 px-2 py-1 rounded text-xs font-mono",children:It.formatShortcut(d.id)})]},d.id)),a.jsxs("div",{className:"flex justify-between items-center text-sm",children:[a.jsx("span",{className:"text-gray-600",children:"Add filter quickly"}),a.jsx("kbd",{className:"bg-gray-100 px-2 py-1 rounded text-xs font-mono",children:"â+Enter"})]})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Tips"}),a.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[a.jsx("li",{children:"â¢ Use multiple filters to narrow down results progressively"}),a.jsx("li",{children:"â¢ CSV headers are auto-detected, but you can toggle header detection"}),a.jsx("li",{children:"â¢ Case-sensitive matching is available for precise filtering"}),a.jsx("li",{children:"â¢ Large files are processed in chunks to keep the UI responsive"}),a.jsx("li",{children:"â¢ All processing happens locally in your browser for privacy"})]})]})]}),a.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:a.jsx("button",{type:"button",onClick:l,className:`
                w-full px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md
                hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500
              `,children:"Got it"})})]})]})})},Ai=({className:w=""})=>{const l=se(Be),f=se(Dr),[d,j]=ss.useState(!1),[E,C]=ss.useState(null),L=F.useCallback(async()=>{try{await je.clearAllData()}catch(H){console.error("Failed to clear data:",H)}},[]);F.useEffect(()=>{oi().catch(console.error);const H=[It.register({key:"Escape",description:"Clear all data and filters",handler:X=>{X.preventDefault(),Dr.get()&&L()}}),It.register({key:"c",metaKey:!0,shiftKey:!0,description:"Copy filtered results to clipboard",handler:X=>{X.preventDefault();const Q=document.querySelector("[data-copy-results]");Q&&Q.click()}}),It.register({key:"Enter",metaKey:!0,shiftKey:!0,description:"Apply all active filters",handler:X=>{X.preventDefault(),Dr.get()&&je.applyAllActiveFilters().catch(console.error)}})];return()=>{H.forEach(X=>It.unregister(X))}},[]);const M=F.useCallback(H=>{C(H)},[]),z=F.useCallback(()=>{C(null)},[]);return a.jsx("div",{className:`${w}`,children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Line Filter Tool"}),a.jsx("button",{type:"button",onClick:()=>j(!0),className:`
                p-2 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded
              `,title:"Help",children:a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),a.jsx("p",{className:"text-gray-600",children:"Filter and search through large text files and CSV data efficiently"})]}),a.jsx("div",{className:"mb-6",children:a.jsx(gi,{})}),f?a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Filters"}),a.jsx(di,{})]}),a.jsx("button",{type:"button",onClick:L,className:"px-3 py-1.5 bg-red-600 text-white text-sm font-medium rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 flex-shrink-0",children:"Clear Data"})]}),a.jsx("div",{className:"px-4 py-3 border-b border-gray-100",children:a.jsx("div",{className:"flex items-center space-x-4",children:a.jsx("div",{className:"flex-1 min-w-0",children:l==="csv"?a.jsx(hi,{editingFilterId:E,onEditComplete:z}):a.jsx(fi,{editingFilterId:E,onEditComplete:z})})})}),a.jsx("div",{className:"px-4 py-2",children:a.jsx(pi,{onFilterEdit:M})})]}),a.jsx("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm",children:a.jsx("div",{className:"p-6",children:l==="csv"?a.jsx(yi,{}):a.jsx(mi,{})})})]}):a.jsx(ui,{}),a.jsx("div",{className:"mt-12 pt-6 border-t border-gray-200",children:a.jsx("div",{className:"text-center text-sm text-gray-500",children:a.jsxs("p",{children:["Part of"," ",a.jsx("a",{href:"/",className:"text-blue-600 hover:text-blue-700 font-medium",children:"Devsgen"})," ","developer utilities"]})})}),a.jsx(vi,{isOpen:d,onClose:()=>j(!1)})]})})};export{Ai as default};
