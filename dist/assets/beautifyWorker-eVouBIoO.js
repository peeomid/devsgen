(function(){"use strict";class v{static format(t,i="  "){let e="",n=0,l=!1,o=!1,s=!1;const h=new Set(["{","[","("]),c=new Set(["}","]",")"]),r=()=>{e+=`
`+i.repeat(n)};for(let f=0;f<t.length;f++){const u=t[f];if(s){e+=u,s=!1;continue}if(u==="\\"){e+=u,(l||o)&&(s=!0);continue}if(!o&&u==="'"&&!l){l=!0,e+=u;continue}else if(l&&u==="'"){l=!1,e+=u;continue}if(!l&&u==='"'&&!o){o=!0,e+=u;continue}else if(o&&u==='"'){o=!1,e+=u;continue}if(l||o){e+=u;continue}if(h.has(u)){if(u==="{"){let m=e.substring(Math.max(0,e.length-30));m.includes("function ")&&m.endsWith(")")&&(e+=" ")}e+=u,n++;let g=f+1;for(;g<t.length&&/\s/.test(t[g]);)g++;if(!(g<t.length&&c.has(t[g]))){let m=!0;if(u==="("){let E=e.trim();/\b(int|string|float|bool|array|object|resource|NULL)\s*$/.test(E),m=!1}if(u==="["&&(m=this.shouldIndentArray(t,f)),u==="{"){let E=e.substring(Math.max(0,e.length-50));E.includes("function ")&&(E.endsWith(")")||E.endsWith(") "))?m=!1:m=!0}m&&r()}continue}if(c.has(u)){n=Math.max(0,n-1);let g=!1;if(u===")"){let y=e.substring(Math.max(0,e.length-50));/\b(int|string|float|bool|array|object|resource|NULL)\s*\([^)]*$/.test(y)&&(g=!0)}let m="";for(let y=e.length-1;y>=0;y--)if(!/\s/.test(e[y])){m=e[y];break}this.shouldIndentClosingBracket(e,u,m,g)&&(e+=`
`+i.repeat(n)),e+=u;continue}if(u===","){e+=u;let g=f+1;for(;g<t.length&&/\s/.test(t[g]);)g++;if(g<t.length&&(t[g]==="}"||t[g]==="]"||t[g]===")"))continue;this.shouldBreakAfterComma(t,f,n)?r():e+=" ";continue}if(u===";"){e+=u;let g=f+1;for(;g<t.length&&/\s/.test(t[g]);)g++;g<t.length&&n===0&&(e+=`

`);continue}if((u==="+"||u==="-"||u==="*"||u==="/"||u==="=")&&!l&&!o&&(u==="="||n>0)&&!(u==="="&&f+1<t.length&&t[f+1]===">")){if(e.length>0&&!e.endsWith(" ")&&!e.endsWith(`
`)){const g=e[e.length-1];/[a-zA-Z0-9_$)]/.test(g)&&(e+=" ")}e+=u,f+1<t.length&&!/\s/.test(t[f+1])&&(e+=" ");continue}if(u===":"||u==="="&&f+1<t.length&&t[f+1]===">"){if(u==="="&&t[f+1]===">"){const g=e[e.length-1];g&&g!==" "&&g!==`
`&&(e+=" "),e+="=>",e+=" ",f++}else e+=": ";continue}if(u===`
`){let g=f+1,m=1;for(;g<t.length&&t[g]===`
`;)m++,g++;m>=2?(e.endsWith(`
`)?e.endsWith(`

`)||(e+=`
`):e+=`

`,f=g-1):e.endsWith(`
`)||(e+=`
`,n>0&&(e+=i.repeat(n)));continue}if(!/\s/.test(u))e+=u;else if(u===" "){if(e.endsWith(`
`)){n===0&&(e+=u);continue}if(!e.endsWith(" ")){const g=e[e.length-1],m=f+1<t.length?t[f+1]:"";if(h.has(g)||c.has(m))continue;e+=u}}}return e}static shouldBreakAfterComma(t,i,e){let n="",l=0,o=!1,s="";for(let h=i-1;h>=0;h--){const c=t[h];if(!o&&(c==='"'||c==="'")){o=!0,s=c;continue}if(o&&c===s&&t[h-1]!=="\\"){o=!1,s="";continue}if(!o){if(c===")"||c==="]"||c==="}")l++;else if(c==="("||c==="["||c==="{"){if(l===0){n=c;break}l--}}}return!(n==="("||n==="[")}static shouldIndentArray(t,i){let e=0,n=!1,l="",o=0,s=!1;for(let h=i+1;h<t.length;h++){const c=t[h];if(!n&&(c==='"'||c==="'")){n=!0,l=c,o++;continue}if(n&&c===l&&t[h-1]!=="\\"){n=!1,l="",o++;continue}if(n){o++;continue}if(c==="["||c==="("||c==="{")e++,s=!0,o++;else if(c==="]"||c===")"||c==="}"){if(e===0&&c==="]")break;e--,o++}else c!==" "&&c!=="	"&&c!==`
`&&o++}return s&&o>30}static addMissingSemicolons(t){const i=t.split(`
`),e=[];for(let n=0;n<i.length;n++){let l=i[n];const o=l.trim();if(!o||o.endsWith(";")||o.endsWith("{")||o.endsWith("}")){e.push(l);continue}/^[\s]*(const|let|var|return)\s/.test(o)&&!o.endsWith("{")&&(l=l.trimRight()+";"),e.push(l)}return e.join(`
`)}static shouldIndentClosingBracket(t,i,e,n){if(n||e==="{"||e==="["||e==="(")return!1;if(i===")"){const l=t.substring(Math.max(0,t.length-50)),o=l.lastIndexOf(`
`);if(o===-1)return!1;const s=l.substring(o+1);if(s.trim().length<50&&!s.includes(`
`))return!1}if(i==="]"){const l=t.substring(Math.max(0,t.length-30)),o=l.lastIndexOf(`
`);if(o===-1||l.substring(o+1).trim().length<30)return!1}return!0}}function S(a){const t=a.trim();if(!t)return"unknown";try{return JSON.parse(t),"json"}catch{}return/\b(select|with)\b[\s\S]*\bfrom\b/i.test(t)||/\b(insert\s+into|update\s+\w+\s+set|delete\s+from|create\s+table|alter\s+table|drop\s+table)\b/i.test(t)?"sql":/^\s*[\w-]+\s*:\s*\{[^};]+\}\s*$/m.test(t)?"yaml":/{[^}]*;[^}]*}/m.test(t)?"css":/^\s*<\?xml\b/.test(t)||/<\w+[^>]*\/>/.test(t)?"xml":/<!DOCTYPE\s+html/i.test(t)||/<\s*(html|body|div|span|ul|li|p|head|meta|link|script)\b/i.test(t)?"html":!/[{}<>]/.test(t)&&/\n/.test(t)&&/^(\s*[-\w]+\s*:\s*.+)$/m.test(t)?"yaml":/\barray\s*\(/i.test(t)||/=>/.test(t)||/\[\s*[^\]]*=>/m.test(t)?/=>\s*(string|int|float|array|object)\s*\(/i.test(t)||/\[\s*"?.+?"?\]\s*=>/m.test(t)?"phpVarDump":"phpArray":/(^|[\s\[{(])'(?:[^'\\]|\\.)*'/.test(t)||/\b(True|False|None)\b/.test(t)||/\((?:[^()]*,)[^()]*\)/.test(t)?"pythonRepr":/\/\/|#/.test(t)||/,\s*[\]}]/.test(t)||/(^|[^\\])'(?:[^'\\]|\\.)*'/.test(t)?"jsonish":"unknown"}function N(a,t="  "){const i=new Set(["SELECT","FROM","WHERE","JOIN","INNER","LEFT","RIGHT","FULL","OUTER","CROSS","ON","AS","AND","OR","GROUP","BY","ORDER","HAVING","LIMIT","OFFSET","UNION","ALL","DISTINCT","WITH","INSERT","INTO","VALUES","UPDATE","SET","DELETE","CREATE","TABLE"]),e=[];let n=0;const l=a;let o=!1,s=!1;for(;n<l.length;){const p=l[n];if(o){let d="'";for(n++;n<l.length;){const b=l[n++];if(d+=b,b==="'"&&l[n-2]!=="\\"){o=!1;break}}e.push({v:d,t:"string"});continue}if(s){let d='"';for(n++;n<l.length;){const b=l[n++];if(d+=b,b==='"'&&l[n-2]!=="\\"){s=!1;break}}e.push({v:d,t:"string"});continue}if(p==="'"){o=!0;continue}if(p==='"'){s=!0;continue}if(/\s/.test(p)){let d=n;for(;d<l.length&&/\s/.test(l[d]);)d++;e.push({v:" ",t:"space"}),n=d;continue}if(/[A-Za-z0-9_\.]/.test(p)){let d=n;for(;d<l.length&&/[A-Za-z0-9_\.]/.test(l[d]);)d++;e.push({v:l.slice(n,d),t:"word"}),n=d;continue}e.push({v:p,t:"symbol"}),n++}function h(p,d){return p&&p.t==="word"&&(!d||p.v.toUpperCase()===d)}function c(p){return p.t==="word"&&i.has(p.v.toUpperCase())?{...p,v:p.v.toUpperCase()}:p}for(let p=0;p<e.length;p++)e[p]=c(e[p]);let r="",f=0,u=!1,g=null,m="OTHER";const E=(p=f)=>{r+=`
`+t.repeat(p)},y=(p,d)=>h(e[p],d),$=()=>{for(;r.endsWith(" ");)r=r.slice(0,-1)};for(let p=0;p<e.length;p++)e[p],y(p,"GROUP")&&y(p+2,"BY")&&(e[p].v="GROUP BY",e[p+1]={v:" ",t:"space"},e[p+2]={v:"",t:"space"}),y(p,"ORDER")&&y(p+2,"BY")&&(e[p].v="ORDER BY",e[p+1]={v:" ",t:"space"},e[p+2]={v:"",t:"space"});for(let p=0;p<e.length;p++){const d=e[p],b=d.v;if(d.t==="space"){if(u)continue;!r.endsWith(" ")&&!r.endsWith(`
`)&&(r+=" ");continue}if(d.t==="word"){const w=b.toUpperCase();if(w==="SELECT"){r.trim()&&($(),E(0)),r+="SELECT",m="SELECT",f=1,u=!0,g=1;continue}if(w==="FROM"){$(),E(0),r+="FROM",m="FROM",f=1,u=!0,g=1;continue}if(w==="WHERE"){$(),E(0),r+="WHERE",m="WHERE",f=1,u=!0,g=1;continue}if(w==="GROUP BY"){$(),E(0),r+="GROUP BY",m="GROUP BY",f=1,u=!0,g=1;continue}if(w==="ORDER BY"){$(),E(0),r+="ORDER BY",m="ORDER BY",f=1,u=!0,g=1;continue}if(w==="LIMIT"||w==="OFFSET"){$(),E(0),r+=w,m="OTHER",f=1,u=!0,g=1;continue}if(w==="JOIN"||w==="INNER"||w==="LEFT"||w==="RIGHT"||w==="FULL"||w==="CROSS"||w==="OUTER"){const I=e.slice(p,p+4).map(C=>C.v.toUpperCase()).join(" ");if(/\b(INNER|LEFT|RIGHT|FULL|CROSS|OUTER)?\s*JOIN\b/.test(I)){$(),E(0),r+=w,m="JOIN",u=!0,g=1;continue}}if(w==="ON"){$(),E(0),r+="ON",m="JOIN",u=!0,g=1;continue}if(u){for(;r.endsWith(" ");)r=r.slice(0,-1);E(g??f),u=!1,g=null}!r.endsWith(" ")&&!r.endsWith(`
`)&&(r+=" "),r+=b;continue}if(d.t==="symbol"){const w=b;if(w===","){r+=",",m==="SELECT"||m==="ORDER BY"||m==="GROUP BY"?E(f):r+=" ";continue}if(w==="("||w==="["){r+=w,f++,E(f);continue}if(w===")"||w==="]"){f=Math.max(0,f-1),E(f),r+=w;continue}if(w===";"){r+=";",E(0);continue}if(/=|<|>|!/.test(w)){!r.endsWith(" ")&&!r.endsWith(`
`)&&(r+=" "),r+=w,r+=" ";continue}r+=w;continue}if(d.t==="string"){!r.endsWith(" ")&&!r.endsWith(`
`)&&(r+=" "),r+=d.v;continue}}return r.endsWith(`
`)||(r+=`
`),r}function L(a,t="  "){let i="",e=0,n=0;const l=a.trim(),o=()=>{i+=`
`+t.repeat(e)};for(;n<l.length;){const s=l[n];if(s==="{"){i=i.trimEnd(),i+=" {",e++,o(),n++;continue}if(s==="}"){i=i.trimEnd();const h=(()=>{for(let c=i.length-1;c>=0;c--){const r=i[c];if(!/\s/.test(r))return r}return""})();for(h&&h!==";"&&h!=="{"&&h!=="}"&&(i+=";"),i.endsWith(`
`)||(i+=`
`),e=Math.max(0,e-1),i+=t.repeat(e)+"}",n+1<l.length&&(i+=`
`),n++;n<l.length&&/\s/.test(l[n]);)n++;continue}if(s===";"){for(i=i.trimEnd(),i+=`;
`,i+=t.repeat(e),n++;n<l.length&&/\s/.test(l[n]);)n++;continue}if(s===":"){for(i=i.trimEnd(),i+=": ",n++;n<l.length&&l[n]===" ";)n++;continue}if(/\s/.test(s)){!i.endsWith(" ")&&!i.endsWith(`
`)&&(i+=" "),n++;continue}i+=s,n++}return i.endsWith(`
`)||(i+=`
`),i}const B=new Set(["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"]);function M(a){const t=[],i=/(\w[\w:-]*)\s*=\s*("[^"]*"|'[^']*'|[^\s>]+)/g;let e;for(;e=i.exec(a);){const n=e[1],l=e[2];t.push(`${n}=${l}`)}return t.join(" ")}function A(a,t="  "){const i=[];let e=0;const n=/<[^>]+>/g;let l;for(;l=n.exec(a);){const c=l.index;if(c>e){const r=a.slice(e,c);i.push({type:"text",value:r})}i.push({type:"tag",value:l[0]}),e=n.lastIndex}e<a.length&&i.push({type:"text",value:a.slice(e)});let o=0,s="";function h(c=o){s+=`
`+t.repeat(c)}for(let c=0;c<i.length;c++){const r=i[c];if(r.type==="text"){const C=r.value.replace(/\s+/g," ").trim();if(!C)continue;s.endsWith(`
`)||(s+=" "),s+=C;continue}const f=r.value,u=/^<\//.test(f);if(/^<!--/.test(f)){h(),s+=f;continue}const m=/^<\/?\s*([a-zA-Z0-9:-]+)/.exec(f),E=m?m[1].toLowerCase():"",y=/\/>$/.test(f)||B.has(E);if(u){o=Math.max(0,o-1),h(o),s+=`</${E}>`;continue}const $=f.replace(/^<\s*[a-zA-Z0-9:-]+\s*|\/?\s*>$/g,""),p=$?M($):"",d=i[c+1],b=i[c+2],w=d&&d.type==="text"&&d.value.trim().length>0&&!/<|>/.test(d.value),I=b&&b.type==="tag"&&new RegExp(`^</s*${E}[^>]*>`).test(b.value);if(!s.endsWith(`
`)&&s.length>0&&h(),s+=`<${E}${p?" "+p:""}>`,!y){if(w&&I){s+=d.value.trim(),s+=`</${E}>`,c+=2;continue}o++}}return s.endsWith(`
`)||(s+=`
`),s}function D(a){const t=[],i=/(\w[\w:-]*)\s*=\s*("[^"]*"|'[^']*'|[^\s>]+)/g;let e;for(;e=i.exec(a);){const n=e[1],l=e[2];t.push(`${n}=${l}`)}return t.join(" ")}function U(a,t="  "){const i=[];let e=0;const n=/<[^>]+>/g;let l;for(;l=n.exec(a);){const f=l.index;if(f>e){const u=a.slice(e,f);i.push({type:"text",value:u})}i.push({type:"tag",value:l[0]}),e=n.lastIndex}e<a.length&&i.push({type:"text",value:a.slice(e)});let o=0,s="";const h=[];let c=!1;const r=(f=o)=>{s+=`
`+t.repeat(f)};for(let f=0;f<i.length;f++){const u=i[f];if(u.type==="text"){const b=u.value.replace(/\s+/g," ").trim();if(!b)continue;s+=b,c=!0;continue}const g=u.value,m=/^<\//.test(g),E=/^<\?xml/.test(g)||/^<!--/.test(g),y=/\/>$/.test(g);if(E){!s.endsWith(`
`)&&s.length&&r(0),s+=g,c=!1;continue}if(m){o=Math.max(0,o-1);const b=/^<\s*\/\s*([\w:-]+)/.exec(g)?.[1]||"";h[h.length-1]===b&&c&&!s.endsWith(`
`)?s+=`</${b}>`:(r(o),s+=`</${b}>`),h.length&&h.pop(),c=!1;continue}const $=/^<\s*([\w:-]+)/.exec(g)?.[1]||"",p=g.replace(/^<\s*[\w:-]+\s*|\/?\s*>$/g,""),d=p?D(p):"";!s.endsWith(`
`)&&s.length&&r(),s+=`<${$}${d?" "+d:""}${y?" /":""}>`,y||(o++,h.push($)),c=!1}return s.endsWith(`
`)||(s+=`
`),s}function j(a){const t=[];let i=0,e="",n="",l=!0,o=!1,s=!1,h=!1;const c=()=>{const r=e.trim(),f=n.trim();r&&t.push([r,f]),e="",n="",l=!0};for(;i<a.length;){const r=a[i++];if(h){l?e+=r:n+=r,h=!1;continue}if(r==="\\"){l?e+=r:n+=r,h=!0;continue}if(r==='"'&&!o){l?e+=r:n+=r,s=!s;continue}if(r==="'"&&!s){l?e+=r:n+=r,o=!o;continue}if(!o&&!s){if(r===":"&&l){l=!1;continue}if(r===","){c();continue}}l?e+=r:n+=r}return c(),t}function F(a,t="  "){const i=a.split(/\r?\n/),e=[];for(const n of i){const l=/^\s*([A-Za-z0-9_-]+)\s*:\s*\{([^}]*)\}\s*$/.exec(n);if(l){const o=l[1],s=l[2];e.push(`${o}:`);const h=j(s);for(const[c,r]of h)e.push(`${t}${c.trim()}: ${r.trim()}`)}else e.push(n)}return e.join(`
`)+`
`}function Y(a,t){if(!a.includes("array(")||!a.includes("=>"))return a;let i=a;i=i.replace(/array\s*\(\s*(\d+)\s*\)\s*\{/g,"array($1) {"),i=i.replace(/([^\s])=>/g,"$1 =>"),i=i.replace(/=>([^\s])/g,"=> $1"),i=i.replace(/(string\(\d+\))"([^"]*)"/g,'$1 "$2"'),i=i.replace(/(\]\s*=>\s*[^[}]+)(\[)/g,`$1
$2`),i=i.replace(/(\{)([^}\n])/g,`$1
$2`),i=i.replace(/([^{\n])(\})/g,`$1
$2`),i=i.replace(/(\})(\})/g,`$1
$2`);const e=i.split(`
`),n=[];let l=0;for(let o=0;o<e.length;o++){let s=e[o].trim();if(!s)continue;if(s.match(/^array\(\d+\)$/)&&o+1<e.length&&e[o+1].trim()==="{"){s=s+" {",o++,l++,n.push(t.repeat(Math.max(0,l-1))+s);continue}if(s==="}"){l=Math.max(0,l-1),n.push(t.repeat(l)+s);continue}if(/\]\s*=>\s*$/.test(s)&&o+1<e.length){const r=e[o+1].trim();if(/^(int\(|string\(|float\(|bool\(|object\(|array\(\d+\)|resource\()/.test(r)&&(s=`${s} ${r}`,o++,(/array\(\d+\)\s*$/.test(s)||/object\([^)]*\)\s*#?\d*\s*\(\d+\)\s*$/.test(s))&&o+1<e.length&&e[o+1].trim()==="{")){s+=" {",o++,n.push(t.repeat(l)+s),l++;continue}}n.push(t.repeat(l)+s);const h=(s.match(/\{/g)||[]).length,c=(s.match(/\}/g)||[]).length;l+=h-c,l=Math.max(0,l)}return n.join(`
`)}function T(a,t){const i=typeof performance<"u"?performance.now():Date.now();try{const e=t.useTabs?"	":" ".repeat(t.indent),n=S(a),l=P(a);let o;return n==="phpVarDump"?o=Y(a,e):n==="sql"?o=N(a,e):n==="css"?o=L(a,e):n==="html"?o=A(a,e):n==="xml"?o=U(a,e):n==="yaml"?o=F(a,e):o=v.format(a,e),n!=="phpVarDump"&&(o=H(o),o=G(o)),/(^|\n)\s*(def|class)\b.*:\s*$/m.test(a)&&(o=z(o,e)),o&&!o.endsWith(`
`)&&(o+=`
`),{output:o,diagnostics:l,timeMs:(typeof performance<"u"?performance.now():Date.now())-i}}catch(e){return{output:a,diagnostics:{warnings:[`Formatting error: ${e instanceof Error?e.message:String(e)}`]},timeMs:(typeof performance<"u"?performance.now():Date.now())-i}}}function P(a){const t=[];let i=!1;const e=[],n={"(":")","[":"]","{":"}"},l=new Set(["(","[","{"]),o=new Set([")","]","}"]);let s=!1,h="",c=!1;for(let r=0;r<a.length;r++){const f=a[r];if(c){c=!1;continue}if(f==="\\"){c=!0;continue}if(!s&&(f==='"'||f==="'")){s=!0,h=f;continue}if(s&&f===h){s=!1,h="";continue}if(!s){if(l.has(f))e.push(f);else if(o.has(f))if(e.length===0)i=!0,t.push(`Unexpected closing bracket: ${f} at position ${r}`);else{const u=e.pop();n[u]!==f&&(i=!0,t.push(`Mismatched brackets: ${u} closed with ${f} at position ${r}`))}}}return e.length>0&&(i=!0,t.push(`Unclosed brackets: ${e.join(", ")}`)),{warnings:t,unbalancedBrackets:i}}function H(a){let t="",i=0,e=!1,n=!1,l=!1;for(let o=0;o<a.length;o++){const s=a[o];if(l){t+=s,l=!1;continue}if((e||n)&&s==="\\"){t+=s,l=!0;continue}if(!n&&s==="'"&&!e){e=!0,t+=s;continue}if(e&&s==="'"){e=!1,t+=s;continue}if(!e&&s==='"'&&!n){n=!0,t+=s;continue}if(n&&s==='"'){n=!1,t+=s;continue}if(e||n){t+=s;continue}const h=s==="{"||s==="["||s==="(";if(s==="}"||s==="]"||s===")"){t+=s,i=Math.max(0,i-1);let r=o+1;for(;r<a.length&&/\s/.test(a[r]);)r++;if(i===0&&r<a.length){const f=a[r];(f==="{"||f==="["||f==="(")&&!(s===")"&&t.includes("function ")&&t.substring(t.lastIndexOf("function ")).includes("("))&&!t.endsWith(`
`)&&(t+=`
`)}continue}if(h){i++,t+=s;continue}t+=s}return t}function G(a){let t="",i=0,e=!1,n=!1,l=!1;const o=s=>/[A-Za-z_$]/.test(s);for(;i<a.length;){const s=a[i];if(t+=s,l){l=!1,i++;continue}if((e||n)&&s==="\\"){l=!0,i++;continue}if(!n&&s==="'"&&!e){e=!0,i++;continue}if(e&&s==="'"){e=!1,i++;continue}if(!e&&s==='"'&&!n){n=!0,i++;continue}if(n&&s==='"'){n=!1,i++;continue}if(!e&&!n&&s==="}"){let h=i+1;for(;h<a.length&&/\s/.test(a[h]);)h++;if(h<a.length&&o(a[h])&&!t.endsWith(`
`)){let c=t.length-1;for(;c>=0&&t[c]!==`
`;)c--;let r="",f=c+1;for(;f<t.length&&(t[f]===" "||t[f]==="	");)r+=t[f],f++;t+=`
`+r}}i++}return t}function z(a,t){const i=a.split(`
`);let e=[],n=!1;for(let o=0;o<i.length;o++){let s=i[o];const h=s.trim();if(n&&h.length>0){const c=(s.match(/^\s*/)||[""])[0];c.length===0?s=t+s:c.startsWith(t)||(s=t+s.slice(c.length)),n=!1}e.push(s),h.endsWith(":")?n=!0:h.length>0&&(n=!1)}let l=e.join(`
`);return l.endsWith(`
`)||(l+=`
`),l}const k=5e3;let O=null,R=!1;self.onmessage=function(a){const t=a.data;if("type"in t&&t.type==="cancel"){O===t.id&&(R=!0);return}const i=t;O&&O!==i.id&&(R=!0),O=i.id,R=!1,Z(i)};async function Z(a){const{id:t,text:i,options:e}=a;try{const n=i.length;if(n<=k){if(R)return;const h=T(i,e);if(!R){const c={id:t,type:"result",result:h};self.postMessage(c)}return}const l=Math.ceil(n/k);let o=0;x(t,0,l);const s=await V(i,e,h=>{R||(o=Math.floor(h*l),x(t,o,l))});if(!R){x(t,l,l);const h={id:t,type:"result",result:s};self.postMessage(h)}}catch(n){if(!R){const l={id:t,type:"error",error:n instanceof Error?n.message:String(n)};self.postMessage(l)}}}async function V(a,t,i){if(i(.1),await W(10),R)throw new Error("Cancelled");if(i(.3),await W(10),R)throw new Error("Cancelled");if(i(.7),await W(10),R)throw new Error("Cancelled");const e=T(a,t);return i(.9),await W(5),i(1),e}function x(a,t,i){const e={id:a,type:"progress",processed:t,total:i};self.postMessage(e)}function W(a){return new Promise(t=>setTimeout(t,a))}})();
