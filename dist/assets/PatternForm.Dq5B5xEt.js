import{j as e}from"./jsx-runtime.9DypCmAh.js";import{r as o}from"./index.eCxJ45ll.js";import{P as A}from"./AnalyticsService.CwF1QyvA.js";import{j as I,k as L}from"./patternStore.FWnDXKzq.js";import"./index.Bda8kKQR.js";const h=new A,O=["Text Formatting","Data Extraction","Validation","Code","Date & Time","URL","Other"];function W({initialPattern:c,onSave:p,onCancel:g}){const[s,n]=o.useState({id:"",name:"",description:"",category:"Other",searchRegex:"",replaceRegex:"",example:{input:"",output:""},tags:[],shortKeys:[],isBuiltIn:!1}),[a,m]=o.useState({}),[u,f]=o.useState(""),[x,b]=o.useState(""),[y,C]=o.useState(!1),[j,N]=o.useState(null),[v,w]=o.useState(null);o.useEffect(()=>{c&&(n({...c,tags:[...c.tags]}),C(!0))},[c]);const l=t=>{const{name:r,value:i}=t.target;if(r==="example.input"||r==="example.output"){const[d,P]=r.split(".");n(K=>({...K,[d]:{...K[d],[P]:i}}))}else n(d=>({...d,[r]:i}));a[r]&&m(d=>({...d,[r]:""}))},k=()=>{if(!u.trim())return;const t=u.trim();s.tags.includes(t)||n(r=>({...r,tags:[...r.tags,t]})),f("")},S=t=>{n(r=>({...r,tags:r.tags.filter(i=>i!==t)}))},R=()=>{if(!x.trim())return;const t=x.trim();if(t.length>3){m(r=>({...r,shortKey:"Short keys must be 3 characters or less"}));return}if(!/^[a-zA-Z0-9]+$/.test(t)){m(r=>({...r,shortKey:"Short keys must be alphanumeric"}));return}s.shortKeys.includes(t)||(n(r=>({...r,shortKeys:[...r.shortKeys,t]})),m(r=>({...r,shortKey:""}))),b("")},E=t=>{n(r=>({...r,shortKeys:r.shortKeys.filter(i=>i!==t)}))},F=()=>{N(null),w(null);try{const t=h.testPattern({searchRegex:s.searchRegex,replaceRegex:s.replaceRegex,input:s.example.input});N(t.output),n(r=>({...r,example:{...r.example,output:t.output}}))}catch(t){w(t instanceof Error?t.message:"An error occurred while testing the pattern")}},T=()=>{const t={};s.name.trim()||(t.name="Name is required"),s.description.trim()||(t.description="Description is required"),s.searchRegex.trim()||(t.searchRegex="Search regex is required"),s.example.input.trim()||(t["example.input"]="Example input is required");try{new RegExp(s.searchRegex)}catch{t.searchRegex="Invalid regular expression"}return m(t),Object.keys(t).length===0},D=async t=>{if(t.preventDefault(),!!T())try{let r;y?(r=await h.updatePattern(s),I(r)):(r=await h.createPattern(s),L(r)),p&&p(r)}catch(r){console.error("Failed to save pattern:",r),m({submit:r instanceof Error?r.message:"Failed to save pattern"})}};return e.jsxs("form",{onSubmit:D,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Name"}),e.jsx("input",{type:"text",id:"name",name:"name",value:s.name,onChange:l,className:`mt-1 block w-full rounded-md border ${a.name?"border-red-300":"border-gray-300"} shadow-sm focus:border-primary focus:ring-primary sm:text-sm`}),a.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.name})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",rows:2,value:s.description,onChange:l,className:`mt-1 block w-full rounded-md border ${a.description?"border-red-300":"border-gray-300"} shadow-sm focus:border-primary focus:ring-primary sm:text-sm`}),a.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.description})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700",children:"Category"}),e.jsx("select",{id:"category",name:"category",value:s.category,onChange:l,className:"mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:border-primary focus:ring-primary sm:text-sm",children:O.map(t=>e.jsx("option",{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"searchRegex",className:"block text-sm font-medium text-gray-700",children:"Search Pattern"}),e.jsx("input",{type:"text",id:"searchRegex",name:"searchRegex",value:s.searchRegex,onChange:l,className:`mt-1 block w-full rounded-md border ${a.searchRegex?"border-red-300":"border-gray-300"} shadow-sm focus:border-primary focus:ring-primary sm:text-sm font-mono`}),a.searchRegex&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.searchRegex})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"replaceRegex",className:"block text-sm font-medium text-gray-700",children:"Replace Pattern"}),e.jsx("input",{type:"text",id:"replaceRegex",name:"replaceRegex",value:s.replaceRegex,onChange:l,className:"mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:border-primary focus:ring-primary sm:text-sm font-mono"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Example"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"example.input",className:"block text-sm font-medium text-gray-700",children:"Input"}),e.jsx("textarea",{id:"example.input",name:"example.input",rows:3,value:s.example.input,onChange:l,className:`mt-1 block w-full rounded-md border ${a["example.input"]?"border-red-300":"border-gray-300"} shadow-sm focus:border-primary focus:ring-primary sm:text-sm font-mono`}),a["example.input"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a["example.input"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{htmlFor:"example.output",className:"block text-sm font-medium text-gray-700",children:"Expected Output"}),e.jsx("button",{type:"button",onClick:F,className:"text-sm text-primary hover:text-blue-700",children:"Test Pattern"})]}),e.jsx("textarea",{id:"example.output",name:"example.output",rows:3,value:s.example.output,onChange:l,className:"mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:border-primary focus:ring-primary sm:text-sm font-mono",readOnly:j!==null}),j&&e.jsx("p",{className:"mt-1 text-sm text-green-600",children:"Test successful! The output matches the expected result."}),v&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:v})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags",className:"block text-sm font-medium text-gray-700",children:"Tags"}),e.jsxs("div",{className:"mt-1 flex rounded-md shadow-sm",children:[e.jsx("input",{type:"text",id:"tags",value:u,onChange:t=>f(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),k())},className:"block w-full rounded-none rounded-l-md border border-gray-300 focus:border-primary focus:ring-primary sm:text-sm",placeholder:"Add a tag"}),e.jsx("button",{type:"button",onClick:k,className:"inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 sm:text-sm",children:"Add"})]}),s.tags.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:s.tags.map(t=>e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[t,e.jsxs("button",{type:"button",onClick:()=>S(t),className:"ml-1.5 inline-flex items-center justify-center h-4 w-4 rounded-full text-blue-400 hover:bg-blue-200 hover:text-blue-500 focus:outline-none",children:[e.jsxs("span",{className:"sr-only",children:["Remove tag ",t]}),e.jsx("svg",{className:"h-2 w-2",stroke:"currentColor",fill:"none",viewBox:"0 0 8 8",children:e.jsx("path",{strokeLinecap:"round",strokeWidth:"1.5",d:"M1 1l6 6m0-6L1 7"})})]})]},t))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"shortKeys",className:"block text-sm font-medium text-gray-700",children:"Short Keys (max 3 characters each)"}),e.jsxs("div",{className:"mt-1 flex rounded-md shadow-sm",children:[e.jsx("input",{type:"text",id:"shortKeys",value:x,onChange:t=>b(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),R())},className:"block w-full rounded-none rounded-l-md border border-gray-300 focus:border-primary focus:ring-primary sm:text-sm",placeholder:"Add a short key",maxLength:3}),e.jsx("button",{type:"button",onClick:R,className:"inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 sm:text-sm",children:"Add"})]}),a.shortKey&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.shortKey}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Short keys are used for quick access to patterns. They must be alphanumeric and maximum 3 characters."}),s.shortKeys.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:s.shortKeys.map(t=>e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[t,e.jsxs("button",{type:"button",onClick:()=>E(t),className:"ml-1.5 inline-flex items-center justify-center h-4 w-4 rounded-full text-blue-400 hover:bg-blue-200 hover:text-blue-500 focus:outline-none",children:[e.jsxs("span",{className:"sr-only",children:["Remove short key ",t]}),e.jsx("svg",{className:"h-2 w-2",stroke:"currentColor",fill:"none",viewBox:"0 0 8 8",children:e.jsx("path",{strokeLinecap:"round",strokeWidth:"1.5",d:"M1 1l6 6m0-6L1 7"})})]})]},t))})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[g&&e.jsx("button",{type:"button",onClick:g,className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:y?"Update Pattern":"Create Pattern"})]}),a.submit&&e.jsx("div",{className:"p-3 bg-red-50 text-red-800 rounded-md",children:a.submit})]})}export{W as default};
