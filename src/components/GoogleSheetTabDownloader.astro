---
import googleSheetScript from '../scripts/googleSheetTabDownloader.js?raw';
---

<section class="mx-auto flex w-full max-w-3xl flex-col gap-8 rounded-xl bg-white p-8 shadow-lg border border-gray-200">
  <header class="space-y-3">
    <p class="text-xs uppercase tracking-wide text-primary font-semibold">Google Sheets</p>
    <h2 class="text-2xl font-semibold text-gray-900">Single-Tab Download Link Generator</h2>
    <p class="text-sm text-gray-600">
      Paste the tab URL from your Google Sheet, pick a format, and get a direct download link for that tab only.
    </p>
  </header>

  <div class="space-y-3 rounded-lg border border-blue-100 bg-blue-50 px-4 py-3 text-sm text-blue-900">
    <h3 class="font-semibold text-blue-900">Before you paste:</h3>
    <ul class="list-disc pl-5 space-y-1">
      <li>Open your Google Sheet and click the tab you want to download.</li>
      <li>Copy the URL while that tab is active (URL must include <code>gid=</code>).</li>
      <li>Paste it below, choose a format, and generate the link.</li>
    </ul>
  </div>

  <form data-role="sheet-form" class="flex flex-col gap-4">
    <label class="flex flex-col gap-2">
      <span class="text-sm font-medium text-gray-800">Google Sheet tab URL</span>
      <input
        name="sheetUrl"
        type="url"
        required
        placeholder="https://docs.google.com/spreadsheets/d/FILE_ID/edit#gid=123456789"
        class="w-full rounded-md border border-gray-300 px-3 py-2 text-base shadow-sm transition focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20"
      />
    </label>

    <label class="flex flex-col gap-2">
      <span class="text-sm font-medium text-gray-800">Export format</span>
      <select
        name="exportFormat"
        class="w-full rounded-md border border-gray-300 px-3 py-2 text-base shadow-sm transition focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20"
      >
        <option value="csv">CSV</option>
        <option value="tsv">TSV</option>
        <option value="xlsx">Excel (.xlsx)</option>
        <option value="ods">OpenDocument (.ods)</option>
        <option value="pdf">PDF</option>
        <option value="html">HTML</option>
        <option value="zip">Zipped HTML (.zip)</option>
      </select>
    </label>

    <button
      type="submit"
      class="inline-flex items-center justify-center rounded-md bg-primary px-4 py-2.5 text-sm font-medium text-white shadow hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2"
    >
      Generate download link
    </button>
  </form>

  <div data-role="sheet-status" class="hidden rounded-md border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700"></div>

  <div data-role="sheet-result" class="hidden flex-col gap-3 rounded-md border border-green-200 bg-green-50 px-4 py-4 text-sm text-gray-800 shadow-sm">
    <div class="flex items-start gap-2">
      <span class="text-xl">âœ…</span>
      <div class="flex-1 space-y-2">
        <p class="font-semibold text-green-900">Direct download link for this tab:</p>
        <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
          <a data-role="sheet-link" class="block break-all rounded bg-white px-3 py-2 text-base font-medium text-primary underline" target="_blank" rel="noopener noreferrer"></a>
          <button
            type="button"
            data-role="sheet-copy"
            class="inline-flex items-center justify-center rounded-md bg-emerald-600 px-3 py-2 text-xs font-medium text-white shadow hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2"
          >
            Copy link
          </button>
        </div>
        <p class="text-xs text-gray-600">
          This link only exports the active tab (via its <code>gid</code>). Anyone who opens it needs view access to the sheet.
        </p>
      </div>
    </div>
  </div>
</section>

<script is:inline type="module" set:html={googleSheetScript}></script>
